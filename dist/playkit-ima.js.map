{"version":3,"sources":["./ima/webpack/bootstrap","./ima/external [\"KalturaPlayer\"]","./ima/../node_modules/javascript-state-machine/lib/state-machine.js","./ima/../node_modules/javascript-state-machine/lib/history.js","webpack://KalturaPlayer.plugins.ima/./assets/style.css?703f","./ima/../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","./ima/./assets/style.css","./ima/../node_modules/css-loader/dist/runtime/api.js","./ima/./state.js","./ima/./ima-middleware.js","./ima/./ima-ads-controller.js","./ima/./ima-state-machine.js","./ima/./ima-engine-decorator.js","./ima/./ima.js","./ima/./ima-custom.js","./ima/./index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","KalturaPlayer","factory","configurable","target","sources","source","arguments","length","mixin","build","config","max","plugin","plugins","methods","properties","defineProperties","hook","fsm","additional","method","args","context","concat","apply","camelize","label","result","words","split","toLowerCase","charAt","toUpperCase","substring","prepended","prepend","Config","options","StateMachine","this","defaults","states","transitions","map","lifecycle","configureLifecycle","init","configureInitTransition","data","configureData","configureMethods","wildcard","configureTransitions","configurePlugins","addState","push","addStateLifecycleNames","onEnter","onLeave","on","addTransition","indexOf","addTransitionLifecycleNames","onBefore","onAfter","mapTransition","transition","from","to","state","active","builtin","configure","Array","isArray","transitionFor","transitionsFor","keys","allStates","allTransitions","Exception","UNOBSERVED","JSM","observers","fire","is","isPending","pending","can","seek","cannot","entry","transit","changed","observeUnchangedState","onPendingTransition","beginTransit","unshift","observeEvents","observersForEvent","onInvalidTransition","endTransit","failTransit","doTransit","observe","observer","event","events","previousEvent","previousResult","undefined","pluggable","nextEvents","slice","shift","then","catch","PublicMethods","_fsm","PublicProperties","set","Error","instance","forEach","version","cstor","message","current","past","future","clear","back","forward","canBack","canForward","pop","api","content","default","locals","memo","isOldIE","Boolean","window","document","all","atob","getTarget","styleTarget","querySelector","HTMLIFrameElement","contentDocument","head","e","stylesInDom","getIndexByIdentifier","identifier","modulesToDom","list","idCountMap","identifiers","item","id","base","count","index","obj","css","media","sourceMap","references","updater","addStyle","insertStyleElement","style","createElement","attributes","nonce","setAttribute","insert","appendChild","textStore","replaceText","replacement","filter","join","applyToSingletonTag","remove","styleSheet","cssText","cssNode","createTextNode","childNodes","removeChild","insertBefore","applyToTag","removeAttribute","btoa","unescape","encodeURIComponent","JSON","stringify","firstChild","singleton","singletonCounter","update","styleIndex","parentNode","removeStyleElement","newObj","lastIdentifiers","newList","toString","newLastIdentifiers","_i","_index","splice","useSourceMap","cssMapping","sourceMapping","sourceURLs","sourceRoot","cssWithMappingToString","mediaQuery","alreadyImportedModules","State","ImaMiddleware","_context","player","addEventListener","Event","CHANGE_SOURCE_STARTED","_isFirstPlay","_nextLoad","load","next","loadPromise","_callNextLoad","getStateMachine","adTagUrl","adsResponse","AD_ERROR","AD_MANIFEST_LOADED","payload","adBreaksPosition","includes","play","disableMediaPreload","playOnMainVideoTag","AD_BREAK_END","getVideoElement","src","initialUserAction","callNext","resumeAd","reset","logger","error","pause","pauseAd","core","BaseMiddleware","ImaAdsController","skipAd","playAdNow","adPod","onPlaybackEnded","AdBreakType","Utils","ImaStateMachine","AD_STARTED","adEvent","getAd","isLinear","AD_RESUMED","AD_PAUSED","AD_SKIPPED","AD_COMPLETED","ADS_COMPLETED","onAdError","AD_LOADED","AD_FIRST_QUARTILE","AD_BREAK_START","AD_MIDPOINT","AD_THIRD_QUARTILE","USER_CLOSED_AD","AD_VOLUME_CHANGED","AD_MUTED","AD_CLICKED","AD_CAN_SKIP","AD_PROGRESS","AD_BUFFERING","onAdloaded","onAdLoaded","onAdstarted","onAdStarted","onAdpaused","onAdEvent","onAdresumed","onAdResumed","onAdclicked","onAdClicked","onAdskipped","onAdSkipped","onAdcompleted","onAdCompleted","onAdscompleted","onAdsCompleted","onAdcanskip","onAdCanSkip","onAdbreakstart","onAdBreakStart","onAdbreakend","onAdBreakEnd","onAdfirstquartile","onAdmidpoint","onAdthirdquartile","onAdlog","onAdLog","onUserclosedad","onAdvolumechanged","onAdmuted","onAdprogress","onAdProgress","onAdbuffering","onEnterState","StateMachineHistory","debug","type","adBreakType","getAdBreakType","adOptions","getAdOptions","ad","Ad","getAdId","Dom","_adsContainerDiv","warn","dispatchEvent","adType","extraAdData","getAdData","_currentAd","_adVideoTagAlreadyPlayed","_resizeAd","_maybeDisplayCompanionAds","_showAdsContainer","_nextPromise","_resolveNextPromise","_maybeIgnoreClickOnAd","_stateMachine","_adsManager","_setToggleAdsCover","paused","_contentComplete","playback","playAdsWithMSE","_contentSrc","adBreakOptions","getAdBreakOptions","adBreak","AdBreak","_maybeSavePlayerSnapshot","_maybeForceExitFullScreen","_maybeSaveVideoCurrentTime","forceReloadMediaAfterAds","eventManager","listenOnce","LOADED_DATA","_maybeSetVideoCurrentTime","_hideAdsContainer","_maybeRestorePlayerSnapshot","adError","getError","getMessage","getAdError","_playAdByConfig","env","os","setTimeout","reject","getAdSkippableState","remainingTime","getRemainingTime","duration","currentTime","Number","isNumber","adProgress","fatal","code","severity","Severity","CRITICAL","RECOVERABLE","category","Category","ADS","getVastErrorCode","parseInt","Code","AD_UNDEFINED_ERROR","currentAd","getCurrentAd","innerError","adData","podInfo","getAdPodInfo","_isVpaid","vpaid","system","getAdSystem","url","getMediaUrl","clickThroughUrl","contentType","getContentType","getDuration","position","_adPosition","getAdPosition","title","getTitle","linear","skipOffset","getSkipTimeOffset","width","getVastMediaWidth","getWidth","height","getVastMediaHeight","getHeight","bitrate","getVastMediaBitrate","bumper","getIsBumper","_isBumper","numAds","_podLength","getTotalAds","ended","OVERLAY","podIndex","getPodIndex","PRE","POST","MID","getAdBreakTypeFromSdk","_getAdBreakTypeFromPlayer","FakeEvent","ImaEngineDecorator","engine","_plugin","defaultPrevented","isAdPlaying","getContentTime","getContentDuration","getContentEnded","EngineType","getCapabilities","Env","EventManager","AudioTrack","TextTrack","FULL_SCREEN_EVENTS","Ima","_initMembers","_init","isValid","getEngineDecorator","getMiddlewareImpl","getAdsController","_playAdBreak","_firstOfAdPod","_waterfalled","_playAd","_hasUserAction","playNext","_adBreaksEventManager","removeAll","onError","response","AD_WATERFALLING","adFailed","waterfall","AD_WATERFALLING_FAILED","adlog","listen","_adsLoader","_sdk","AdsManagerLoadedEvent","Type","ADS_MANAGER_LOADED","AdEvent","COMPLETE","SKIPPED","LOG","AdErrorEvent","ads","isAdBreak","adbreakend","CONTENT_RESUME_REQUESTED","adscompleted","ALL_ADS_COMPLETED","FIRST_PLAY","_requestAds","skip","skipSupport","stop","defer","resume","isCustomPlaybackUsed","_videoLastCurrentTime","_contentDuration","getContentSrc","loadMedia","_addBindings","_adDisplayContainer","AdDisplayContainer","_initAdsLoader","_isImaSDKLibLoaded","_destroyIMAManagers","goto","destroy","initialize","_isAdsManagerLoaded","_startAdsManager","ready","Promise","resolve","dimensions","ViewMode","NORMAL","start","fullScreenEvent","MUTE_CHANGE","_syncPlayerVolume","VOLUME_CHANGE","SOURCE_SELECTED","selectedSource","DURATION_CHANGE","ERROR","MEDIA_LOADED","updateAdsRenderingSettings","restoreCustomPlaybackStateOnAdBreakComplete","ENDED","_onMediaEnded","LOADED_METADATA","_onLoadedMetadata","TIME_UPDATE","_onMediaTimeUpdate","SEEKING","_onMediaSeeking","SEEKED","_onMediaSeeked","USER_GESTURE","_contentPlayheadTracker","previousTime","seeking","_togglePlayPauseOnAdsContainerCallback","_selectedAudioTrack","_selectedTextTrack","_selectedPlaybackRate","_textTracksHidden","_maybeDelayInitUntilSourceSelected","_loadImaSDKLib","google","ima","VERSION","_initImaSettings","_initAdsContainer","delayInitUntilSourceSelected","imaSdkUrl","Http","protocol","IMA_SDK_DEBUG_LIB_URL","IMA_SDK_LIB_URL","loadScriptAsync","settings","setPlayerType","playerName","setPlayerVersion","playerVersion","setVpaidAllowed","setVpaidMode","_getVpaidMode","setLocale","locale","setDisableCustomPlaybackForIOS10Plus","playsinline","numRedirects","setNumRedirects","vpaidmode","ImaSdkSettings","VpaidMode","vpaidMode","ENABLED","playerView","getView","className","_adsCoverDiv","onclick","_onAdsCoverClicked","AdsLoader","adsManagerLoadedEvent","_onAdsManagerLoaded","aderror","vastUrl","vastResponse","adsRequest","AdsRequest","vastLoadTimeout","linearAdSlotWidth","linearAdSlotHeight","nonLinearAdSlotWidth","nonLinearAdSlotHeight","contentDuration","muted","volume","setAdWillPlayMuted","adWillAutoPlay","playerWillAutoPlay","autoplay","allowMutedAutoPlay","setAdWillAutoPlay","requestAds","HTML5","capabilities","mutedAutoPlay","loaded","viewMode","isFullscreen","FULLSCREEN","resize","adTotalWidth","adTotalHeight","_alignAdsContainerSizeForOverlayAd","bottom","left","_hasPostRoll","getCuePoints","contentComplete","visibility","adsRenderingSettings","_getAdsRenderingSetting","getAdsManager","cuePoints","ui","hasManager","showAdBreakCuePoint","cuePoint","getManager","addCuePoint","time","Infinity","adBreakCuePointStyle","_attachAdsManagerListeners","AdsRenderingSettings","setting","playAdsAfterTime","startTime","CONTENT_PAUSE_REQUESTED","adbreakstart","LOADED","adloaded","STARTED","adstarted","PAUSED","adpaused","RESUMED","adresumed","FIRST_QUARTILE","adfirstquartile","MIDPOINT","admidpoint","THIRD_QUARTILE","adthirdquartile","CLICK","adclicked","adskipped","adcompleted","USER_CLOSE","userclosedad","VOLUME_CHANGED","advolumechanged","VOLUME_MUTED","admuted","adprogress","adbuffering","SKIPPABLE_STATE_CHANGED","adcanskip","setVolume","isNaN","enable","nextSibling","_isAdsCoverActive","companions","googletag","cmd","selectionCriteria","CompanionAdSelectionSettings","resourceType","ResourceType","ALL","creativeType","CreativeType","sizeCriteria","SizeCriteria","SELECT_EXACT_MATCH","companionsIds","companionAds","getCompanionAds","getContent","el","getElementById","innerHTML","browser","stopPropagation","_hideActiveTextTracksOnAVPlayer","tracks","textTracks","track","activeCues","cue","text","_setActiveTextTracksOnAVPlayer","isIOS","getActiveTracks","audio","playbackRate","hideTextTrack","CAN_PLAY","selectTrack","inBrowserFullscreen","exitFullscreen","BasePlugin","enablePreloading","useStyledLinearAds","useStyledNonLinearAds","autoAlign","loadVideoTimeout","CustomIma","_adBreakPlayableByConfig","adBreakPlayable","aps","enabled","fetchBidsPromise","fetchBids","BaseImaPlugin","__VERSION__","NAME","__NAME__","registerPlugin"],"mappings":"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","file":"playkit-ima.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","module.exports = KalturaPlayer;","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"StateMachine\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StateMachine\"] = factory();\n\telse\n\t\troot[\"StateMachine\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 5);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function(target, sources) {\n  var n, source, key;\n  for(n = 1 ; n < arguments.length ; n++) {\n    source = arguments[n];\n    for(key in source) {\n      if (source.hasOwnProperty(key))\n        target[key] = source[key];\n    }\n  }\n  return target;\n}\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar mixin = __webpack_require__(0);\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = {\n\n  build: function(target, config) {\n    var n, max, plugin, plugins = config.plugins;\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n];\n      if (plugin.methods)\n        mixin(target, plugin.methods);\n      if (plugin.properties)\n        Object.defineProperties(target, plugin.properties);\n    }\n  },\n\n  hook: function(fsm, name, additional) {\n    var n, max, method, plugin,\n        plugins = fsm.config.plugins,\n        args    = [fsm.context];\n\n    if (additional)\n      args = args.concat(additional)\n\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n]\n      method = plugins[n][name]\n      if (method)\n        method.apply(plugin, args);\n    }\n  }\n\n}\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nfunction camelize(label) {\n\n  if (label.length === 0)\n    return label;\n\n  var n, result, word, words = label.split(/[_-]/);\n\n  // single word with first character already lowercase, return untouched\n  if ((words.length === 1) && (words[0][0].toLowerCase() === words[0][0]))\n    return label;\n\n  result = words[0].toLowerCase();\n  for(n = 1 ; n < words.length ; n++) {\n    result = result + words[n].charAt(0).toUpperCase() + words[n].substring(1).toLowerCase();\n  }\n\n  return result;\n}\n\n//-------------------------------------------------------------------------------------------------\n\ncamelize.prepended = function(prepend, label) {\n  label = camelize(label);\n  return prepend + label[0].toUpperCase() + label.substring(1);\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = camelize;\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar mixin    = __webpack_require__(0),\n    camelize = __webpack_require__(2);\n\n//-------------------------------------------------------------------------------------------------\n\nfunction Config(options, StateMachine) {\n\n  options = options || {};\n\n  this.options     = options; // preserving original options can be useful (e.g visualize plugin)\n  this.defaults    = StateMachine.defaults;\n  this.states      = [];\n  this.transitions = [];\n  this.map         = {};\n  this.lifecycle   = this.configureLifecycle();\n  this.init        = this.configureInitTransition(options.init);\n  this.data        = this.configureData(options.data);\n  this.methods     = this.configureMethods(options.methods);\n\n  this.map[this.defaults.wildcard] = {};\n\n  this.configureTransitions(options.transitions || []);\n\n  this.plugins = this.configurePlugins(options.plugins, StateMachine.plugin);\n\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmixin(Config.prototype, {\n\n  addState: function(name) {\n    if (!this.map[name]) {\n      this.states.push(name);\n      this.addStateLifecycleNames(name);\n      this.map[name] = {};\n    }\n  },\n\n  addStateLifecycleNames: function(name) {\n    this.lifecycle.onEnter[name] = camelize.prepended('onEnter', name);\n    this.lifecycle.onLeave[name] = camelize.prepended('onLeave', name);\n    this.lifecycle.on[name]      = camelize.prepended('on',      name);\n  },\n\n  addTransition: function(name) {\n    if (this.transitions.indexOf(name) < 0) {\n      this.transitions.push(name);\n      this.addTransitionLifecycleNames(name);\n    }\n  },\n\n  addTransitionLifecycleNames: function(name) {\n    this.lifecycle.onBefore[name] = camelize.prepended('onBefore', name);\n    this.lifecycle.onAfter[name]  = camelize.prepended('onAfter',  name);\n    this.lifecycle.on[name]       = camelize.prepended('on',       name);\n  },\n\n  mapTransition: function(transition) {\n    var name = transition.name,\n        from = transition.from,\n        to   = transition.to;\n    this.addState(from);\n    if (typeof to !== 'function')\n      this.addState(to);\n    this.addTransition(name);\n    this.map[from][name] = transition;\n    return transition;\n  },\n\n  configureLifecycle: function() {\n    return {\n      onBefore: { transition: 'onBeforeTransition' },\n      onAfter:  { transition: 'onAfterTransition'  },\n      onEnter:  { state:      'onEnterState'       },\n      onLeave:  { state:      'onLeaveState'       },\n      on:       { transition: 'onTransition'       }\n    };\n  },\n\n  configureInitTransition: function(init) {\n    if (typeof init === 'string') {\n      return this.mapTransition(mixin({}, this.defaults.init, { to: init, active: true }));\n    }\n    else if (typeof init === 'object') {\n      return this.mapTransition(mixin({}, this.defaults.init, init, { active: true }));\n    }\n    else {\n      this.addState(this.defaults.init.from);\n      return this.defaults.init;\n    }\n  },\n\n  configureData: function(data) {\n    if (typeof data === 'function')\n      return data;\n    else if (typeof data === 'object')\n      return function() { return data; }\n    else\n      return function() { return {};  }\n  },\n\n  configureMethods: function(methods) {\n    return methods || {};\n  },\n\n  configurePlugins: function(plugins, builtin) {\n    plugins = plugins || [];\n    var n, max, plugin;\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n];\n      if (typeof plugin === 'function')\n        plugins[n] = plugin = plugin()\n      if (plugin.configure)\n        plugin.configure(this);\n    }\n    return plugins\n  },\n\n  configureTransitions: function(transitions) {\n    var i, n, transition, from, to, wildcard = this.defaults.wildcard;\n    for(n = 0 ; n < transitions.length ; n++) {\n      transition = transitions[n];\n      from  = Array.isArray(transition.from) ? transition.from : [transition.from || wildcard]\n      to    = transition.to || wildcard;\n      for(i = 0 ; i < from.length ; i++) {\n        this.mapTransition({ name: transition.name, from: from[i], to: to });\n      }\n    }\n  },\n\n  transitionFor: function(state, transition) {\n    var wildcard = this.defaults.wildcard;\n    return this.map[state][transition] ||\n           this.map[wildcard][transition];\n  },\n\n  transitionsFor: function(state) {\n    var wildcard = this.defaults.wildcard;\n    return Object.keys(this.map[state]).concat(Object.keys(this.map[wildcard]));\n  },\n\n  allStates: function() {\n    return this.states;\n  },\n\n  allTransitions: function() {\n    return this.transitions;\n  }\n\n});\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = Config;\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\nvar mixin      = __webpack_require__(0),\n    Exception  = __webpack_require__(6),\n    plugin     = __webpack_require__(1),\n    UNOBSERVED = [ null, [] ];\n\n//-------------------------------------------------------------------------------------------------\n\nfunction JSM(context, config) {\n  this.context   = context;\n  this.config    = config;\n  this.state     = config.init.from;\n  this.observers = [context];\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmixin(JSM.prototype, {\n\n  init: function(args) {\n    mixin(this.context, this.config.data.apply(this.context, args));\n    plugin.hook(this, 'init');\n    if (this.config.init.active)\n      return this.fire(this.config.init.name, []);\n  },\n\n  is: function(state) {\n    return Array.isArray(state) ? (state.indexOf(this.state) >= 0) : (this.state === state);\n  },\n\n  isPending: function() {\n    return this.pending;\n  },\n\n  can: function(transition) {\n    return !this.isPending() && !!this.seek(transition);\n  },\n\n  cannot: function(transition) {\n    return !this.can(transition);\n  },\n\n  allStates: function() {\n    return this.config.allStates();\n  },\n\n  allTransitions: function() {\n    return this.config.allTransitions();\n  },\n\n  transitions: function() {\n    return this.config.transitionsFor(this.state);\n  },\n\n  seek: function(transition, args) {\n    var wildcard = this.config.defaults.wildcard,\n        entry    = this.config.transitionFor(this.state, transition),\n        to       = entry && entry.to;\n    if (typeof to === 'function')\n      return to.apply(this.context, args);\n    else if (to === wildcard)\n      return this.state\n    else\n      return to\n  },\n\n  fire: function(transition, args) {\n    return this.transit(transition, this.state, this.seek(transition, args), args);\n  },\n\n  transit: function(transition, from, to, args) {\n\n    var lifecycle = this.config.lifecycle,\n        changed   = this.config.options.observeUnchangedState || (from !== to);\n\n    if (!to)\n      return this.context.onInvalidTransition(transition, from, to);\n\n    if (this.isPending())\n      return this.context.onPendingTransition(transition, from, to);\n\n    this.config.addState(to);  // might need to add this state if it's unknown (e.g. conditional transition or goto)\n\n    this.beginTransit();\n\n    args.unshift({             // this context will be passed to each lifecycle event observer\n      transition: transition,\n      from:       from,\n      to:         to,\n      fsm:        this.context\n    });\n\n    return this.observeEvents([\n                this.observersForEvent(lifecycle.onBefore.transition),\n                this.observersForEvent(lifecycle.onBefore[transition]),\n      changed ? this.observersForEvent(lifecycle.onLeave.state) : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onLeave[from]) : UNOBSERVED,\n                this.observersForEvent(lifecycle.on.transition),\n      changed ? [ 'doTransit', [ this ] ]                       : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onEnter.state) : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onEnter[to])   : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.on[to])        : UNOBSERVED,\n                this.observersForEvent(lifecycle.onAfter.transition),\n                this.observersForEvent(lifecycle.onAfter[transition]),\n                this.observersForEvent(lifecycle.on[transition])\n    ], args);\n  },\n\n  beginTransit: function()          { this.pending = true;                 },\n  endTransit:   function(result)    { this.pending = false; return result; },\n  failTransit:  function(result)    { this.pending = false; throw result;  },\n  doTransit:    function(lifecycle) { this.state = lifecycle.to;           },\n\n  observe: function(args) {\n    if (args.length === 2) {\n      var observer = {};\n      observer[args[0]] = args[1];\n      this.observers.push(observer);\n    }\n    else {\n      this.observers.push(args[0]);\n    }\n  },\n\n  observersForEvent: function(event) { // TODO: this could be cached\n    var n = 0, max = this.observers.length, observer, result = [];\n    for( ; n < max ; n++) {\n      observer = this.observers[n];\n      if (observer[event])\n        result.push(observer);\n    }\n    return [ event, result, true ]\n  },\n\n  observeEvents: function(events, args, previousEvent, previousResult) {\n    if (events.length === 0) {\n      return this.endTransit(previousResult === undefined ? true : previousResult);\n    }\n\n    var event     = events[0][0],\n        observers = events[0][1],\n        pluggable = events[0][2];\n\n    args[0].event = event;\n    if (event && pluggable && event !== previousEvent)\n      plugin.hook(this, 'lifecycle', args);\n\n    if (observers.length === 0) {\n      var nextEvents = events.slice(1);\n      return this.observeEvents(nextEvents, args, event, previousResult);\n    }\n    else {\n      var observer = observers.shift(),\n          result = observer[event].apply(observer, args);\n      if (result && typeof result.then === 'function') {\n        return result.then(this.observeEvents.bind(this, events, args, event))\n                     .catch(this.failTransit.bind(this))\n      }\n      else if (result === false) {\n        return this.endTransit(false);\n      }\n      else {\n        return this.observeEvents(events, args, event, result);\n      }\n    }\n  },\n\n  onInvalidTransition: function(transition, from, to) {\n    throw new Exception(\"transition is invalid in current state\", transition, from, to, this.state);\n  },\n\n  onPendingTransition: function(transition, from, to) {\n    throw new Exception(\"transition is invalid while previous transition is still in progress\", transition, from, to, this.state);\n  }\n\n});\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = JSM;\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-----------------------------------------------------------------------------------------------\n\nvar mixin    = __webpack_require__(0),\n    camelize = __webpack_require__(2),\n    plugin   = __webpack_require__(1),\n    Config   = __webpack_require__(3),\n    JSM      = __webpack_require__(4);\n\n//-----------------------------------------------------------------------------------------------\n\nvar PublicMethods = {\n  is:                  function(state)       { return this._fsm.is(state)                                     },\n  can:                 function(transition)  { return this._fsm.can(transition)                               },\n  cannot:              function(transition)  { return this._fsm.cannot(transition)                            },\n  observe:             function()            { return this._fsm.observe(arguments)                            },\n  transitions:         function()            { return this._fsm.transitions()                                 },\n  allTransitions:      function()            { return this._fsm.allTransitions()                              },\n  allStates:           function()            { return this._fsm.allStates()                                   },\n  onInvalidTransition: function(t, from, to) { return this._fsm.onInvalidTransition(t, from, to)              },\n  onPendingTransition: function(t, from, to) { return this._fsm.onPendingTransition(t, from, to)              },\n}\n\nvar PublicProperties = {\n  state: {\n    configurable: false,\n    enumerable:   true,\n    get: function() {\n      return this._fsm.state;\n    },\n    set: function(state) {\n      throw Error('use transitions to change state')\n    }\n  }\n}\n\n//-----------------------------------------------------------------------------------------------\n\nfunction StateMachine(options) {\n  return apply(this || {}, options);\n}\n\nfunction factory() {\n  var cstor, options;\n  if (typeof arguments[0] === 'function') {\n    cstor   = arguments[0];\n    options = arguments[1] || {};\n  }\n  else {\n    cstor   = function() { this._fsm.apply(this, arguments) };\n    options = arguments[0] || {};\n  }\n  var config = new Config(options, StateMachine);\n  build(cstor.prototype, config);\n  cstor.prototype._fsm.config = config; // convenience access to shared config without needing an instance\n  return cstor;\n}\n\n//-------------------------------------------------------------------------------------------------\n\nfunction apply(instance, options) {\n  var config = new Config(options, StateMachine);\n  build(instance, config);\n  instance._fsm();\n  return instance;\n}\n\nfunction build(target, config) {\n  if ((typeof target !== 'object') || Array.isArray(target))\n    throw Error('StateMachine can only be applied to objects');\n  plugin.build(target, config);\n  Object.defineProperties(target, PublicProperties);\n  mixin(target, PublicMethods);\n  mixin(target, config.methods);\n  config.allTransitions().forEach(function(transition) {\n    target[camelize(transition)] = function() {\n      return this._fsm.fire(transition, [].slice.call(arguments))\n    }\n  });\n  target._fsm = function() {\n    this._fsm = new JSM(this, config);\n    this._fsm.init(arguments);\n  }\n}\n\n//-----------------------------------------------------------------------------------------------\n\nStateMachine.version  = '3.0.1';\nStateMachine.factory  = factory;\nStateMachine.apply    = apply;\nStateMachine.defaults = {\n  wildcard: '*',\n  init: {\n    name: 'init',\n    from: 'none'\n  }\n}\n\n//===============================================================================================\n\nmodule.exports = StateMachine;\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function(message, transition, from, to, current) {\n  this.message    = message;\n  this.transition = transition;\n  this.from       = from;\n  this.to         = to;\n  this.current    = current;\n}\n\n\n/***/ })\n/******/ ]);\n});","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"StateMachineHistory\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StateMachineHistory\"] = factory();\n\telse\n\t\troot[\"StateMachineHistory\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 1);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nfunction camelize(label) {\n\n  if (label.length === 0)\n    return label;\n\n  var n, result, word, words = label.split(/[_-]/);\n\n  // single word with first character already lowercase, return untouched\n  if ((words.length === 1) && (words[0][0].toLowerCase() === words[0][0]))\n    return label;\n\n  result = words[0].toLowerCase();\n  for(n = 1 ; n < words.length ; n++) {\n    result = result + words[n].charAt(0).toUpperCase() + words[n].substring(1).toLowerCase();\n  }\n\n  return result;\n}\n\n//-------------------------------------------------------------------------------------------------\n\ncamelize.prepended = function(prepend, label) {\n  label = camelize(label);\n  return prepend + label[0].toUpperCase() + label.substring(1);\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = camelize;\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar camelize = __webpack_require__(0);\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = function(options) { options = options || {};\n\n  var past       = camelize(options.name || options.past   || 'history'),\n      future     = camelize(                options.future || 'future'),\n      clear      = camelize.prepended('clear', past),\n      back       = camelize.prepended(past,   'back'),\n      forward    = camelize.prepended(past,   'forward'),\n      canBack    = camelize.prepended('can',   back),\n      canForward = camelize.prepended('can',   forward),\n      max        = options.max;\n\n  var plugin = {\n\n    configure: function(config) {\n      config.addTransitionLifecycleNames(back);\n      config.addTransitionLifecycleNames(forward);\n    },\n\n    init: function(instance) {\n      instance[past]   = [];\n      instance[future] = [];\n    },\n\n    lifecycle: function(instance, lifecycle) {\n      if (lifecycle.event === 'onEnterState') {\n        instance[past].push(lifecycle.to);\n        if (max && instance[past].length > max)\n          instance[past].shift();\n        if (lifecycle.transition !== back && lifecycle.transition !== forward)\n          instance[future].length = 0;\n      }\n    },\n\n    methods:    {},\n    properties: {}\n\n  }\n\n  plugin.methods[clear] = function() {\n    this[past].length = 0\n    this[future].length = 0\n  }\n\n  plugin.properties[canBack] = {\n    get: function() {\n      return this[past].length > 1\n    }\n  }\n\n  plugin.properties[canForward] = {\n    get: function() {\n      return this[future].length > 0\n    }\n  }\n\n  plugin.methods[back] = function() {\n    if (!this[canBack])\n      throw Error('no history');\n    var from = this[past].pop(),\n        to   = this[past].pop();\n    this[future].push(from);\n    this._fsm.transit(back, from, to, []);\n  }\n\n  plugin.methods[forward] = function() {\n    if (!this[canForward])\n      throw Error('no history');\n    var from = this.state,\n        to = this[future].pop();\n    this._fsm.transit(forward, from, to, []);\n  }\n\n  return plugin;\n\n}\n\n\n/***/ })\n/******/ ]);\n});","var api = require(\"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../node_modules/css-loader/dist/cjs.js!./style.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","\"use strict\";\n\nvar isOldIE = function isOldIE() {\n  var memo;\n  return function memorize() {\n    if (typeof memo === 'undefined') {\n      // Test for IE <= 9 as proposed by Browserhacks\n      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n      // Tests for existence of standard globals is to allow style-loader\n      // to operate correctly into non-standard environments\n      // @see https://github.com/webpack-contrib/style-loader/issues/177\n      memo = Boolean(window && document && document.all && !window.atob);\n    }\n\n    return memo;\n  };\n}();\n\nvar getTarget = function getTarget() {\n  var memo = {};\n  return function memorize(target) {\n    if (typeof memo[target] === 'undefined') {\n      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n        try {\n          // This will throw an exception if access to iframe is blocked\n          // due to cross-origin restrictions\n          styleTarget = styleTarget.contentDocument.head;\n        } catch (e) {\n          // istanbul ignore next\n          styleTarget = null;\n        }\n      }\n\n      memo[target] = styleTarget;\n    }\n\n    return memo[target];\n  };\n}();\n\nvar stylesInDom = [];\n\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n\n  for (var i = 0; i < stylesInDom.length; i++) {\n    if (stylesInDom[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n}\n\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var index = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3]\n    };\n\n    if (index !== -1) {\n      stylesInDom[index].references++;\n      stylesInDom[index].updater(obj);\n    } else {\n      stylesInDom.push({\n        identifier: identifier,\n        updater: addStyle(obj, options),\n        references: 1\n      });\n    }\n\n    identifiers.push(identifier);\n  }\n\n  return identifiers;\n}\n\nfunction insertStyleElement(options) {\n  var style = document.createElement('style');\n  var attributes = options.attributes || {};\n\n  if (typeof attributes.nonce === 'undefined') {\n    var nonce = typeof __webpack_nonce__ !== 'undefined' ? __webpack_nonce__ : null;\n\n    if (nonce) {\n      attributes.nonce = nonce;\n    }\n  }\n\n  Object.keys(attributes).forEach(function (key) {\n    style.setAttribute(key, attributes[key]);\n  });\n\n  if (typeof options.insert === 'function') {\n    options.insert(style);\n  } else {\n    var target = getTarget(options.insert || 'head');\n\n    if (!target) {\n      throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n    }\n\n    target.appendChild(style);\n  }\n\n  return style;\n}\n\nfunction removeStyleElement(style) {\n  // istanbul ignore if\n  if (style.parentNode === null) {\n    return false;\n  }\n\n  style.parentNode.removeChild(style);\n}\n/* istanbul ignore next  */\n\n\nvar replaceText = function replaceText() {\n  var textStore = [];\n  return function replace(index, replacement) {\n    textStore[index] = replacement;\n    return textStore.filter(Boolean).join('\\n');\n  };\n}();\n\nfunction applyToSingletonTag(style, index, remove, obj) {\n  var css = remove ? '' : obj.media ? \"@media \".concat(obj.media, \" {\").concat(obj.css, \"}\") : obj.css; // For old IE\n\n  /* istanbul ignore if  */\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = replaceText(index, css);\n  } else {\n    var cssNode = document.createTextNode(css);\n    var childNodes = style.childNodes;\n\n    if (childNodes[index]) {\n      style.removeChild(childNodes[index]);\n    }\n\n    if (childNodes.length) {\n      style.insertBefore(cssNode, childNodes[index]);\n    } else {\n      style.appendChild(cssNode);\n    }\n  }\n}\n\nfunction applyToTag(style, options, obj) {\n  var css = obj.css;\n  var media = obj.media;\n  var sourceMap = obj.sourceMap;\n\n  if (media) {\n    style.setAttribute('media', media);\n  } else {\n    style.removeAttribute('media');\n  }\n\n  if (sourceMap && btoa) {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    while (style.firstChild) {\n      style.removeChild(style.firstChild);\n    }\n\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar singleton = null;\nvar singletonCounter = 0;\n\nfunction addStyle(obj, options) {\n  var style;\n  var update;\n  var remove;\n\n  if (options.singleton) {\n    var styleIndex = singletonCounter++;\n    style = singleton || (singleton = insertStyleElement(options));\n    update = applyToSingletonTag.bind(null, style, styleIndex, false);\n    remove = applyToSingletonTag.bind(null, style, styleIndex, true);\n  } else {\n    style = insertStyleElement(options);\n    update = applyToTag.bind(null, style, options);\n\n    remove = function remove() {\n      removeStyleElement(style);\n    };\n  }\n\n  update(obj);\n  return function updateStyle(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {\n        return;\n      }\n\n      update(obj = newObj);\n    } else {\n      remove();\n    }\n  };\n}\n\nmodule.exports = function (list, options) {\n  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n  // tags it will allow on a page\n\n  if (!options.singleton && typeof options.singleton !== 'boolean') {\n    options.singleton = isOldIE();\n  }\n\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    if (Object.prototype.toString.call(newList) !== '[object Array]') {\n      return;\n    }\n\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDom[index].references--;\n    }\n\n    var newLastIdentifiers = modulesToDom(newList, options);\n\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n\n      var _index = getIndexByIdentifier(_identifier);\n\n      if (stylesInDom[_index].references === 0) {\n        stylesInDom[_index].updater();\n\n        stylesInDom.splice(_index, 1);\n      }\n    }\n\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","exports = module.exports = require(\"../../node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.id, \".playkit-ads-cover {\\n  position: relative;\\n  cursor: pointer;\\n  width: 100%;\\n  height: 100%;\\n  background-color: rgba(0, 0, 0, 0);\\n}\\n\\n.playkit-ads-container {\\n  visibility: hidden;\\n  position: absolute;\\n}\\n\", \"\"]);\n\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function (useSourceMap) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item, useSourceMap);\n\n      if (item[2]) {\n        return '@media ' + item[2] + '{' + content + '}';\n      } else {\n        return content;\n      }\n    }).join('');\n  }; // import a list of modules into the list\n\n\n  list.i = function (modules, mediaQuery) {\n    if (typeof modules === 'string') {\n      modules = [[null, modules, '']];\n    }\n\n    var alreadyImportedModules = {};\n\n    for (var i = 0; i < this.length; i++) {\n      var id = this[i][0];\n\n      if (id != null) {\n        alreadyImportedModules[id] = true;\n      }\n    }\n\n    for (i = 0; i < modules.length; i++) {\n      var item = modules[i]; // skip already imported module\n      // this implementation is not 100% perfect for weird media query combinations\n      // when a module is imported multiple times with different media queries.\n      // I hope this will never occur (Hey this way we have smaller bundles)\n\n      if (item[0] == null || !alreadyImportedModules[item[0]]) {\n        if (mediaQuery && !item[2]) {\n          item[2] = mediaQuery;\n        } else if (mediaQuery) {\n          item[2] = '(' + item[2] + ') and (' + mediaQuery + ')';\n        }\n\n        list.push(item);\n      }\n    }\n  };\n\n  return list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n  var content = item[1] || '';\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (useSourceMap && typeof btoa === 'function') {\n    var sourceMapping = toComment(cssMapping);\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */';\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n  }\n\n  return [content].join('\\n');\n} // Adapted from convert-source-map (MIT)\n\n\nfunction toComment(sourceMap) {\n  // eslint-disable-next-line no-undef\n  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n  var data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n  return '/*# ' + data + ' */';\n}","// @flow\n\n/**\n * The ima plugin possible states.\n * @type {Object}\n */\nconst State: {[state: string]: string} = {\n  LOADING: 'loading',\n  LOADED: 'loaded',\n  PENDING: 'pending',\n  PLAYING: 'playing',\n  PAUSED: 'paused',\n  IDLE: 'idle',\n  DONE: 'done'\n};\n\nexport {State};\n","// @flow\nimport {core} from 'kaltura-player-js';\nimport {Ima} from './ima';\nimport {State} from './state';\n\nconst {BaseMiddleware} = core;\n/**\n * Middleware implementation for ima plugin.\n * @class ImaMiddleware\n * @param {Ima} context - The ima plugin context.\n * @private\n */\nclass ImaMiddleware extends BaseMiddleware {\n  /**\n   * The id of the ima middleware.\n   * @type {string}\n   * @public\n   * @memberof ImaMiddleware\n   */\n  id: string = 'ImaMiddleware';\n  /**\n   * Whether the play request is the first.\n   * @member\n   * @private\n   * @memberof ImaMiddleware\n   */\n  _isFirstPlay: boolean;\n  /**\n   * The plugin context.\n   * @member\n   * @private\n   * @memberof ImaMiddleware\n   */\n  _context: Ima;\n  /**\n   * The next load function.\n   * @member\n   * @private\n   * @memberof ImaMiddleware\n   */\n  _nextLoad: ?Function;\n\n  constructor(context: Ima) {\n    super();\n    this._context = context;\n    context.player.addEventListener(context.player.Event.CHANGE_SOURCE_STARTED, () => {\n      this._isFirstPlay = true;\n      this._nextLoad = null;\n    });\n  }\n\n  /**\n   * Load middleware handler.\n   * @param {Function} next - The load play handler in the middleware chain.\n   * @returns {void}\n   * @memberof ImaMiddleware\n   */\n  load(next: Function): void {\n    this._nextLoad = next;\n    this._context.loadPromise.catch(() => this._callNextLoad());\n    const sm = this._context.getStateMachine();\n    if (sm.state !== State.IDLE && (this._context.config.adTagUrl || this._context.config.adsResponse)) {\n      this._context.player.addEventListener(this._context.player.Event.AD_ERROR, () => {\n        this._callNextLoad();\n      });\n      this._context.player.addEventListener(this._context.player.Event.AD_MANIFEST_LOADED, event => {\n        if (!event.payload.adBreaksPosition.includes(0)) {\n          this._callNextLoad();\n        }\n      });\n    } else {\n      this._callNextLoad();\n    }\n  }\n\n  /**\n   * Play middleware handler.\n   * @param {Function} next - The next play handler in the middleware chain.\n   * @returns {void}\n   * @memberof ImaMiddleware\n   */\n  play(next: Function): void {\n    if (this._isFirstPlay) {\n      this._isFirstPlay = false;\n      if (this._context.config.disableMediaPreload || this._context.playOnMainVideoTag()) {\n        this._context.player.addEventListener(this._context.player.Event.AD_BREAK_END, () => this._callNextLoad());\n        if (!(this._context.playOnMainVideoTag() || this._context.player.getVideoElement().src)) {\n          this._context.player.getVideoElement().load();\n        }\n      } else {\n        this._callNextLoad();\n      }\n    }\n    this._context.loadPromise\n      .then(() => {\n        let sm = this._context.getStateMachine();\n        switch (sm.state) {\n          case State.PLAYING:\n            break;\n          case State.LOADED: {\n            const initialUserAction = this._context.initialUserAction();\n            if (initialUserAction) {\n              return initialUserAction.then(() => {\n                this.callNext(next);\n              });\n            } else {\n              this.callNext(next);\n            }\n            break;\n          }\n          case State.PAUSED: {\n            const resumeAd = this._context.resumeAd();\n            if (resumeAd) {\n              return resumeAd.then(() => {\n                this.callNext(next);\n              });\n            } else {\n              this.callNext(next);\n            }\n            break;\n          }\n          default: {\n            this.callNext(next);\n            break;\n          }\n        }\n      })\n      .catch(e => {\n        this._context.reset();\n        this._context.logger.error(e);\n        this.callNext(next);\n      });\n  }\n\n  /**\n   * Pause middleware handler.\n   * @param {Function} next - The next pause handler in the middleware chain.\n   * @returns {void}\n   * @memberof ImaMiddleware\n   */\n  pause(next: Function): void {\n    let sm = this._context.getStateMachine();\n    switch (sm.state) {\n      case State.PAUSED:\n        break;\n      case State.PLAYING: {\n        this._context.pauseAd();\n        break;\n      }\n      default: {\n        this.callNext(next);\n        break;\n      }\n    }\n  }\n\n  _callNextLoad(): void {\n    if (this._nextLoad) {\n      this.callNext(this._nextLoad);\n    }\n    this._nextLoad = null;\n  }\n}\n\nexport {ImaMiddleware};\n","// @flow\nimport {Ima} from './ima';\nimport {State} from './state';\n\n/**\n * Controller for ima plugin.\n * @class ImaAdsController\n * @param {Ima} context - The ima plugin context.\n */\nclass ImaAdsController implements IAdsPluginController {\n  /**\n   * The plugin context.\n   * @member\n   * @private\n   * @memberof ImaAdsController\n   */\n  _context: Ima;\n\n  constructor(context: Ima) {\n    this._context = context;\n  }\n\n  /**\n   * Skip on an ad.\n   * @public\n   * @returns {void}\n   * @memberof ImaAdsController\n   */\n  skipAd(): void {\n    this._context.skipAd();\n  }\n\n  /**\n   * Play an ad on demand.\n   * @param {KPAdPod} adPod - The ad pod to play.\n   * @public\n   * @returns {void}\n   * @memberof ImaAdsController\n   */\n  playAdNow(adPod: KPAdPod): void {\n    this._context.playAdNow(adPod);\n  }\n\n  /**\n   * On playback ended handler.\n   * @public\n   * @returns {Promise<void>} - complete promise\n   * @memberof ImaAdsController\n   */\n  onPlaybackEnded(): Promise<void> {\n    return this._context.onPlaybackEnded();\n  }\n\n  /**\n   * Whether this ads controller is active\n   * @public\n   * @returns {boolean} - is active\n   * @memberof ImaAdsController\n   */\n  get active(): boolean {\n    return this._context.getStateMachine().state === State.PLAYING || this._context.getStateMachine().state === State.PAUSED;\n  }\n\n  /**\n   * Whether this ads controller is done\n   * @public\n   * @returns {boolean} - is done\n   * @memberof ImaAdsController\n   */\n  get done(): boolean {\n    return this._context.getStateMachine().state === State.DONE;\n  }\n\n  /**\n   * The controller name\n   * @public\n   * @returns {string} - The name\n   * @memberof ImaAdsController\n   */\n  get name(): string {\n    return this._context.name;\n  }\n}\n\nexport {ImaAdsController};\n","// @flow\nimport StateMachine from 'javascript-state-machine';\nimport StateMachineHistory from 'javascript-state-machine/lib/history';\nimport {State} from './state';\nimport {core, Ad, AdBreak} from 'kaltura-player-js';\n\nconst {AdBreakType, Error, Utils} = core;\n\n/**\n * Finite state machine for ima plugin.\n * @class ImaStateMachine\n * @private\n * @param {any} context - The plugin context.\n * @classdesc\n */\nclass ImaStateMachine {\n  constructor(context: any) {\n    return new StateMachine({\n      init: State.LOADING,\n      transitions: [\n        {\n          name: 'loaded',\n          from: [State.LOADING, State.LOADED, State.IDLE, State.PAUSED, State.PLAYING, State.DONE],\n          to: State.LOADED\n        },\n        {\n          name: context.player.Event.AD_STARTED,\n          from: [State.LOADED, State.IDLE, State.PAUSED, State.PLAYING, State.PENDING],\n          to: (adEvent: any): string => {\n            let ad = adEvent.getAd();\n            if (!ad.isLinear()) {\n              return State.IDLE;\n            }\n            return State.PLAYING;\n          }\n        },\n        {\n          name: context.player.Event.AD_RESUMED,\n          from: [State.PAUSED, State.PLAYING],\n          to: State.PLAYING\n        },\n        {\n          name: context.player.Event.AD_PAUSED,\n          from: State.PLAYING,\n          to: State.PAUSED\n        },\n        {\n          name: context.player.Event.AD_SKIPPED,\n          from: [State.PLAYING, State.PAUSED],\n          to: State.IDLE\n        },\n        {\n          name: context.player.Event.AD_COMPLETED,\n          from: [State.PLAYING, State.PAUSED]\n        },\n        {\n          name: context.player.Event.ADS_COMPLETED,\n          from: [State.IDLE, State.PAUSED],\n          to: State.DONE\n        },\n        {\n          name: context.player.Event.AD_BREAK_END,\n          from: [State.IDLE, State.PLAYING, State.LOADED, State.PAUSED],\n          to: State.IDLE\n        },\n        {\n          name: 'adlog',\n          from: [State.IDLE, State.LOADED, State.PLAYING, State.PAUSED, State.LOADING, State.PENDING],\n          to: State.IDLE\n        },\n        {\n          name: context.player.Event.AD_ERROR,\n          from: [State.IDLE, State.LOADED, State.PLAYING, State.PAUSED, State.LOADING, State.PENDING],\n          to: onAdError.bind(context)\n        },\n        {\n          name: context.player.Event.AD_LOADED,\n          from: [State.IDLE, State.LOADED, State.PLAYING]\n        },\n        {\n          name: context.player.Event.AD_FIRST_QUARTILE,\n          from: State.PLAYING\n        },\n        {\n          name: context.player.Event.AD_BREAK_START,\n          from: [State.IDLE, State.LOADED],\n          to: State.PENDING\n        },\n        {\n          name: context.player.Event.AD_MIDPOINT,\n          from: State.PLAYING\n        },\n        {\n          name: context.player.Event.AD_THIRD_QUARTILE,\n          from: State.PLAYING\n        },\n        {\n          name: context.player.Event.USER_CLOSED_AD,\n          from: [State.IDLE, State.PLAYING, State.PAUSED]\n        },\n        {\n          name: context.player.Event.AD_VOLUME_CHANGED,\n          from: [State.PENDING, State.PLAYING, State.PAUSED, State.LOADED]\n        },\n        {\n          name: context.player.Event.AD_MUTED,\n          from: [State.PLAYING, State.PAUSED, State.LOADED]\n        },\n        {\n          name: context.player.Event.AD_CLICKED,\n          from: [State.PLAYING, State.PAUSED, State.IDLE]\n        },\n        {\n          name: context.player.Event.AD_CAN_SKIP,\n          from: [State.PLAYING, State.PAUSED, State.LOADED]\n        },\n        {\n          name: context.player.Event.AD_PROGRESS,\n          from: [State.PLAYING, State.PAUSED, State.PENDING]\n        },\n        {\n          name: context.player.Event.AD_BUFFERING,\n          from: '*'\n        },\n        {\n          name: 'goto',\n          from: '*',\n          to: s => s\n        }\n      ],\n      methods: {\n        onAdloaded: onAdLoaded.bind(context),\n        onAdstarted: onAdStarted.bind(context),\n        onAdpaused: onAdEvent.bind(context),\n        onAdresumed: onAdResumed.bind(context),\n        onAdclicked: onAdClicked.bind(context),\n        onAdskipped: onAdSkipped.bind(context),\n        onAdcompleted: onAdCompleted.bind(context),\n        onAdscompleted: onAdsCompleted.bind(context),\n        onAdcanskip: onAdCanSkip.bind(context),\n        onAdbreakstart: onAdBreakStart.bind(context),\n        onAdbreakend: onAdBreakEnd.bind(context),\n        onAdfirstquartile: onAdEvent.bind(context),\n        onAdmidpoint: onAdEvent.bind(context),\n        onAdthirdquartile: onAdEvent.bind(context),\n        onAdlog: onAdLog.bind(context),\n        onUserclosedad: onAdEvent.bind(context),\n        onAdvolumechanged: onAdEvent.bind(context),\n        onAdmuted: onAdEvent.bind(context),\n        onAdprogress: onAdProgress.bind(context),\n        onAdbuffering: onAdEvent.bind(context),\n        onEnterState: onEnterState.bind(context),\n        onPendingTransition: onPendingTransition.bind(context)\n      },\n      plugins: [new StateMachineHistory()]\n    });\n  }\n}\n\n/**\n * LOADED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdLoaded(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  const adBreakType = getAdBreakType.call(this, adEvent);\n  const adOptions = getAdOptions.call(this, adEvent);\n  const ad = new Ad(adEvent.getAd().getAdId(), adOptions);\n  Utils.Dom.setAttribute(this._adsContainerDiv, 'data-adtype', adBreakType);\n  this.logger.warn(`adType and extraAdData fields will be deprecated soon from AD_LOADED event payload. See docs for more information`);\n  this.dispatchEvent(options.transition, {\n    ad: ad,\n    adType: adBreakType, // for backward compatibility\n    extraAdData: adEvent.getAdData() // for backward compatibility\n  });\n}\n\n/**\n * STARTED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdStarted(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this._currentAd = adEvent.getAd();\n  this._adVideoTagAlreadyPlayed = true;\n  this._resizeAd();\n  this._maybeDisplayCompanionAds();\n  if (!this._currentAd.isLinear()) {\n    if (this._nextPromise) {\n      this._resolveNextPromise();\n    } else {\n      this.player.play();\n    }\n  } else {\n    this._showAdsContainer();\n  }\n  const adOptions = getAdOptions.call(this, adEvent);\n  const ad = new Ad(adEvent.getAd().getAdId(), adOptions);\n  this.dispatchEvent(options.transition, {ad});\n}\n\n/**\n * CLICKED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdClicked(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  if (this._currentAd.isLinear()) {\n    this._maybeIgnoreClickOnAd();\n    if (this._stateMachine.is(State.PLAYING)) {\n      this._adsManager.pause();\n    }\n    this._setToggleAdsCover(true);\n  } else {\n    if (!this.player.paused) {\n      this.player.pause();\n    }\n  }\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * RESUMED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdResumed(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this._setToggleAdsCover(false);\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * COMPLETE event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdCompleted(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * ADS_COMPLETED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdsCompleted(options: Object, adEvent: any): void {\n  this.logger.debug(options.transition.toUpperCase());\n  if (this.playOnMainVideoTag() && this._contentComplete && !this.player.config.playback.playAdsWithMSE) {\n    this.player.getVideoElement().src = this._contentSrc;\n  }\n  onAdBreakEnd.call(this, options, adEvent);\n}\n\n/**\n * CONTENT_PAUSED_REQUESTED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdBreakStart(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this.player.pause();\n  const adBreakOptions = getAdBreakOptions.call(this, adEvent);\n  const adBreak = new AdBreak(adBreakOptions);\n  this._maybeSavePlayerSnapshot();\n  this._maybeForceExitFullScreen();\n  this._maybeSaveVideoCurrentTime();\n  this.dispatchEvent(options.transition, {adBreak: adBreak});\n}\n\n/**\n * CONTENT_RESUMED_REQUESTED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdBreakEnd(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this._currentAd = null;\n  if (!this._contentComplete) {\n    if (this.config.forceReloadMediaAfterAds) {\n      this.eventManager.listenOnce(this.player, this.player.Event.LOADED_DATA, () => {\n        this._maybeSetVideoCurrentTime();\n        this.player.play();\n      });\n      this.player.getVideoElement().load();\n    }\n    this._hideAdsContainer();\n    this._maybeSetVideoCurrentTime();\n    if (this._nextPromise) {\n      this._resolveNextPromise();\n    } else if (!this.config.forceReloadMediaAfterAds) {\n      this.player.play();\n    }\n  }\n  this._maybeRestorePlayerSnapshot();\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * LOG event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdLog(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  let adError;\n  if (typeof adEvent.getAdData === 'function') {\n    adError = adEvent.getAdData().adError;\n  } else if (typeof adEvent.getError === 'function') {\n    adError = adEvent.getError();\n  }\n  if (adError) {\n    this.logger.error('Non-fatal error occurred: ' + adError.getMessage());\n    this.dispatchEvent(this.player.Event.AD_ERROR, getAdError.call(this, adError, false));\n  }\n}\n\n/**\n * ERROR event handler.\n * @param {any} adEvent - ima event data.\n * @returns {string} - the state to move\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdError(adEvent: any): string {\n  let state = State.IDLE;\n  if (this._playAdByConfig()) {\n    this.logger.debug(adEvent.type.toUpperCase());\n    let adError = adEvent.getError();\n    // if this is autoplay or user already requested play then next promise will handle reset\n    if (this._nextPromise) {\n      //ads playing on same video tag wait to ima to end the source replacement\n      if (this.playOnMainVideoTag() && this.player.env.os.name !== 'iOS') {\n        setTimeout(\n          () => {\n            this._nextPromise.reject(adError);\n          },\n          0,\n          adError\n        );\n      } else {\n        this._nextPromise.reject(adError);\n      }\n    } else {\n      this.reset();\n      state = State.DONE;\n    }\n    this.dispatchEvent('aderror', getAdError.call(this, adError, true));\n  }\n  return state;\n}\n\n/**\n * SKIPPED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdSkipped(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * SKIPPABLE_STATE_CHANGED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdCanSkip(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  if (this._adsManager.getAdSkippableState()) {\n    this.dispatchEvent(options.transition);\n  }\n}\n\n/**\n * AD_PROGRESS event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdProgress(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  const remainingTime = this._adsManager.getRemainingTime();\n  const duration = adEvent.getAdData() && adEvent.getAdData().duration;\n  let currentTime = duration - remainingTime;\n  currentTime = currentTime < 0 ? 0 : currentTime;\n  if (Utils.Number.isNumber(duration) && Utils.Number.isNumber(currentTime)) {\n    this.dispatchEvent(options.transition, {\n      adProgress: {\n        currentTime: currentTime,\n        duration: duration\n      }\n    });\n  }\n}\n\n/**\n * General event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdEvent(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * Enter state handler.\n * @param {Object} options - fsm event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onEnterState(options: Object): void {\n  if (options.from !== options.to) {\n    this.logger.debug('Change state: ' + options.from + ' => ' + options.to);\n  }\n}\n\n/**\n * onPendingTransition handler\n * @param {string} transition - transition\n * @param {string} from - from\n * @param {string} to - to\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onPendingTransition(transition: string, from: string, to: string): void {\n  this.logger.warn('The previous transition is still in progress', {transition, from, to});\n}\n\n/**\n * Gets the ad error object.\n * @param {any} adError - The ima ad error object.\n * @param {boolean} fatal - Whether the error is fatal.\n * @returns {Error} - The ad error object.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdError(adError: any, fatal: boolean): Error {\n  const severity = fatal ? Error.Severity.CRITICAL : Error.Severity.RECOVERABLE;\n  const category = Error.Category.ADS;\n  let code;\n  try {\n    if (adError.getVastErrorCode() !== 900) {\n      code = parseInt(Error.Category.ADS + adError.getVastErrorCode());\n    } else {\n      code = Error.Code.AD_UNDEFINED_ERROR;\n    }\n  } catch (e) {\n    code = Error.Code.AD_UNDEFINED_ERROR;\n  }\n  let ad;\n  if (this._adsManager) {\n    try {\n      const currentAd = this._adsManager.getCurrentAd();\n      const adEvent = {getAd: () => currentAd, getAdData: () => undefined};\n      const adOptions = getAdOptions.call(this, adEvent);\n      ad = new Ad(currentAd.getAdId(), adOptions);\n    } catch (e) {\n      //do nothing\n    }\n  }\n  return new Error(severity, category, code, {\n    ad,\n    innerError: adError\n  });\n}\n\n/**\n * Gets the ad options.\n * @param {any} adEvent - The ima ad event object.\n * @returns {Object} - The ad options.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdOptions(adEvent: any): Object {\n  const adOptions = {};\n  const ad = adEvent.getAd();\n  const adData = adEvent.getAdData();\n  const podInfo = ad.getAdPodInfo();\n  if (adData) {\n    // vpaid field exists on AD_LOADED but not on AD_STARTED\n    this._isVpaid = adData.vpaid;\n  }\n  adOptions.system = ad.getAdSystem();\n  adOptions.url = ad.getMediaUrl();\n  adOptions.clickThroughUrl = adData && adData.clickThroughUrl;\n  adOptions.contentType = ad.getContentType();\n  adOptions.duration = ad.getDuration();\n  adOptions.position = this._adPosition || podInfo.getAdPosition();\n  adOptions.title = ad.getTitle();\n  adOptions.linear = ad.isLinear();\n  adOptions.skipOffset = ad.getSkipTimeOffset();\n  adOptions.width = ad.isLinear() ? ad.getVastMediaWidth() : ad.getWidth();\n  adOptions.height = ad.isLinear() ? ad.getVastMediaHeight() : ad.getHeight();\n  adOptions.bitrate = ad.getVastMediaBitrate();\n  adOptions.bumper = podInfo.getIsBumper() || this._isBumper;\n  adOptions.vpaid = this._isVpaid;\n  return adOptions;\n}\n\n/**\n * Gets the ad break options.\n * @param {any} adEvent - The ima ad event object.\n * @returns {Object} - The ad break options.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdBreakOptions(adEvent: any): Object {\n  const adBreakOptions = {};\n  adBreakOptions.numAds = this._podLength || adEvent.getAd().getAdPodInfo().getTotalAds();\n  adBreakOptions.position = this.player.ended ? -1 : this.player.currentTime;\n  adBreakOptions.type = getAdBreakType.call(this, adEvent);\n  return adBreakOptions;\n}\n\n/**\n * Gets the ad break type.\n * @param {any} adEvent - The ima ad event object.\n * @returns {string} - The ad break type.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdBreakType(adEvent: any): string {\n  try {\n    const ad = adEvent.getAd();\n    if (!ad.isLinear()) {\n      return AdBreakType.OVERLAY;\n    }\n  } catch (e) {\n    // do nothing\n  }\n  if (this._playAdByConfig()) {\n    return getAdBreakTypeFromSdk(adEvent);\n  } else {\n    return this._getAdBreakTypeFromPlayer();\n  }\n}\n\n/**\n * Gets the ad break type from ima sdk.\n * @param {any} adEvent - The ima ad event object.\n * @returns {string} - The ad break type.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdBreakTypeFromSdk(adEvent: any): string {\n  const ad = adEvent.getAd();\n  const podInfo = ad.getAdPodInfo();\n  const podIndex = podInfo.getPodIndex();\n  if (!ad.isLinear()) {\n    return AdBreakType.OVERLAY;\n  }\n  switch (podIndex) {\n    case 0:\n      return AdBreakType.PRE;\n    case -1:\n      return AdBreakType.POST;\n    default:\n      return AdBreakType.MID;\n  }\n}\n\nexport {ImaStateMachine};\n","// @flow\nimport {core} from 'kaltura-player-js';\nimport {Ima} from './ima';\n\nconst {FakeEvent} = core;\n\n/**\n * Engine decorator for ima plugin.\n * @class ImaEngineDecorator\n * @param {IEngine} engine - The HTML5 engine.\n * @param {Ima} plugin - The ima plugin.\n * @implements {IEngineDecorator}\n */\nclass ImaEngineDecorator implements IEngineDecorator {\n  _plugin: Ima;\n\n  constructor(engine: IEngine, plugin: Ima) {\n    this._plugin = plugin;\n  }\n\n  get active(): boolean {\n    return this._plugin.playOnMainVideoTag() && this._plugin.isAdPlaying();\n  }\n\n  dispatchEvent(event: FakeEvent): boolean {\n    return event.defaultPrevented;\n  }\n  /**\n   * Get paused state.\n   * @returns {boolean} - The paused value of the engine.\n   * @public\n   * @override\n   * @instance\n   * @memberof ImaEngineDecorator\n   */\n  get paused(): boolean {\n    return true;\n  }\n  /**\n   * Get the current time in seconds.\n   * @returns {number} - The current playback time.\n   * @public\n   * @override\n   * @instance\n   * @memberof ImaEngineDecorator\n   */\n  get currentTime(): number {\n    return this._plugin.getContentTime();\n  }\n  /**\n   * Set the current time in seconds.\n   * @param {number} to - The number to set in seconds.\n   * @public\n   * @returns {void}\n   */\n  set currentTime(to: number): void {\n    // Do nothing\n  }\n  /**\n   * Get the duration in seconds.\n   * @returns {number} - The playback duration.\n   * @public\n   * @override\n   * @instance\n   * @memberof ImaEngineDecorator\n   */\n  get duration(): number {\n    return this._plugin.getContentDuration();\n  }\n  /**\n   * Get ended state\n   * @returns {boolean} - media ended\n   * @public\n   * @override\n   * @instance\n   * @memberof ImaEngineDecorator\n   */\n  get ended(): boolean {\n    return this._plugin.getContentEnded();\n  }\n}\n\nexport {ImaEngineDecorator};\n","// @flow\nimport {core, BasePlugin} from 'kaltura-player-js';\nimport {ImaMiddleware} from './ima-middleware';\nimport {ImaAdsController} from './ima-ads-controller';\nimport {ImaStateMachine} from './ima-state-machine';\nimport {State} from './state';\nimport './assets/style.css';\nimport {ImaEngineDecorator} from './ima-engine-decorator';\n\nconst {BaseMiddleware, EngineType, Error, getCapabilities, Utils, Env, AudioTrack, TextTrack, EventManager, AdBreakType} = core;\n\n/**\n * The full screen events..\n * @type {Array<string>}\n * @const\n * @private\n */\nconst FULL_SCREEN_EVENTS: Array<string> = ['fullscreenchange', 'mozfullscreenchange', 'webkitfullscreenchange'];\n\n/**\n * The overlay ad margin.\n * @type {number}\n * @const\n * @private\n */\nconst OVERLAY_AD_MARGIN: number = 8;\n/**\n * The ads container class.\n * @type {string}\n * @const\n * @private\n */\nconst ADS_CONTAINER_CLASS: string = 'playkit-ads-container';\n/**\n * The ads cover class.\n * @type {string}\n * @const\n * @private\n */\nconst ADS_COVER_CLASS: string = 'playkit-ads-cover';\n/**\n * Flag for ima to not preload the postroll See https://developers.google.com/interactive-media-ads/docs/sdks/html5/client-side/history (3.442.0 version)\n * @type {number}\n * @const\n * @private\n */\nconst POSTROLL_PRELOAD_NONE: number = -3;\n\n/**\n * The ima plugin.\n * @class Ima\n * @param {string} name - The plugin name.\n * @param {Player} player - The player instance.\n * @param {ImaConfigObject} config - The plugin config.\n * @implements {IMiddlewareProvider}\n * @implements {IAdsControllerProvider}\n * @implements {IEngineDecoratorProvider}\n * @extends BasePlugin\n */\nclass Ima extends BasePlugin implements IMiddlewareProvider, IAdsControllerProvider, IEngineDecoratorProvider {\n  /**\n   * The default configuration of the plugin.\n   * @type {Object}\n   * @static\n   * @memberof Ima\n   */\n  static defaultConfig: Object = {\n    debug: false,\n    delayInitUntilSourceSelected: Env.os.name === 'iOS',\n    disableMediaPreload: false,\n    forceReloadMediaAfterAds: false,\n    showAdBreakCuePoint: false,\n    adBreakCuePointStyle: null,\n    adsRenderingSettings: {\n      restoreCustomPlaybackStateOnAdBreakComplete: false,\n      enablePreloading: false,\n      useStyledLinearAds: false,\n      useStyledNonLinearAds: true,\n      bitrate: -1,\n      autoAlign: true,\n      loadVideoTimeout: -1\n    },\n    companions: {\n      ads: null,\n      sizeCriteria: 'SELECT_EXACT_MATCH'\n    }\n  };\n\n  /**\n   * The sdk lib url.\n   * @type {string}\n   * @static\n   * @private\n   * @memberof Ima\n   */\n  static IMA_SDK_LIB_URL: string = '//imasdk.googleapis.com/js/sdkloader/ima3.js';\n  /**\n   * The debug sdk lib url.\n   * @type {string}\n   * @static\n   * @private\n   * @memberof Ima\n   */\n  static IMA_SDK_DEBUG_LIB_URL: string = '//imasdk.googleapis.com/js/sdkloader/ima3_debug.js';\n  /**\n   * Promise for loading the plugin.\n   * Will be resolved after:\n   * 1) Ima script has been loaded in the page.\n   * 2) The ads manager has been loaded and ready to start.\n   * @type {Promise<*>}\n   * @member\n   * @public\n   * @memberof Ima\n   */\n  loadPromise: DeferredPromise;\n  /**\n   * The finite state machine of the plugin.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _stateMachine: any;\n  /**\n   * The sdk api.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _sdk: any;\n  /**\n   * The ads container dom element.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _adsContainerDiv: HTMLElement;\n  /**\n   * The ads cover dom element.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _adsCoverDiv: HTMLElement;\n  /**\n   * The ima ads container object.\n   * @private\n   * @memberof Ima\n   */\n  _adDisplayContainer: any;\n  /**\n   * The ima ads manager.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _adsManager: any;\n  /**\n   * The ima ads loader.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _adsLoader: any;\n  /**\n   * The content tracker.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _contentPlayheadTracker: Object;\n  /**\n   * Flag to know when content complete.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _contentComplete: boolean;\n  /**\n   * Video current time before ads.\n   * On custom playback when only one video tag playing, save the video current time.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _videoLastCurrentTime: ?number;\n  /**\n   * The promise which when resolved starts the next handler in the middleware chain.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _nextPromise: ?DeferredPromise;\n  /**\n   * The current playing ad.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _currentAd: any;\n  /**\n   * The content media duration.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _contentDuration: ?number;\n  /**\n   * The content media src.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _contentSrc: string;\n\n  /**\n   * Whether an initial user action happened.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _hasUserAction: boolean;\n  /**\n   * Whether the ads manager loaded.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _isAdsManagerLoaded: boolean;\n  /**\n   * The bounded handler of the ads container click.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _togglePlayPauseOnAdsContainerCallback: ?Function;\n  /**\n   * Whether the ads cover overlay is active.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _isAdsCoverActive: boolean;\n  _selectedAudioTrack: ?AudioTrack;\n  _selectedTextTrack: ?TextTrack;\n  _selectedPlaybackRate: number;\n  _textTracksHidden: Array<string>;\n  _adBreaksEventManager: EventManager;\n  _podLength: number;\n  _adPosition: number;\n  _firstOfAdPod: boolean;\n  _waterfalled: boolean;\n  _isBumper: boolean;\n  _isVpaid: boolean;\n  _adVideoTagAlreadyPlayed: boolean = false;\n\n  /**\n   * Whether the ima plugin is valid.\n   * @static\n   * @override\n   * @public\n   * @memberof Ima\n   */\n  static isValid() {\n    return true;\n  }\n\n  constructor(name: string, player: KalturaPlayer, config: Object) {\n    super(name, player, config);\n    this._stateMachine = new ImaStateMachine(this);\n    this._initMembers();\n    this._init();\n  }\n\n  /**\n   * Gets the engine decorator.\n   * @param {IEngine} engine - The engine to decorate.\n   * @public\n   * @returns {IEngineDecorator} - The ads api.\n   * @instance\n   * @memberof Ima\n   */\n  getEngineDecorator(engine: IEngine): IEngineDecorator {\n    return new ImaEngineDecorator(engine, this);\n  }\n\n  /**\n   * Gets the middleware.\n   * @public\n   * @returns {ImaMiddleware} - The middleware api.\n   * @instance\n   * @memberof Ima\n   */\n  getMiddlewareImpl(): BaseMiddleware {\n    return new ImaMiddleware(this);\n  }\n\n  /**\n   * Gets the ads controller.\n   * @public\n   * @returns {IAdsPluginController} - The ads api.\n   * @instance\n   * @memberof Ima\n   */\n  getAdsController(): IAdsPluginController {\n    return new ImaAdsController(this);\n  }\n\n  /**\n   * Plays ad on demand\n   * @param {KPAdPod} adPod - The ad pod to play.\n   * @returns {void}\n   * @public\n   * @instance\n   * @memberof Ima\n   */\n  playAdNow(adPod: KPAdPod): void {\n    if (Array.isArray(adPod) && !(this.isAdPlaying() || this._playAdByConfig())) {\n      this._playAdBreak(adPod);\n    }\n  }\n\n  _playAdBreak(adPod: KPAdPod): void {\n    this._podLength = adPod.length;\n    this._adPosition = 1;\n    this._firstOfAdPod = true;\n    this._waterfalled = false;\n    this.loadPromise\n      .then(() => {\n        this._playAd(adPod);\n        if (!this._hasUserAction && this.player.currentTime > 0) {\n          this.initialUserAction();\n        }\n      })\n      .catch(() => {});\n  }\n\n  _playAd(adPod: KPAdPod): void {\n    const ad = adPod[0];\n    const playNext = () => {\n      adPod.shift();\n      this._adBreaksEventManager.removeAll();\n      this._waterfalled = false;\n      this._podLength = adPod.length;\n      this._adPosition++;\n      this._playAd(adPod);\n    };\n    const waterfall = error => {\n      this.dispatchEvent(this.player.Event.AD_WATERFALLING, {\n        adFailed: {\n          url: ad.url ? ad.url[0] : '',\n          response: !ad.url && ad.response ? ad.response[0] : '',\n          data: error,\n          adBreak: this._getAdBreakTypeFromPlayer(),\n          position: this._adPosition\n        }\n      });\n      this._adBreaksEventManager.removeAll();\n      this._waterfalled = true;\n      ad.url ? ad.url.shift() : ad.response && ad.response.shift();\n      this._playAd(adPod);\n    };\n    const onError = error => {\n      if ((ad.url && ad.url.length > 1) || (!ad.url && ad.response && ad.response.length > 1)) {\n        waterfall(error);\n      } else {\n        if (this._waterfalled) {\n          this.dispatchEvent(this.player.Event.AD_WATERFALLING_FAILED);\n        }\n        this._stateMachine.adlog(error);\n        playNext();\n      }\n    };\n    if (ad) {\n      this._adBreaksEventManager.listen(this._adsLoader, this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, () => {\n        this._adBreaksEventManager.listen(this._adsManager, this._sdk.AdEvent.Type.COMPLETE, playNext);\n        this._adBreaksEventManager.listen(this._adsManager, this._sdk.AdEvent.Type.SKIPPED, playNext);\n        this._adBreaksEventManager.listen(this._adsManager, this._sdk.AdEvent.Type.LOG, onError);\n        this._adBreaksEventManager.listen(this._adsManager, this._sdk.AdErrorEvent.Type.AD_ERROR, onError);\n      });\n      this._adBreaksEventManager.listen(this._adsLoader, this._sdk.AdErrorEvent.Type.AD_ERROR, error => {\n        onError(error);\n        if (this._podLength === 0) {\n          if (this.player.ads.isAdBreak()) {\n            this._stateMachine.adbreakend({type: this._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED});\n          }\n          if (this._hasUserAction) {\n            this._stateMachine.adscompleted({type: this._sdk.AdEvent.Type.ALL_ADS_COMPLETED});\n          } else {\n            this.eventManager.listen(this.player, this.player.Event.FIRST_PLAY, () => {\n              this._stateMachine.adscompleted({type: this._sdk.AdEvent.Type.ALL_ADS_COMPLETED});\n            });\n          }\n        }\n      });\n      this._isBumper = !!ad.bumper;\n      this._requestAds(ad.url && ad.url[0], ad.response && ad.response[0]);\n    }\n  }\n\n  _getAdBreakTypeFromPlayer(): string {\n    if (this.player.ended) {\n      return AdBreakType.POST;\n    }\n    if (this.player.currentTime > 0) {\n      return AdBreakType.MID;\n    }\n    return AdBreakType.PRE;\n  }\n\n  /**\n   * Skips on an ad.\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  skipAd(): void {\n    this.logger.debug('Skip ad');\n    if (this._adsManager) {\n      if (this._adsManager.getAdSkippableState()) {\n        this._adsManager.skip();\n      } else if (this.config.skipSupport) {\n        this._adsManager.stop();\n      }\n    }\n  }\n\n  /**\n   * Resuming the ad.\n   * @public\n   * @returns {DeferredPromise} - The promise which when resolved starts the next handler in the middleware chain.\n   * @instance\n   * @memberof Ima\n   */\n  resumeAd(): ?DeferredPromise {\n    this.logger.debug('Resume ad');\n    this._nextPromise = Utils.Object.defer();\n    this._adsManager.resume();\n    return this._nextPromise;\n  }\n\n  /**\n   * Pausing the ad.\n   * @public\n   * @returns {DeferredPromise} - The promise which when resolved starts the next handler in the middleware chain.\n   * @instance\n   * @memberof Ima\n   */\n  pauseAd(): ?DeferredPromise {\n    this.logger.debug('Pause ad');\n    this._adsManager.pause();\n  }\n\n  /**\n   * Gets the state machine.\n   * @public\n   * @returns {any} - The state machine.\n   * @instance\n   * @memberof Ima\n   */\n  getStateMachine(): any {\n    return this._stateMachine;\n  }\n\n  /**\n   * Gets the indicator if ads playing on the main video tag\n   * @public\n   * @returns {boolean} - if ads playing on the main video tag.\n   * @instance\n   * @memberof Ima\n   */\n  playOnMainVideoTag() {\n    return !!this._adsManager && !!this._adsManager.isCustomPlaybackUsed();\n  }\n\n  /**\n   * Gets the indicator if ads still playing.\n   * @public\n   * @returns {boolean} - if ads still playing.\n   * @instance\n   * @memberof Ima\n   */\n  isAdPlaying(): boolean {\n    return this._stateMachine.is(State.PLAYING) || this._stateMachine.is(State.PENDING) || this._stateMachine.is(State.PAUSED);\n  }\n\n  getContentTime(): number {\n    let currentTime = 0;\n    //current time exist for mid-roll otherwise it's pre-roll(start of video - 0) - post-roll(end of video)\n    if (this._videoLastCurrentTime) {\n      currentTime = this._videoLastCurrentTime;\n    } else if (this._contentComplete) {\n      currentTime = this.getContentDuration();\n    }\n    return currentTime;\n  }\n\n  getContentDuration(): number {\n    return this._contentDuration || this.player.config.sources.duration || 0;\n  }\n\n  getContentSrc(): string {\n    return this._contentSrc || '';\n  }\n  getContentEnded(): boolean {\n    return this._contentComplete;\n  }\n  /**\n   * Prepare the plugin before media is loaded.\n   * @override\n   * @public\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  loadMedia(): void {\n    this._addBindings();\n    this.loadPromise.then(() => {\n      if (!this._adDisplayContainer) {\n        this._adDisplayContainer = new this._sdk.AdDisplayContainer(this._adsContainerDiv, this.player.getVideoElement());\n      }\n      if (!this._adsLoader) {\n        this._initAdsLoader();\n      }\n    });\n    if (this._playAdByConfig()) {\n      this.loadPromise.then(() => this._requestAds()).catch(() => {});\n    }\n  }\n\n  /**\n   * Resets the plugin.\n   * @override\n   * @public\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  reset(): void {\n    this.logger.debug('reset');\n    this.eventManager.removeAll();\n    this._adBreaksEventManager.removeAll();\n    this._hideAdsContainer();\n    if (!this._isImaSDKLibLoaded()) {\n      return;\n    }\n    this._destroyIMAManagers();\n    this._stateMachine.goto(State.DONE);\n    this._initMembers();\n  }\n\n  /**\n   * Destroys the plugin.\n   * @override\n   * @public\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  destroy(): void {\n    this.logger.debug('destroy');\n    this.eventManager.destroy();\n    this._hideAdsContainer();\n    this._destroyIMAManagers();\n  }\n\n  _destroyIMAManagers(): void {\n    if (this._adsManager) {\n      this._adsManager.destroy();\n    }\n    if (this._adsLoader) {\n      this._adsLoader.destroy();\n      this._adsLoader = null;\n    }\n    if (this._adDisplayContainer) {\n      this._adDisplayContainer.destroy();\n      this._adDisplayContainer = null;\n    }\n  }\n\n  /**\n   * Initialize the ads for the first time.\n   * @public\n   * @returns {?DeferredPromise} - The promise which when resolved starts the next handler in the middleware chain.\n   * @instance\n   * @memberof Ima\n   */\n  initialUserAction(): ?DeferredPromise {\n    try {\n      this.logger.debug('Initial user action');\n      this._nextPromise = Utils.Object.defer();\n      this._adDisplayContainer.initialize();\n      this._hasUserAction = true;\n      if (this._isAdsManagerLoaded) {\n        this.logger.debug('User action occurred after ads manager loaded');\n        this._startAdsManager();\n      }\n    } catch (adError) {\n      this.logger.error(adError);\n      this.reset();\n    }\n    return this._nextPromise;\n  }\n\n  /**\n   * Starts the ads manager.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _startAdsManager(): void {\n    this.logger.debug('Start ads manager');\n    const readyPromise = this.playOnMainVideoTag() && !this.config.disableMediaPreload ? this.player.ready() : Promise.resolve();\n    readyPromise.then(() => {\n      this._adsManager.init(this.player.dimensions.width, this.player.dimensions.height, this._sdk.ViewMode.NORMAL);\n      this._adsManager.start();\n    });\n  }\n\n  /**\n   * Adding bindings.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _addBindings(): void {\n    FULL_SCREEN_EVENTS.forEach(fullScreenEvent => this.eventManager.listen(document, fullScreenEvent, () => this._resizeAd()));\n    this.eventManager.listen(this.player, 'resize', () => this._resizeAd());\n    this.eventManager.listen(this.player, this.player.Event.MUTE_CHANGE, () => this._syncPlayerVolume());\n    this.eventManager.listen(this.player, this.player.Event.VOLUME_CHANGE, () => this._syncPlayerVolume());\n    this.eventManager.listen(this.player, this.player.Event.SOURCE_SELECTED, event => {\n      let selectedSource = event.payload.selectedSource;\n      if (selectedSource && selectedSource.length > 0) {\n        this._contentSrc = selectedSource[0].url;\n      }\n    });\n    this.eventManager.listenOnce(this.player, this.player.Event.DURATION_CHANGE, () => {\n      this._contentDuration = this.player.duration;\n    });\n    this.eventManager.listen(this.player, this.player.Event.ERROR, event => {\n      if (event.payload && event.payload.severity === Error.Severity.CRITICAL) {\n        this.reset();\n      }\n    });\n    this.eventManager.listen(this.player, this.player.Event.FIRST_PLAY, () => {\n      if (this._currentAd && !this._currentAd.isLinear()) {\n        this._showAdsContainer();\n      }\n    });\n    this.eventManager.listen(this.player, this.player.Event.MEDIA_LOADED, () => {\n      this._adsManager.updateAdsRenderingSettings({\n        restoreCustomPlaybackStateOnAdBreakComplete: !this.player.config.playback.playAdsWithMSE\n      });\n    });\n    this.eventManager.listen(this.player, this.player.Event.ENDED, () => this._onMediaEnded());\n    this.eventManager.listen(this.player, this.player.Event.LOADED_METADATA, () => this._onLoadedMetadata());\n    this.eventManager.listen(this.player, this.player.Event.TIME_UPDATE, () => this._onMediaTimeUpdate());\n    this.eventManager.listen(this.player, this.player.Event.SEEKING, () => this._onMediaSeeking());\n    this.eventManager.listen(this.player, this.player.Event.SEEKED, () => this._onMediaSeeked());\n    if (!this._playAdByConfig()) {\n      this.eventManager.listenOnce(this.player, this.player.Event.USER_GESTURE, () => {\n        if (!this._adVideoTagAlreadyPlayed) {\n          this._adDisplayContainer.initialize();\n        }\n      });\n    }\n  }\n\n  /**\n   * Init the members of the plugin.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _initMembers(): void {\n    this._nextPromise = null;\n    this._currentAd = null;\n    this._adsManager = null;\n    this._contentComplete = false;\n    this._isAdsManagerLoaded = false;\n    this._videoLastCurrentTime = null;\n    this._contentPlayheadTracker = {currentTime: 0, previousTime: 0, seeking: false, duration: 0};\n    this._hasUserAction = false;\n    this._togglePlayPauseOnAdsContainerCallback = null;\n    this._contentDuration = null;\n    this._selectedAudioTrack = null;\n    this._selectedTextTrack = null;\n    this._selectedPlaybackRate = 1;\n    this._textTracksHidden = [];\n    this._adBreaksEventManager = new EventManager();\n    this._podLength = 0;\n    this._adPosition = 0;\n    this._firstOfAdPod = false;\n    this._waterfalled = false;\n    this._isBumper = false;\n    this._isVpaid = false;\n  }\n\n  /**\n   * Initializing the plugin.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _init(): void {\n    this.loadPromise = Utils.Object.defer();\n    this._maybeDelayInitUntilSourceSelected()\n      .then(() => this._loadImaSDKLib())\n      .then(() => {\n        this._sdk = window.google.ima;\n        this.logger.debug('IMA SDK version: ' + this._sdk.VERSION);\n        this._initImaSettings();\n        this._initAdsContainer();\n        this._initAdsLoader();\n        this.loadPromise.resolve();\n      })\n      .catch(e => {\n        this.loadPromise.reject(e);\n      });\n  }\n\n  /**\n   * If configured, wait until source selected before will continue the initialization of the plugin.\n   * @returns {Promise<*>} -\n   * @private\n   * @instance\n   * @memberof Ima\n   */\n  _maybeDelayInitUntilSourceSelected(): Promise<*> {\n    if (this.config.delayInitUntilSourceSelected) {\n      return new Promise((resolve, reject) => {\n        if (this._contentSrc) {\n          // Source selected event already dispatched\n          resolve();\n        } else {\n          this.eventManager.listenOnce(this.player, this.player.Event.SOURCE_SELECTED, resolve);\n          this.eventManager.listenOnce(this.player, this.player.Event.ERROR, error => {\n            if (error.payload.severity === Error.Severity.CRITICAL) {\n              reject(error);\n            }\n          });\n        }\n      });\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  /**\n   * Loads the ima sdk lib.\n   * @returns {Promise<*>} - The promise result for the load operation.\n   * @private\n   * @instance\n   * @memberof Ima\n   */\n  _loadImaSDKLib(): Promise<*> {\n    const imaSdkUrl = Utils.Http.protocol + (this.config.debug ? Ima.IMA_SDK_DEBUG_LIB_URL : Ima.IMA_SDK_LIB_URL);\n    return this._isImaSDKLibLoaded() ? Promise.resolve() : Utils.Dom.loadScriptAsync(imaSdkUrl);\n  }\n\n  /**\n   * Checks for ima sdk lib availability.\n   * @returns {boolean} - Whether ima sdk lib is loaded.\n   * @private\n   * @instance\n   * @memberof Ima\n   */\n  _isImaSDKLibLoaded(): boolean {\n    return window.google && window.google.ima && window.google.ima.VERSION;\n  }\n\n  /**\n   * Init ima settings.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _initImaSettings(): void {\n    this._sdk.settings.setPlayerType(this.config.playerName);\n    this._sdk.settings.setPlayerVersion(this.config.playerVersion);\n    this._sdk.settings.setVpaidAllowed(true);\n    this._sdk.settings.setVpaidMode(this._getVpaidMode());\n    if (Object.prototype.hasOwnProperty.call(this.config, 'locale')) {\n      this._sdk.settings.setLocale(this.config.locale);\n    }\n    if (typeof this.config.setDisableCustomPlaybackForIOS10Plus === 'boolean') {\n      this._sdk.settings.setDisableCustomPlaybackForIOS10Plus(this.config.setDisableCustomPlaybackForIOS10Plus);\n    } else {\n      this._sdk.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playback.playsinline);\n    }\n    if (typeof this.config.numRedirects === 'number') {\n      this._sdk.settings.setNumRedirects(this.config.numRedirects);\n    }\n  }\n\n  /**\n   * Gets the vpaid mode.\n   * @private\n   * @returns {number} - The vpaid mode.\n   * @instance\n   * @memberof Ima\n   */\n  _getVpaidMode(): number {\n    const vpaidmode = this._sdk.ImaSdkSettings.VpaidMode[this.config.vpaidMode];\n    if (this.config.vpaidMode && typeof vpaidmode === 'number') {\n      this.logger.debug('VpaidMode: set to ' + this.config.vpaidMode);\n      return vpaidmode;\n    } else {\n      this.logger.warn('VpaidMode is not set, setting to ENABLED');\n      return this._sdk.ImaSdkSettings.VpaidMode.ENABLED;\n    }\n  }\n\n  /**\n   * Initializing the ad container.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _initAdsContainer(): void {\n    this.logger.debug('Init ads container');\n    const playerView = this.player.getView();\n    // Create ads container\n    this._adsContainerDiv = Utils.Dom.createElement('div');\n    this._adsContainerDiv.id = ADS_CONTAINER_CLASS + playerView.id;\n    this._adsContainerDiv.className = ADS_CONTAINER_CLASS;\n\n    // Create ads cover\n    this._adsCoverDiv = Utils.Dom.createElement('div');\n    this._adsCoverDiv.id = ADS_COVER_CLASS + playerView.id;\n    this._adsCoverDiv.className = ADS_COVER_CLASS;\n    this._adsCoverDiv.onclick = () => this._onAdsCoverClicked();\n    // Append the ads container to the dom\n    Utils.Dom.appendChild(playerView, this._adsContainerDiv);\n    this._adDisplayContainer = new this._sdk.AdDisplayContainer(this._adsContainerDiv, this.player.getVideoElement());\n  }\n\n  /**\n   * Initializing the ads loader.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _initAdsLoader(): void {\n    this.logger.debug('Init ads loader');\n    this._adsLoader = new this._sdk.AdsLoader(this._adDisplayContainer);\n    this._adsLoader.addEventListener(this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, adsManagerLoadedEvent =>\n      this._onAdsManagerLoaded(adsManagerLoadedEvent)\n    );\n    this._adsLoader.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR, adEvent => this._stateMachine.aderror(adEvent));\n  }\n\n  /**\n   * Requests the ads from the ads loader.\n   * @param {?string} vastUrl - vast url.\n   * @param {?string} vastResponse - vast XML response.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _requestAds(vastUrl: ?string, vastResponse: ?string): void {\n    if (vastUrl || vastResponse || this._playAdByConfig()) {\n      this.logger.debug('Request ads');\n      // Request video ads\n      let adsRequest = new this._sdk.AdsRequest();\n      const adTagUrl = vastUrl || this.config.adTagUrl;\n      if (adTagUrl) {\n        adsRequest.adTagUrl = adTagUrl;\n      } else {\n        adsRequest.adsResponse = vastResponse || this.config.adsResponse;\n      }\n      if (typeof this.config.vastLoadTimeout === 'number') {\n        adsRequest.vastLoadTimeout = this.config.vastLoadTimeout;\n      }\n      adsRequest.linearAdSlotWidth = this.player.dimensions.width;\n      adsRequest.linearAdSlotHeight = this.player.dimensions.height;\n      adsRequest.nonLinearAdSlotWidth = this.player.dimensions.width;\n      adsRequest.nonLinearAdSlotHeight = this.player.dimensions.height / 3;\n      adsRequest.contentDuration = POSTROLL_PRELOAD_NONE;\n\n      const muted = this.player.muted || this.player.volume === 0;\n      adsRequest.setAdWillPlayMuted(muted);\n\n      const adWillAutoPlay = this.config.adWillAutoPlay;\n      const playerWillAutoPlay = this.player.config.playback.autoplay;\n      const allowMutedAutoPlay = this.player.config.playback.allowMutedAutoPlay;\n\n      // Pass signal to IMA SDK if ad will autoplay with sound\n      // First let application config this, otherwise if player is configured\n      // to autoplay then try to autodetect if unmuted autoplay is supported\n      if (typeof adWillAutoPlay === 'boolean') {\n        adsRequest.setAdWillAutoPlay(adWillAutoPlay);\n        this._adsLoader.requestAds(adsRequest);\n      } else if (playerWillAutoPlay) {\n        getCapabilities(EngineType.HTML5).then(capabilities => {\n          // If the plugin has been destroyed while calling this promise\n          // the adsLoader will no longer exists\n          if (!this._adsLoader) return;\n\n          if (capabilities.autoplay) {\n            adsRequest.setAdWillAutoPlay(true);\n          } else if (allowMutedAutoPlay && capabilities.mutedAutoPlay) {\n            adsRequest.setAdWillAutoPlay(true);\n            adsRequest.setAdWillPlayMuted(true);\n          } else {\n            adsRequest.setAdWillAutoPlay(false);\n          }\n          this._adsLoader.requestAds(adsRequest);\n        });\n      } else {\n        adsRequest.setAdWillAutoPlay(false);\n        this._adsLoader.requestAds(adsRequest);\n      }\n      this._stateMachine.loaded();\n    } else {\n      this._stateMachine.goto(State.DONE);\n      this.logger.debug('Missing ad tag url: create plugin without requesting ads');\n    }\n  }\n\n  /**\n   * Resize event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _resizeAd() {\n    if (this._sdk && this._adsManager && this._currentAd) {\n      let viewMode = this.player.isFullscreen() ? this._sdk.ViewMode.FULLSCREEN : this._sdk.ViewMode.NORMAL;\n      if (this._currentAd.isLinear()) {\n        this._adsManager.resize(this.player.dimensions.width, this.player.dimensions.height, viewMode);\n      } else {\n        const adTotalWidth = this._currentAd.getWidth() + OVERLAY_AD_MARGIN;\n        const adTotalHeight = this._currentAd.getHeight() + OVERLAY_AD_MARGIN;\n        if (adTotalWidth <= this.player.dimensions.width && adTotalHeight <= this.player.dimensions.height) {\n          this._alignAdsContainerSizeForOverlayAd();\n          this._adsManager.resize(adTotalWidth, adTotalHeight, viewMode);\n          this._showAdsContainer();\n        } else {\n          this._hideAdsContainer();\n        }\n      }\n    }\n  }\n\n  /**\n   * Align the size for the ads container when overlay ad is displaying.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _alignAdsContainerSizeForOverlayAd(): void {\n    this._adsContainerDiv.style.bottom = this._currentAd.getHeight() + OVERLAY_AD_MARGIN + 'px';\n    this._adsContainerDiv.style.left = (this.player.dimensions.width - this._currentAd.getWidth()) / 2 + 'px';\n  }\n\n  /**\n   * Loadedmetada event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   * @instance\n   * @memberof Ima\n   */\n  _onLoadedMetadata(): void {\n    this._contentPlayheadTracker.duration = this.player.duration;\n  }\n\n  /**\n   * Timeupdate event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onMediaTimeUpdate(): void {\n    if (!this._contentPlayheadTracker.seeking && this.player.currentTime > 0) {\n      this._contentPlayheadTracker.previousTime = this._contentPlayheadTracker.currentTime;\n      this._contentPlayheadTracker.currentTime = this.player.currentTime;\n    }\n  }\n\n  /**\n   * Seeking event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onMediaSeeking(): void {\n    this._contentPlayheadTracker.seeking = true;\n  }\n\n  /**\n   * Seeked event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onMediaSeeked(): void {\n    this._contentPlayheadTracker.seeking = false;\n  }\n\n  /**\n   * Maybe save the video current time before ads starts (on ios this is necessary).\n   * @private\n   * @return {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeSaveVideoCurrentTime(): void {\n    if ((this.playOnMainVideoTag() || this.config.forceReloadMediaAfterAds) && this.player.currentTime && this.player.currentTime > 0) {\n      this.logger.debug('Custom playback used: save current time before ads', this.player.currentTime);\n      this._videoLastCurrentTime = this.player.currentTime;\n    }\n  }\n\n  /**\n   * Maybe sets the video current time after ads finished (on ios this is necessary).\n   * @private\n   * @return {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeSetVideoCurrentTime(): void {\n    if (this._videoLastCurrentTime) {\n      this.logger.debug('Custom playback used: set current time after ads', this._videoLastCurrentTime);\n      this.player.currentTime = this._videoLastCurrentTime;\n      this._videoLastCurrentTime = null;\n    }\n  }\n\n  _hasPostRoll(): boolean {\n    return this._adsManager && this._adsManager.getCuePoints().includes(-1);\n  }\n\n  /**\n   * Ended event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onMediaEnded(): void {\n    this.logger.debug('Media ended');\n    this._contentComplete = true;\n    if (this._currentAd && !this._currentAd.isLinear()) {\n      this.reset();\n    } else if (!this._hasPostRoll()) {\n      this._stateMachine.goto(State.DONE);\n    }\n  }\n\n  /**\n   * Ended event handler.\n   * @public\n   * @returns {Promise<void>} - complete promise\n   * @instance\n   * @memberof Ima\n   */\n  onPlaybackEnded(): Promise<void> {\n    this.logger.debug('Playback ended');\n    if (this._adsLoader) {\n      this._adsLoader.contentComplete();\n    }\n    if (this._hasPostRoll()) {\n      return new Promise(resolve => {\n        this.eventManager.listenOnce(this._adsManager, this._sdk.AdEvent.Type.ALL_ADS_COMPLETED, () => {\n          resolve();\n        });\n      });\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * Shows the ads container.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _showAdsContainer(): void {\n    if (this._adsContainerDiv) {\n      this._adsContainerDiv.style.visibility = 'visible';\n    }\n  }\n\n  /**\n   * Hides the ads container.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _hideAdsContainer(): void {\n    if (this._adsContainerDiv) {\n      this._adsContainerDiv.style.visibility = 'hidden';\n    }\n  }\n\n  /**\n   * The ads manager loaded handler.\n   * @param {any} adsManagerLoadedEvent - The event data.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onAdsManagerLoaded(adsManagerLoadedEvent: any): void {\n    this.logger.debug('Ads manager loaded');\n    const adsRenderingSettings = this._getAdsRenderingSetting();\n    this._adsManager = adsManagerLoadedEvent.getAdsManager(this._contentPlayheadTracker, adsRenderingSettings);\n    this.config.forceReloadMediaAfterAds = this.playOnMainVideoTag() ? false : this.config.forceReloadMediaAfterAds;\n    const cuePoints = [...this._adsManager.getCuePoints()];\n    if (!cuePoints.length) {\n      cuePoints.push(0);\n    }\n    if (this._playAdByConfig()) {\n      this.dispatchEvent(this.player.Event.AD_MANIFEST_LOADED, {adBreaksPosition: cuePoints});\n      if (this.player.ui.hasManager('timeline') && this.config.showAdBreakCuePoint) {\n        cuePoints.forEach(cuePoint => {\n          this.player.ui.getManager('timeline').addCuePoint({\n            time: cuePoint !== -1 ? cuePoint : Infinity,\n            ...this.config.adBreakCuePointStyle\n          });\n        });\n      }\n    }\n    this._isAdsManagerLoaded = true;\n    this._attachAdsManagerListeners();\n    this._syncPlayerVolume();\n    if (this._hasUserAction) {\n      this.logger.debug('User action occurred before ads manager loaded');\n      this._startAdsManager();\n    }\n  }\n\n  /**\n   * returns the ads rendering settings configuration for IMA with plugin config applied\n   * @returns {Object} - IMA AdsRenderingSettings object\n   * @private\n   * @instance\n   * @memberof Ima\n   */\n  _getAdsRenderingSetting(): Object {\n    let adsRenderingSettings = new this._sdk.AdsRenderingSettings();\n    Object.keys(this.config.adsRenderingSettings).forEach(setting => {\n      if (adsRenderingSettings[setting] !== undefined) {\n        adsRenderingSettings[setting] = this.config.adsRenderingSettings[setting];\n      } else {\n        this.logger.warn('unsupported adsRenderingSettings was set:', setting);\n      }\n    });\n    adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete = false;\n    if (typeof this.config.adsRenderingSettings.playAdsAfterTime !== 'number') {\n      adsRenderingSettings.playAdsAfterTime = this.player.config.sources.startTime;\n    }\n    return adsRenderingSettings;\n  }\n\n  /**\n   * Attach the ads manager listeners.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _attachAdsManagerListeners(): void {\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_PAUSE_REQUESTED, adEvent => {\n      if (this._playAdByConfig() || this._firstOfAdPod) {\n        this._firstOfAdPod = false;\n        this._stateMachine.adbreakstart(adEvent);\n      }\n    });\n\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED, adEvent => {\n      if (this._playAdByConfig() || this._podLength === 0) {\n        this._stateMachine.adbreakend(adEvent);\n      }\n    });\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.ALL_ADS_COMPLETED, adEvent => {\n      if (this._playAdByConfig() || this._podLength === 0) {\n        this._stateMachine.adscompleted(adEvent);\n      }\n    });\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOADED, adEvent => this._stateMachine.adloaded(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.STARTED, adEvent => this._stateMachine.adstarted(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.PAUSED, adEvent => this._stateMachine.adpaused(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.RESUMED, adEvent => this._stateMachine.adresumed(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.FIRST_QUARTILE, adEvent => this._stateMachine.adfirstquartile(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.MIDPOINT, adEvent => this._stateMachine.admidpoint(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.THIRD_QUARTILE, adEvent => this._stateMachine.adthirdquartile(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.CLICK, adEvent => this._stateMachine.adclicked(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.SKIPPED, adEvent => this._stateMachine.adskipped(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.COMPLETE, adEvent => this._stateMachine.adcompleted(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.USER_CLOSE, adEvent => this._stateMachine.userclosedad(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_CHANGED, adEvent => this._stateMachine.advolumechanged(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_MUTED, adEvent => this._stateMachine.admuted(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.AD_PROGRESS, adEvent => this._stateMachine.adprogress(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.AD_BUFFERING, adEvent => this._stateMachine.adbuffering(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOG, adEvent => this._stateMachine.adlog(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.SKIPPABLE_STATE_CHANGED, adEvent => this._stateMachine.adcanskip(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR, adEvent => this._stateMachine.aderror(adEvent));\n  }\n\n  /**\n   * Syncs the player volume.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _syncPlayerVolume(): void {\n    if (this._adsManager) {\n      if (this.player.muted) {\n        this._adsManager.setVolume(0);\n      } else {\n        if (this._adsManager && !isNaN(this.player.volume) && typeof this.player.volume === 'number') {\n          this._adsManager.setVolume(this.player.volume);\n        }\n      }\n    }\n  }\n\n  /**\n   * Resolves the next promise to let the next handler in the middleware chain start.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _resolveNextPromise(): void {\n    if (this._nextPromise) {\n      this._nextPromise.resolve();\n      this._nextPromise = null;\n    }\n  }\n\n  /**\n   * Toggle the ads cover div.\n   * @param {boolean} enable - Whether to add or remove the ads cover.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _setToggleAdsCover(enable: boolean): void {\n    if (enable) {\n      if (!this.playOnMainVideoTag()) {\n        if (this._adsContainerDiv.parentNode) {\n          this._adsContainerDiv.parentNode.insertBefore(this._adsCoverDiv, this._adsContainerDiv.nextSibling);\n          this._isAdsCoverActive = true;\n        }\n      }\n    } else {\n      if (this._isAdsCoverActive) {\n        if (this._adsContainerDiv.parentNode) {\n          this._adsContainerDiv.parentNode.removeChild(this._adsCoverDiv);\n          this._isAdsCoverActive = false;\n        }\n      }\n    }\n  }\n\n  /**\n   * On ads cover click handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onAdsCoverClicked(): void {\n    if (this._adsManager) {\n      switch (this._stateMachine.state) {\n        case State.PAUSED:\n          this._adsManager.resume();\n          break;\n        case State.PLAYING:\n          this._adsManager.pause();\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  /**\n   * Displays companion ads using the Ad API.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeDisplayCompanionAds(): void {\n    if (this.config.companions && this.config.companions.ads && !(window.googletag && window.googletag.cmd)) {\n      const selectionCriteria = new this._sdk.CompanionAdSelectionSettings();\n      selectionCriteria.resourceType = this._sdk.CompanionAdSelectionSettings.ResourceType.ALL;\n      selectionCriteria.creativeType = this._sdk.CompanionAdSelectionSettings.CreativeType.ALL;\n      const sizeCriteria = this.config.companions.sizeCriteria;\n      selectionCriteria.sizeCriteria =\n        this._sdk.CompanionAdSelectionSettings.SizeCriteria[sizeCriteria] || this._sdk.CompanionAdSelectionSettings.SizeCriteria.SELECT_EXACT_MATCH;\n      const companionsIds = Object.keys(this.config.companions.ads);\n      for (let i = 0; i < companionsIds.length; i++) {\n        const id = companionsIds[i];\n        const ad = this.config.companions.ads[id];\n        const width = ad.width;\n        const height = ad.height;\n        try {\n          const companionAds = this._currentAd.getCompanionAds(width, height, selectionCriteria);\n          if (companionAds.length > 0) {\n            const companionAd = companionAds[0];\n            const content = companionAd.getContent();\n            const el = Utils.Dom.getElementById(id);\n            if (el) {\n              el.innerHTML = content;\n            }\n          }\n        } catch (e) {\n          this.logger.error('Error occurred while extracting companion ad', e);\n        }\n      }\n    }\n  }\n\n  /**\n   * On Chrome-Android we're ignoring LearnMore click to enable\n   * video element manipulation only on user gesture.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeIgnoreClickOnAd(): void {\n    const isAndroid = () => this.player.env.os.name === 'Android';\n    const isChrome = () => this.player.env.browser.name === 'Chrome';\n    if (isAndroid() && isChrome()) {\n      this.eventManager.listenOnce(this.player.getView(), 'click', e => e.stopPropagation());\n    }\n  }\n\n  /**\n   * On iOS AVPlayer caption stack on video tag, should re-position to hide\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _hideActiveTextTracksOnAVPlayer(): void {\n    const isIOS = this.player.env.os.name === 'iOS';\n    if (isIOS && this.playOnMainVideoTag()) {\n      let tracks = this.player.getVideoElement().textTracks;\n      Array.from(tracks).forEach(track => {\n        if (track.mode === 'showing') {\n          Array.from(track.activeCues).forEach(cue => {\n            this._textTracksHidden.push(cue.text);\n            cue.text = '';\n          });\n        }\n      });\n    }\n  }\n\n  _setActiveTextTracksOnAVPlayer(): void {\n    const isIOS = this.player.env.os.name === 'iOS';\n    if (this._textTracksHidden && isIOS && this.playOnMainVideoTag()) {\n      let tracks = this.player.getVideoElement().textTracks;\n      Array.from(tracks).forEach(track => {\n        if (track.mode === 'showing') {\n          Array.from(track.activeCues).forEach(cue => {\n            if (this._textTracksHidden.length > 0) {\n              cue.text = this._textTracksHidden.shift();\n            }\n          });\n        }\n      });\n    }\n    this._textTracksHidden = [];\n  }\n\n  /**\n   * When playing on same video tag need to save state snapshot\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeSavePlayerSnapshot(): void {\n    if (this.playOnMainVideoTag()) {\n      this._selectedAudioTrack = this.player.getActiveTracks().audio;\n      this._selectedTextTrack = this.player.getActiveTracks().text;\n      this._selectedPlaybackRate = this.player.playbackRate;\n      // When we are using the same video element on iOS, native captions still\n      // appearing on the video element, so need to hide them before ad start.\n      this._hideActiveTextTracksOnAVPlayer();\n      this.player.hideTextTrack();\n    }\n  }\n\n  /**\n   * When playing on same video tag need to restore to previous state\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeRestorePlayerSnapshot(): void {\n    if (this.playOnMainVideoTag()) {\n      this.eventManager.listenOnce(this.player, this.player.Event.CAN_PLAY, () => {\n        this.player.selectTrack(this._selectedAudioTrack);\n        this.player.selectTrack(this._selectedTextTrack);\n        this.player.playbackRate = this._selectedPlaybackRate;\n        this._setActiveTextTracksOnAVPlayer();\n      });\n    }\n  }\n\n  /**\n   * When playing with different video tags on iOS ads are not\n   * supported in native full screen, so need to exist full screen before ads started.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeForceExitFullScreen(): void {\n    const isIOS = this.player.env.os.name === 'iOS';\n    //check if inBrowserFullscreen not set, just in case of inline true and not inBrowserFullscreen we will exit otherwise\n    if (\n      isIOS &&\n      !this.playOnMainVideoTag() &&\n      this.player.isFullscreen() &&\n      !this.player.config.playback.inBrowserFullscreen &&\n      this.player.config.playback.playsinline\n    ) {\n      this.player.exitFullscreen();\n    }\n  }\n\n  _playAdByConfig(): boolean {\n    return !!(this.config.adTagUrl || this.config.adsResponse);\n  }\n}\n\nexport {Ima};\n","// @flow\nimport {core} from 'kaltura-player-js';\nimport {Ima as BaseImaPlugin} from './ima';\n\nconst {Env} = core;\n\nclass CustomIma extends BaseImaPlugin {\n  /**\n   * The default configuration of the plugin.\n   * @type {Object}\n   * @static\n   * @memberof Ima\n   */\n  static defaultConfig: Object = {\n    debug: false,\n    delayInitUntilSourceSelected: Env.os.name === 'iOS',\n    disableMediaPreload: false,\n    forceReloadMediaAfterAds: false,\n    adsRenderingSettings: {\n      restoreCustomPlaybackStateOnAdBreakComplete: false,\n      enablePreloading: false,\n      useStyledLinearAds: false,\n      useStyledNonLinearAds: true,\n      bitrate: -1,\n      autoAlign: true,\n      loadVideoTimeout: -1\n    },\n    companions: {\n      ads: null,\n      sizeCriteria: 'SELECT_EXACT_MATCH'\n    },\n    aps: {\n      enabled: false,\n      fetchBids: adTagUrl => new Promise(resolve => resolve(adTagUrl))\n    },\n    adBreakPlayable: () => true\n  };\n\n  /**\n   * Plays ad on demand\n   * @param {KPAdPod} adPod - The ad pod to play.\n   * @returns {void}\n   * @public\n   * @instance\n   * @memberof Ima\n   */\n  playAdNow(adPod: KPAdPod): void {\n    if (!this._adBreakPlayableByConfig(adPod)) {\n      this.logger.debug('Not playing ad now because config callback denied');\n      return;\n    }\n\n    super.playAdNow(adPod);\n  }\n\n  _adBreakPlayableByConfig(adPod: ?PKAdPod): boolean {\n    return this.config.adBreakPlayable(adPod);\n  }\n\n  /**\n   * Requests the ads from the ads loader.\n   * @param {?string} vastUrl - vast url.\n   * @param {?string} vastResponse - vast XML response.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _requestAds(vastUrl: ?string, vastResponse: ?string): void {\n    this.logger.debug('Request ads', vastUrl);\n\n    let adTagUrl = vastUrl || this.config.adTagUrl;\n\n    this.logger.debug('APS integration', this.config.aps.enabled);\n\n    let fetchBidsPromise = new Promise(resolve => resolve(adTagUrl));\n\n    if (this.config.aps.enabled && adTagUrl && 'apstag' in window) {\n      fetchBidsPromise = this.config.aps.fetchBids(adTagUrl);\n    }\n\n    fetchBidsPromise.then(adTagUrl => {\n      this.logger.debug('APS fetch bids resolved', adTagUrl);\n      super._requestAds(adTagUrl, vastResponse);\n    });\n  }\n}\n\nexport {CustomIma as Ima};\n","// @flow\nimport {registerPlugin} from 'kaltura-player-js';\nimport {Ima} from './ima-custom';\n\ndeclare var __VERSION__: string;\ndeclare var __NAME__: string;\n\nconst VERSION = __VERSION__;\nconst NAME = __NAME__;\n\nexport {Ima as Plugin};\nexport {VERSION, NAME};\n\nconst pluginName: string = 'ima';\n\nregisterPlugin(pluginName, Ima);\n"],"sourceRoot":""}