{"version":3,"sources":["./ima/webpack/universalModuleDefinition","./ima/webpack/bootstrap","./ima/external {\"commonjs\":\"kaltura-player-js\",\"commonjs2\":\"kaltura-player-js\",\"amd\":\"kaltura-player-js\",\"root\":[\"KalturaPlayer\"]}","./ima/../node_modules/javascript-state-machine/lib/state-machine.js","./ima/../node_modules/javascript-state-machine/lib/history.js","webpack://KalturaPlayer.plugins.ima/./assets/style.css?703f","./ima/../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","./ima/./assets/style.css","./ima/../node_modules/css-loader/dist/runtime/api.js","./ima/./state.js","./ima/./ima-middleware.js","./ima/./ima-ads-controller.js","./ima/./ima-state-machine.js","./ima/./ima-engine-decorator.js","./ima/./ima.js","./ima/./ima-custom.js","./ima/./index.js"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","configurable","target","sources","source","arguments","length","mixin","build","config","max","plugin","plugins","methods","properties","defineProperties","hook","fsm","additional","method","args","context","concat","apply","camelize","label","result","words","split","toLowerCase","charAt","toUpperCase","substring","prepended","prepend","Config","options","StateMachine","this","defaults","states","transitions","map","lifecycle","configureLifecycle","init","configureInitTransition","data","configureData","configureMethods","wildcard","configureTransitions","configurePlugins","addState","push","addStateLifecycleNames","onEnter","onLeave","on","addTransition","indexOf","addTransitionLifecycleNames","onBefore","onAfter","mapTransition","transition","from","to","state","active","builtin","configure","Array","isArray","transitionFor","transitionsFor","keys","allStates","allTransitions","Exception","UNOBSERVED","JSM","observers","fire","is","isPending","pending","can","seek","cannot","entry","transit","changed","observeUnchangedState","onPendingTransition","beginTransit","unshift","observeEvents","observersForEvent","onInvalidTransition","endTransit","failTransit","doTransit","observe","observer","event","events","previousEvent","previousResult","undefined","pluggable","nextEvents","slice","shift","then","catch","PublicMethods","_fsm","PublicProperties","set","Error","instance","forEach","version","cstor","message","current","past","future","clear","back","forward","canBack","canForward","pop","api","content","default","locals","memo","isOldIE","Boolean","document","all","atob","getTarget","styleTarget","querySelector","HTMLIFrameElement","contentDocument","head","e","stylesInDom","getIndexByIdentifier","identifier","modulesToDom","list","idCountMap","identifiers","item","id","base","count","index","obj","css","media","sourceMap","references","updater","addStyle","insertStyleElement","style","createElement","attributes","nonce","setAttribute","insert","appendChild","textStore","replaceText","replacement","filter","join","applyToSingletonTag","remove","styleSheet","cssText","cssNode","createTextNode","childNodes","removeChild","insertBefore","applyToTag","removeAttribute","btoa","unescape","encodeURIComponent","JSON","stringify","firstChild","singleton","singletonCounter","update","styleIndex","parentNode","removeStyleElement","newObj","lastIdentifiers","newList","toString","newLastIdentifiers","_i","_index","splice","useSourceMap","cssMapping","sourceMapping","sourceURLs","sourceRoot","cssWithMappingToString","mediaQuery","alreadyImportedModules","State","ImaMiddleware","_context","player","addEventListener","Event","CHANGE_SOURCE_STARTED","_isFirstPlay","_nextLoad","next","getStateMachine","adTagUrl","adsResponse","AD_ERROR","_callNextLoad","AD_MANIFEST_LOADED","payload","adBreaksPosition","includes","disableMediaPreload","playOnMainVideoTag","AD_BREAK_END","getVideoElement","src","load","loadPromise","initialUserAction","callNext","resumeAd","reset","logger","error","pauseAd","core","BaseMiddleware","ImaAdsController","skipAd","adPod","playAdNow","onPlaybackEnded","AdBreakType","Utils","ImaStateMachine","AD_STARTED","adEvent","getAd","isLinear","AD_RESUMED","AD_PAUSED","AD_SKIPPED","AD_COMPLETED","ADS_COMPLETED","AD_LOADED","AD_FIRST_QUARTILE","AD_BREAK_START","AD_MIDPOINT","AD_THIRD_QUARTILE","USER_CLOSED_AD","AD_VOLUME_CHANGED","AD_MUTED","AD_CLICKED","AD_CAN_SKIP","AD_PROGRESS","AD_BUFFERING","onAdloaded","onAdLoaded","onAdstarted","onAdStarted","onAdpaused","onAdEvent","onAdresumed","onAdResumed","onAdclicked","onAdClicked","onAdskipped","onAdSkipped","onAdcompleted","onAdCompleted","onAdscompleted","onAdsCompleted","onAdcanskip","onAdCanSkip","onAdbreakstart","onAdBreakStart","onAdbreakend","onAdBreakEnd","onAdfirstquartile","onAdmidpoint","onAdthirdquartile","onAdlog","onAdLog","onAderror","onAdError","onUserclosedad","onAdvolumechanged","onAdmuted","onAdprogress","onAdProgress","onAdbuffering","onEnterState","StateMachineHistory","debug","type","adBreakType","getAdBreakType","adOptions","getAdOptions","ad","Ad","getAdId","Dom","_adsContainerDiv","warn","dispatchEvent","adType","extraAdData","getAdData","_currentAd","_adVideoTagAlreadyPlayed","_resizeAd","_maybeDisplayCompanionAds","_showAdsContainer","_nextPromise","_resolveNextPromise","play","_maybeIgnoreClickOnAd","_stateMachine","_adsManager","pause","_setToggleAdsCover","paused","_contentComplete","playback","playAdsWithMSE","_contentSrc","adBreakOptions","getAdBreakOptions","adBreak","AdBreak","_maybeSavePlayerSnapshot","_maybeForceExitFullScreen","_maybeSaveVideoCurrentTime","forceReloadMediaAfterAds","eventManager","listenOnce","LOADED_DATA","_maybeSetVideoCurrentTime","_hideAdsContainer","_maybeRestorePlayerSnapshot","adError","getError","getMessage","getAdError","_playAdByConfig","env","os","setTimeout","reject","getAdSkippableState","remainingTime","getRemainingTime","duration","currentTime","Number","isNumber","adProgress","fatal","code","severity","Severity","CRITICAL","RECOVERABLE","category","Category","ADS","getVastErrorCode","parseInt","Code","AD_UNDEFINED_ERROR","currentAd","getCurrentAd","innerError","adData","podInfo","getAdPodInfo","system","getAdSystem","url","getMediaUrl","clickThroughUrl","contentType","getContentType","getDuration","position","_adPosition","getAdPosition","title","getTitle","linear","skipOffset","getSkipTimeOffset","width","getVastMediaWidth","getWidth","height","getVastMediaHeight","getHeight","bitrate","getVastMediaBitrate","bumper","getIsBumper","_isBumper","numAds","_podLength","getTotalAds","ended","OVERLAY","podIndex","getPodIndex","PRE","POST","MID","getAdBreakTypeFromSdk","_getAdBreakTypeFromPlayer","FakeEvent","ImaEngineDecorator","engine","_plugin","defaultPrevented","isAdPlaying","getContentTime","getContentDuration","getContentEnded","EngineType","getCapabilities","Env","EventManager","AudioTrack","TextTrack","FULL_SCREEN_EVENTS","Ima","_initMembers","_init","_playAdBreak","_firstOfAdPod","_waterfalled","_playAd","_hasUserAction","playNext","_adBreaksEventManager","removeAll","onError","response","AD_WATERFALLING","adFailed","waterfall","AD_WATERFALLING_FAILED","adlog","listen","_adsLoader","_sdk","AdsManagerLoadedEvent","Type","ADS_MANAGER_LOADED","AdEvent","COMPLETE","SKIPPED","LOG","AdErrorEvent","ads","isAdBreak","adbreakend","CONTENT_RESUME_REQUESTED","adscompleted","ALL_ADS_COMPLETED","FIRST_PLAY","_requestAds","skip","skipSupport","stop","defer","resume","isCustomPlaybackUsed","_videoLastCurrentTime","_contentDuration","_addBindings","_isImaSDKLibLoaded","destroy","contentComplete","_adDisplayContainer","initialize","_isAdsManagerLoaded","_startAdsManager","ready","Promise","resolve","dimensions","ViewMode","NORMAL","start","fullScreenEvent","MUTE_CHANGE","_syncPlayerVolume","VOLUME_CHANGE","SOURCE_SELECTED","selectedSource","DURATION_CHANGE","ERROR","MEDIA_LOADED","updateAdsRenderingSettings","restoreCustomPlaybackStateOnAdBreakComplete","ENDED","_onMediaEnded","LOADED_METADATA","_onLoadedMetadata","TIME_UPDATE","_onMediaTimeUpdate","SEEKING","_onMediaSeeking","SEEKED","_onMediaSeeked","USER_GESTURE","_contentPlayheadTracker","previousTime","seeking","_togglePlayPauseOnAdsContainerCallback","_selectedAudioTrack","_selectedTextTrack","_selectedPlaybackRate","_textTracksHidden","_maybeDelayInitUntilSourceSelected","_loadImaSDKLib","google","ima","VERSION","_initImaSettings","_initAdsContainer","_initAdsLoader","delayInitUntilSourceSelected","imaSdkUrl","Http","protocol","IMA_SDK_DEBUG_LIB_URL","IMA_SDK_LIB_URL","loadScriptAsync","settings","setPlayerType","playerName","setPlayerVersion","playerVersion","setVpaidAllowed","setVpaidMode","_getVpaidMode","setLocale","locale","setDisableCustomPlaybackForIOS10Plus","playsinline","numRedirects","setNumRedirects","vpaidmode","ImaSdkSettings","VpaidMode","vpaidMode","ENABLED","playerView","getView","className","_adsCoverDiv","onclick","_onAdsCoverClicked","AdDisplayContainer","AdsLoader","adsManagerLoadedEvent","_onAdsManagerLoaded","aderror","vastUrl","vastResponse","adsRequest","AdsRequest","vastLoadTimeout","linearAdSlotWidth","linearAdSlotHeight","nonLinearAdSlotWidth","nonLinearAdSlotHeight","muted","volume","setAdWillPlayMuted","adWillAutoPlay","playerWillAutoPlay","autoplay","allowMutedAutoPlay","setAdWillAutoPlay","requestAds","HTML5","capabilities","mutedAutoPlay","loaded","viewMode","isFullscreen","FULLSCREEN","resize","adTotalWidth","adTotalHeight","_alignAdsContainerSizeForOverlayAd","bottom","left","getCuePoints","visibility","adsRenderingSettings","_getAdsRenderingSetting","getAdsManager","cuePoints","_attachAdsManagerListeners","AdsRenderingSettings","setting","playAdsAfterTime","startTime","CONTENT_PAUSE_REQUESTED","adbreakstart","LOADED","adloaded","STARTED","adstarted","PAUSED","adpaused","RESUMED","adresumed","FIRST_QUARTILE","adfirstquartile","MIDPOINT","admidpoint","THIRD_QUARTILE","adthirdquartile","CLICK","adclicked","adskipped","adcompleted","USER_CLOSE","userclosedad","VOLUME_CHANGED","advolumechanged","VOLUME_MUTED","admuted","adprogress","adbuffering","SKIPPABLE_STATE_CHANGED","adcanskip","setVolume","isNaN","enable","nextSibling","_isAdsCoverActive","companions","googletag","selectionCriteria","CompanionAdSelectionSettings","resourceType","ResourceType","ALL","creativeType","CreativeType","sizeCriteria","SizeCriteria","SELECT_EXACT_MATCH","companionsIds","companionAds","getCompanionAds","getContent","el","getElementById","innerHTML","browser","stopPropagation","tracks","textTracks","track","activeCues","cue","text","isIOS","getActiveTracks","audio","playbackRate","_hideActiveTextTracksOnAVPlayer","hideTextTrack","CAN_PLAY","selectTrack","_setActiveTextTracksOnAVPlayer","inBrowserFullscreen","exitFullscreen","BasePlugin","enablePreloading","useStyledLinearAds","useStyledNonLinearAds","autoAlign","loadVideoTimeout","CustomIma","_adBreakPlayableByConfig","adBreakPlayable","aps","enabled","fetchBidsPromise","fetchBids","BaseImaPlugin","__VERSION__","NAME","__NAME__","registerPlugin"],"mappings":"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","file":"playkit-ima.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"kaltura-player-js\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"ima\", [\"kaltura-player-js\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ima\"] = factory(require(\"kaltura-player-js\"));\n\telse\n\t\troot[\"KalturaPlayer\"] = root[\"KalturaPlayer\"] || {}, root[\"KalturaPlayer\"][\"plugins\"] = root[\"KalturaPlayer\"][\"plugins\"] || {}, root[\"KalturaPlayer\"][\"plugins\"][\"ima\"] = factory(root[\"KalturaPlayer\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"StateMachine\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StateMachine\"] = factory();\n\telse\n\t\troot[\"StateMachine\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 5);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function(target, sources) {\n  var n, source, key;\n  for(n = 1 ; n < arguments.length ; n++) {\n    source = arguments[n];\n    for(key in source) {\n      if (source.hasOwnProperty(key))\n        target[key] = source[key];\n    }\n  }\n  return target;\n}\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar mixin = __webpack_require__(0);\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = {\n\n  build: function(target, config) {\n    var n, max, plugin, plugins = config.plugins;\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n];\n      if (plugin.methods)\n        mixin(target, plugin.methods);\n      if (plugin.properties)\n        Object.defineProperties(target, plugin.properties);\n    }\n  },\n\n  hook: function(fsm, name, additional) {\n    var n, max, method, plugin,\n        plugins = fsm.config.plugins,\n        args    = [fsm.context];\n\n    if (additional)\n      args = args.concat(additional)\n\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n]\n      method = plugins[n][name]\n      if (method)\n        method.apply(plugin, args);\n    }\n  }\n\n}\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nfunction camelize(label) {\n\n  if (label.length === 0)\n    return label;\n\n  var n, result, word, words = label.split(/[_-]/);\n\n  // single word with first character already lowercase, return untouched\n  if ((words.length === 1) && (words[0][0].toLowerCase() === words[0][0]))\n    return label;\n\n  result = words[0].toLowerCase();\n  for(n = 1 ; n < words.length ; n++) {\n    result = result + words[n].charAt(0).toUpperCase() + words[n].substring(1).toLowerCase();\n  }\n\n  return result;\n}\n\n//-------------------------------------------------------------------------------------------------\n\ncamelize.prepended = function(prepend, label) {\n  label = camelize(label);\n  return prepend + label[0].toUpperCase() + label.substring(1);\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = camelize;\n\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar mixin    = __webpack_require__(0),\n    camelize = __webpack_require__(2);\n\n//-------------------------------------------------------------------------------------------------\n\nfunction Config(options, StateMachine) {\n\n  options = options || {};\n\n  this.options     = options; // preserving original options can be useful (e.g visualize plugin)\n  this.defaults    = StateMachine.defaults;\n  this.states      = [];\n  this.transitions = [];\n  this.map         = {};\n  this.lifecycle   = this.configureLifecycle();\n  this.init        = this.configureInitTransition(options.init);\n  this.data        = this.configureData(options.data);\n  this.methods     = this.configureMethods(options.methods);\n\n  this.map[this.defaults.wildcard] = {};\n\n  this.configureTransitions(options.transitions || []);\n\n  this.plugins = this.configurePlugins(options.plugins, StateMachine.plugin);\n\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmixin(Config.prototype, {\n\n  addState: function(name) {\n    if (!this.map[name]) {\n      this.states.push(name);\n      this.addStateLifecycleNames(name);\n      this.map[name] = {};\n    }\n  },\n\n  addStateLifecycleNames: function(name) {\n    this.lifecycle.onEnter[name] = camelize.prepended('onEnter', name);\n    this.lifecycle.onLeave[name] = camelize.prepended('onLeave', name);\n    this.lifecycle.on[name]      = camelize.prepended('on',      name);\n  },\n\n  addTransition: function(name) {\n    if (this.transitions.indexOf(name) < 0) {\n      this.transitions.push(name);\n      this.addTransitionLifecycleNames(name);\n    }\n  },\n\n  addTransitionLifecycleNames: function(name) {\n    this.lifecycle.onBefore[name] = camelize.prepended('onBefore', name);\n    this.lifecycle.onAfter[name]  = camelize.prepended('onAfter',  name);\n    this.lifecycle.on[name]       = camelize.prepended('on',       name);\n  },\n\n  mapTransition: function(transition) {\n    var name = transition.name,\n        from = transition.from,\n        to   = transition.to;\n    this.addState(from);\n    if (typeof to !== 'function')\n      this.addState(to);\n    this.addTransition(name);\n    this.map[from][name] = transition;\n    return transition;\n  },\n\n  configureLifecycle: function() {\n    return {\n      onBefore: { transition: 'onBeforeTransition' },\n      onAfter:  { transition: 'onAfterTransition'  },\n      onEnter:  { state:      'onEnterState'       },\n      onLeave:  { state:      'onLeaveState'       },\n      on:       { transition: 'onTransition'       }\n    };\n  },\n\n  configureInitTransition: function(init) {\n    if (typeof init === 'string') {\n      return this.mapTransition(mixin({}, this.defaults.init, { to: init, active: true }));\n    }\n    else if (typeof init === 'object') {\n      return this.mapTransition(mixin({}, this.defaults.init, init, { active: true }));\n    }\n    else {\n      this.addState(this.defaults.init.from);\n      return this.defaults.init;\n    }\n  },\n\n  configureData: function(data) {\n    if (typeof data === 'function')\n      return data;\n    else if (typeof data === 'object')\n      return function() { return data; }\n    else\n      return function() { return {};  }\n  },\n\n  configureMethods: function(methods) {\n    return methods || {};\n  },\n\n  configurePlugins: function(plugins, builtin) {\n    plugins = plugins || [];\n    var n, max, plugin;\n    for(n = 0, max = plugins.length ; n < max ; n++) {\n      plugin = plugins[n];\n      if (typeof plugin === 'function')\n        plugins[n] = plugin = plugin()\n      if (plugin.configure)\n        plugin.configure(this);\n    }\n    return plugins\n  },\n\n  configureTransitions: function(transitions) {\n    var i, n, transition, from, to, wildcard = this.defaults.wildcard;\n    for(n = 0 ; n < transitions.length ; n++) {\n      transition = transitions[n];\n      from  = Array.isArray(transition.from) ? transition.from : [transition.from || wildcard]\n      to    = transition.to || wildcard;\n      for(i = 0 ; i < from.length ; i++) {\n        this.mapTransition({ name: transition.name, from: from[i], to: to });\n      }\n    }\n  },\n\n  transitionFor: function(state, transition) {\n    var wildcard = this.defaults.wildcard;\n    return this.map[state][transition] ||\n           this.map[wildcard][transition];\n  },\n\n  transitionsFor: function(state) {\n    var wildcard = this.defaults.wildcard;\n    return Object.keys(this.map[state]).concat(Object.keys(this.map[wildcard]));\n  },\n\n  allStates: function() {\n    return this.states;\n  },\n\n  allTransitions: function() {\n    return this.transitions;\n  }\n\n});\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = Config;\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\nvar mixin      = __webpack_require__(0),\n    Exception  = __webpack_require__(6),\n    plugin     = __webpack_require__(1),\n    UNOBSERVED = [ null, [] ];\n\n//-------------------------------------------------------------------------------------------------\n\nfunction JSM(context, config) {\n  this.context   = context;\n  this.config    = config;\n  this.state     = config.init.from;\n  this.observers = [context];\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmixin(JSM.prototype, {\n\n  init: function(args) {\n    mixin(this.context, this.config.data.apply(this.context, args));\n    plugin.hook(this, 'init');\n    if (this.config.init.active)\n      return this.fire(this.config.init.name, []);\n  },\n\n  is: function(state) {\n    return Array.isArray(state) ? (state.indexOf(this.state) >= 0) : (this.state === state);\n  },\n\n  isPending: function() {\n    return this.pending;\n  },\n\n  can: function(transition) {\n    return !this.isPending() && !!this.seek(transition);\n  },\n\n  cannot: function(transition) {\n    return !this.can(transition);\n  },\n\n  allStates: function() {\n    return this.config.allStates();\n  },\n\n  allTransitions: function() {\n    return this.config.allTransitions();\n  },\n\n  transitions: function() {\n    return this.config.transitionsFor(this.state);\n  },\n\n  seek: function(transition, args) {\n    var wildcard = this.config.defaults.wildcard,\n        entry    = this.config.transitionFor(this.state, transition),\n        to       = entry && entry.to;\n    if (typeof to === 'function')\n      return to.apply(this.context, args);\n    else if (to === wildcard)\n      return this.state\n    else\n      return to\n  },\n\n  fire: function(transition, args) {\n    return this.transit(transition, this.state, this.seek(transition, args), args);\n  },\n\n  transit: function(transition, from, to, args) {\n\n    var lifecycle = this.config.lifecycle,\n        changed   = this.config.options.observeUnchangedState || (from !== to);\n\n    if (!to)\n      return this.context.onInvalidTransition(transition, from, to);\n\n    if (this.isPending())\n      return this.context.onPendingTransition(transition, from, to);\n\n    this.config.addState(to);  // might need to add this state if it's unknown (e.g. conditional transition or goto)\n\n    this.beginTransit();\n\n    args.unshift({             // this context will be passed to each lifecycle event observer\n      transition: transition,\n      from:       from,\n      to:         to,\n      fsm:        this.context\n    });\n\n    return this.observeEvents([\n                this.observersForEvent(lifecycle.onBefore.transition),\n                this.observersForEvent(lifecycle.onBefore[transition]),\n      changed ? this.observersForEvent(lifecycle.onLeave.state) : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onLeave[from]) : UNOBSERVED,\n                this.observersForEvent(lifecycle.on.transition),\n      changed ? [ 'doTransit', [ this ] ]                       : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onEnter.state) : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.onEnter[to])   : UNOBSERVED,\n      changed ? this.observersForEvent(lifecycle.on[to])        : UNOBSERVED,\n                this.observersForEvent(lifecycle.onAfter.transition),\n                this.observersForEvent(lifecycle.onAfter[transition]),\n                this.observersForEvent(lifecycle.on[transition])\n    ], args);\n  },\n\n  beginTransit: function()          { this.pending = true;                 },\n  endTransit:   function(result)    { this.pending = false; return result; },\n  failTransit:  function(result)    { this.pending = false; throw result;  },\n  doTransit:    function(lifecycle) { this.state = lifecycle.to;           },\n\n  observe: function(args) {\n    if (args.length === 2) {\n      var observer = {};\n      observer[args[0]] = args[1];\n      this.observers.push(observer);\n    }\n    else {\n      this.observers.push(args[0]);\n    }\n  },\n\n  observersForEvent: function(event) { // TODO: this could be cached\n    var n = 0, max = this.observers.length, observer, result = [];\n    for( ; n < max ; n++) {\n      observer = this.observers[n];\n      if (observer[event])\n        result.push(observer);\n    }\n    return [ event, result, true ]\n  },\n\n  observeEvents: function(events, args, previousEvent, previousResult) {\n    if (events.length === 0) {\n      return this.endTransit(previousResult === undefined ? true : previousResult);\n    }\n\n    var event     = events[0][0],\n        observers = events[0][1],\n        pluggable = events[0][2];\n\n    args[0].event = event;\n    if (event && pluggable && event !== previousEvent)\n      plugin.hook(this, 'lifecycle', args);\n\n    if (observers.length === 0) {\n      var nextEvents = events.slice(1);\n      return this.observeEvents(nextEvents, args, event, previousResult);\n    }\n    else {\n      var observer = observers.shift(),\n          result = observer[event].apply(observer, args);\n      if (result && typeof result.then === 'function') {\n        return result.then(this.observeEvents.bind(this, events, args, event))\n                     .catch(this.failTransit.bind(this))\n      }\n      else if (result === false) {\n        return this.endTransit(false);\n      }\n      else {\n        return this.observeEvents(events, args, event, result);\n      }\n    }\n  },\n\n  onInvalidTransition: function(transition, from, to) {\n    throw new Exception(\"transition is invalid in current state\", transition, from, to, this.state);\n  },\n\n  onPendingTransition: function(transition, from, to) {\n    throw new Exception(\"transition is invalid while previous transition is still in progress\", transition, from, to, this.state);\n  }\n\n});\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = JSM;\n\n//-------------------------------------------------------------------------------------------------\n\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-----------------------------------------------------------------------------------------------\n\nvar mixin    = __webpack_require__(0),\n    camelize = __webpack_require__(2),\n    plugin   = __webpack_require__(1),\n    Config   = __webpack_require__(3),\n    JSM      = __webpack_require__(4);\n\n//-----------------------------------------------------------------------------------------------\n\nvar PublicMethods = {\n  is:                  function(state)       { return this._fsm.is(state)                                     },\n  can:                 function(transition)  { return this._fsm.can(transition)                               },\n  cannot:              function(transition)  { return this._fsm.cannot(transition)                            },\n  observe:             function()            { return this._fsm.observe(arguments)                            },\n  transitions:         function()            { return this._fsm.transitions()                                 },\n  allTransitions:      function()            { return this._fsm.allTransitions()                              },\n  allStates:           function()            { return this._fsm.allStates()                                   },\n  onInvalidTransition: function(t, from, to) { return this._fsm.onInvalidTransition(t, from, to)              },\n  onPendingTransition: function(t, from, to) { return this._fsm.onPendingTransition(t, from, to)              },\n}\n\nvar PublicProperties = {\n  state: {\n    configurable: false,\n    enumerable:   true,\n    get: function() {\n      return this._fsm.state;\n    },\n    set: function(state) {\n      throw Error('use transitions to change state')\n    }\n  }\n}\n\n//-----------------------------------------------------------------------------------------------\n\nfunction StateMachine(options) {\n  return apply(this || {}, options);\n}\n\nfunction factory() {\n  var cstor, options;\n  if (typeof arguments[0] === 'function') {\n    cstor   = arguments[0];\n    options = arguments[1] || {};\n  }\n  else {\n    cstor   = function() { this._fsm.apply(this, arguments) };\n    options = arguments[0] || {};\n  }\n  var config = new Config(options, StateMachine);\n  build(cstor.prototype, config);\n  cstor.prototype._fsm.config = config; // convenience access to shared config without needing an instance\n  return cstor;\n}\n\n//-------------------------------------------------------------------------------------------------\n\nfunction apply(instance, options) {\n  var config = new Config(options, StateMachine);\n  build(instance, config);\n  instance._fsm();\n  return instance;\n}\n\nfunction build(target, config) {\n  if ((typeof target !== 'object') || Array.isArray(target))\n    throw Error('StateMachine can only be applied to objects');\n  plugin.build(target, config);\n  Object.defineProperties(target, PublicProperties);\n  mixin(target, PublicMethods);\n  mixin(target, config.methods);\n  config.allTransitions().forEach(function(transition) {\n    target[camelize(transition)] = function() {\n      return this._fsm.fire(transition, [].slice.call(arguments))\n    }\n  });\n  target._fsm = function() {\n    this._fsm = new JSM(this, config);\n    this._fsm.init(arguments);\n  }\n}\n\n//-----------------------------------------------------------------------------------------------\n\nStateMachine.version  = '3.0.1';\nStateMachine.factory  = factory;\nStateMachine.apply    = apply;\nStateMachine.defaults = {\n  wildcard: '*',\n  init: {\n    name: 'init',\n    from: 'none'\n  }\n}\n\n//===============================================================================================\n\nmodule.exports = StateMachine;\n\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nmodule.exports = function(message, transition, from, to, current) {\n  this.message    = message;\n  this.transition = transition;\n  this.from       = from;\n  this.to         = to;\n  this.current    = current;\n}\n\n\n/***/ })\n/******/ ]);\n});","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"StateMachineHistory\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"StateMachineHistory\"] = factory();\n\telse\n\t\troot[\"StateMachineHistory\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 1);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nfunction camelize(label) {\n\n  if (label.length === 0)\n    return label;\n\n  var n, result, word, words = label.split(/[_-]/);\n\n  // single word with first character already lowercase, return untouched\n  if ((words.length === 1) && (words[0][0].toLowerCase() === words[0][0]))\n    return label;\n\n  result = words[0].toLowerCase();\n  for(n = 1 ; n < words.length ; n++) {\n    result = result + words[n].charAt(0).toUpperCase() + words[n].substring(1).toLowerCase();\n  }\n\n  return result;\n}\n\n//-------------------------------------------------------------------------------------------------\n\ncamelize.prepended = function(prepend, label) {\n  label = camelize(label);\n  return prepend + label[0].toUpperCase() + label.substring(1);\n}\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = camelize;\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\n//-------------------------------------------------------------------------------------------------\n\nvar camelize = __webpack_require__(0);\n\n//-------------------------------------------------------------------------------------------------\n\nmodule.exports = function(options) { options = options || {};\n\n  var past       = camelize(options.name || options.past   || 'history'),\n      future     = camelize(                options.future || 'future'),\n      clear      = camelize.prepended('clear', past),\n      back       = camelize.prepended(past,   'back'),\n      forward    = camelize.prepended(past,   'forward'),\n      canBack    = camelize.prepended('can',   back),\n      canForward = camelize.prepended('can',   forward),\n      max        = options.max;\n\n  var plugin = {\n\n    configure: function(config) {\n      config.addTransitionLifecycleNames(back);\n      config.addTransitionLifecycleNames(forward);\n    },\n\n    init: function(instance) {\n      instance[past]   = [];\n      instance[future] = [];\n    },\n\n    lifecycle: function(instance, lifecycle) {\n      if (lifecycle.event === 'onEnterState') {\n        instance[past].push(lifecycle.to);\n        if (max && instance[past].length > max)\n          instance[past].shift();\n        if (lifecycle.transition !== back && lifecycle.transition !== forward)\n          instance[future].length = 0;\n      }\n    },\n\n    methods:    {},\n    properties: {}\n\n  }\n\n  plugin.methods[clear] = function() {\n    this[past].length = 0\n    this[future].length = 0\n  }\n\n  plugin.properties[canBack] = {\n    get: function() {\n      return this[past].length > 1\n    }\n  }\n\n  plugin.properties[canForward] = {\n    get: function() {\n      return this[future].length > 0\n    }\n  }\n\n  plugin.methods[back] = function() {\n    if (!this[canBack])\n      throw Error('no history');\n    var from = this[past].pop(),\n        to   = this[past].pop();\n    this[future].push(from);\n    this._fsm.transit(back, from, to, []);\n  }\n\n  plugin.methods[forward] = function() {\n    if (!this[canForward])\n      throw Error('no history');\n    var from = this.state,\n        to = this[future].pop();\n    this._fsm.transit(forward, from, to, []);\n  }\n\n  return plugin;\n\n}\n\n\n/***/ })\n/******/ ]);\n});","var api = require(\"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../node_modules/css-loader/dist/cjs.js!./style.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","\"use strict\";\n\nvar isOldIE = function isOldIE() {\n  var memo;\n  return function memorize() {\n    if (typeof memo === 'undefined') {\n      // Test for IE <= 9 as proposed by Browserhacks\n      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n      // Tests for existence of standard globals is to allow style-loader\n      // to operate correctly into non-standard environments\n      // @see https://github.com/webpack-contrib/style-loader/issues/177\n      memo = Boolean(window && document && document.all && !window.atob);\n    }\n\n    return memo;\n  };\n}();\n\nvar getTarget = function getTarget() {\n  var memo = {};\n  return function memorize(target) {\n    if (typeof memo[target] === 'undefined') {\n      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n        try {\n          // This will throw an exception if access to iframe is blocked\n          // due to cross-origin restrictions\n          styleTarget = styleTarget.contentDocument.head;\n        } catch (e) {\n          // istanbul ignore next\n          styleTarget = null;\n        }\n      }\n\n      memo[target] = styleTarget;\n    }\n\n    return memo[target];\n  };\n}();\n\nvar stylesInDom = [];\n\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n\n  for (var i = 0; i < stylesInDom.length; i++) {\n    if (stylesInDom[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n}\n\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var index = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3]\n    };\n\n    if (index !== -1) {\n      stylesInDom[index].references++;\n      stylesInDom[index].updater(obj);\n    } else {\n      stylesInDom.push({\n        identifier: identifier,\n        updater: addStyle(obj, options),\n        references: 1\n      });\n    }\n\n    identifiers.push(identifier);\n  }\n\n  return identifiers;\n}\n\nfunction insertStyleElement(options) {\n  var style = document.createElement('style');\n  var attributes = options.attributes || {};\n\n  if (typeof attributes.nonce === 'undefined') {\n    var nonce = typeof __webpack_nonce__ !== 'undefined' ? __webpack_nonce__ : null;\n\n    if (nonce) {\n      attributes.nonce = nonce;\n    }\n  }\n\n  Object.keys(attributes).forEach(function (key) {\n    style.setAttribute(key, attributes[key]);\n  });\n\n  if (typeof options.insert === 'function') {\n    options.insert(style);\n  } else {\n    var target = getTarget(options.insert || 'head');\n\n    if (!target) {\n      throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n    }\n\n    target.appendChild(style);\n  }\n\n  return style;\n}\n\nfunction removeStyleElement(style) {\n  // istanbul ignore if\n  if (style.parentNode === null) {\n    return false;\n  }\n\n  style.parentNode.removeChild(style);\n}\n/* istanbul ignore next  */\n\n\nvar replaceText = function replaceText() {\n  var textStore = [];\n  return function replace(index, replacement) {\n    textStore[index] = replacement;\n    return textStore.filter(Boolean).join('\\n');\n  };\n}();\n\nfunction applyToSingletonTag(style, index, remove, obj) {\n  var css = remove ? '' : obj.media ? \"@media \".concat(obj.media, \" {\").concat(obj.css, \"}\") : obj.css; // For old IE\n\n  /* istanbul ignore if  */\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = replaceText(index, css);\n  } else {\n    var cssNode = document.createTextNode(css);\n    var childNodes = style.childNodes;\n\n    if (childNodes[index]) {\n      style.removeChild(childNodes[index]);\n    }\n\n    if (childNodes.length) {\n      style.insertBefore(cssNode, childNodes[index]);\n    } else {\n      style.appendChild(cssNode);\n    }\n  }\n}\n\nfunction applyToTag(style, options, obj) {\n  var css = obj.css;\n  var media = obj.media;\n  var sourceMap = obj.sourceMap;\n\n  if (media) {\n    style.setAttribute('media', media);\n  } else {\n    style.removeAttribute('media');\n  }\n\n  if (sourceMap && btoa) {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    while (style.firstChild) {\n      style.removeChild(style.firstChild);\n    }\n\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar singleton = null;\nvar singletonCounter = 0;\n\nfunction addStyle(obj, options) {\n  var style;\n  var update;\n  var remove;\n\n  if (options.singleton) {\n    var styleIndex = singletonCounter++;\n    style = singleton || (singleton = insertStyleElement(options));\n    update = applyToSingletonTag.bind(null, style, styleIndex, false);\n    remove = applyToSingletonTag.bind(null, style, styleIndex, true);\n  } else {\n    style = insertStyleElement(options);\n    update = applyToTag.bind(null, style, options);\n\n    remove = function remove() {\n      removeStyleElement(style);\n    };\n  }\n\n  update(obj);\n  return function updateStyle(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {\n        return;\n      }\n\n      update(obj = newObj);\n    } else {\n      remove();\n    }\n  };\n}\n\nmodule.exports = function (list, options) {\n  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n  // tags it will allow on a page\n\n  if (!options.singleton && typeof options.singleton !== 'boolean') {\n    options.singleton = isOldIE();\n  }\n\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    if (Object.prototype.toString.call(newList) !== '[object Array]') {\n      return;\n    }\n\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDom[index].references--;\n    }\n\n    var newLastIdentifiers = modulesToDom(newList, options);\n\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n\n      var _index = getIndexByIdentifier(_identifier);\n\n      if (stylesInDom[_index].references === 0) {\n        stylesInDom[_index].updater();\n\n        stylesInDom.splice(_index, 1);\n      }\n    }\n\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","exports = module.exports = require(\"../../node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.id, \".playkit-ads-cover {\\n  position: relative;\\n  cursor: pointer;\\n  width: 100%;\\n  height: 100%;\\n  background-color: rgba(0, 0, 0, 0);\\n}\\n\\n.playkit-ads-container {\\n  visibility: hidden;\\n  position: absolute;\\n}\\n\", \"\"]);\n\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function (useSourceMap) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item, useSourceMap);\n\n      if (item[2]) {\n        return '@media ' + item[2] + '{' + content + '}';\n      } else {\n        return content;\n      }\n    }).join('');\n  }; // import a list of modules into the list\n\n\n  list.i = function (modules, mediaQuery) {\n    if (typeof modules === 'string') {\n      modules = [[null, modules, '']];\n    }\n\n    var alreadyImportedModules = {};\n\n    for (var i = 0; i < this.length; i++) {\n      var id = this[i][0];\n\n      if (id != null) {\n        alreadyImportedModules[id] = true;\n      }\n    }\n\n    for (i = 0; i < modules.length; i++) {\n      var item = modules[i]; // skip already imported module\n      // this implementation is not 100% perfect for weird media query combinations\n      // when a module is imported multiple times with different media queries.\n      // I hope this will never occur (Hey this way we have smaller bundles)\n\n      if (item[0] == null || !alreadyImportedModules[item[0]]) {\n        if (mediaQuery && !item[2]) {\n          item[2] = mediaQuery;\n        } else if (mediaQuery) {\n          item[2] = '(' + item[2] + ') and (' + mediaQuery + ')';\n        }\n\n        list.push(item);\n      }\n    }\n  };\n\n  return list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n  var content = item[1] || '';\n  var cssMapping = item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (useSourceMap && typeof btoa === 'function') {\n    var sourceMapping = toComment(cssMapping);\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */';\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n  }\n\n  return [content].join('\\n');\n} // Adapted from convert-source-map (MIT)\n\n\nfunction toComment(sourceMap) {\n  // eslint-disable-next-line no-undef\n  var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n  var data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n  return '/*# ' + data + ' */';\n}","// @flow\n\n/**\n * The ima plugin possible states.\n * @type {Object}\n */\nconst State: {[state: string]: string} = {\n  LOADING: 'loading',\n  LOADED: 'loaded',\n  PENDING: 'pending',\n  PLAYING: 'playing',\n  PAUSED: 'paused',\n  IDLE: 'idle',\n  DONE: 'done'\n};\n\nexport {State};\n","// @flow\nimport {core} from 'kaltura-player-js';\nimport {Ima} from './ima';\nimport {State} from './state';\n\nconst {BaseMiddleware} = core;\n/**\n * Middleware implementation for ima plugin.\n * @class ImaMiddleware\n * @param {Ima} context - The ima plugin context.\n * @private\n */\nclass ImaMiddleware extends BaseMiddleware {\n  /**\n   * The id of the ima middleware.\n   * @type {string}\n   * @public\n   * @memberof ImaMiddleware\n   */\n  id: string = 'ImaMiddleware';\n  /**\n   * Whether the play request is the first.\n   * @member\n   * @private\n   * @memberof ImaMiddleware\n   */\n  _isFirstPlay: boolean;\n  /**\n   * The plugin context.\n   * @member\n   * @private\n   * @memberof ImaMiddleware\n   */\n  _context: Ima;\n  /**\n   * The next load function.\n   * @member\n   * @private\n   * @memberof ImaMiddleware\n   */\n  _nextLoad: ?Function;\n\n  constructor(context: Ima) {\n    super();\n    this._context = context;\n    context.player.addEventListener(context.player.Event.CHANGE_SOURCE_STARTED, () => {\n      this._isFirstPlay = true;\n      this._nextLoad = null;\n    });\n  }\n\n  /**\n   * Load middleware handler.\n   * @param {Function} next - The load play handler in the middleware chain.\n   * @returns {void}\n   * @memberof ImaMiddleware\n   */\n  load(next: Function): void {\n    this._nextLoad = next;\n    const sm = this._context.getStateMachine();\n    if (sm.state !== State.IDLE && (this._context.config.adTagUrl || this._context.config.adsResponse)) {\n      this._context.player.addEventListener(this._context.player.Event.AD_ERROR, () => {\n        this._callNextLoad();\n      });\n      this._context.player.addEventListener(this._context.player.Event.AD_MANIFEST_LOADED, event => {\n        if (!event.payload.adBreaksPosition.includes(0)) {\n          this._callNextLoad();\n        }\n      });\n    } else {\n      this._callNextLoad();\n    }\n  }\n\n  /**\n   * Play middleware handler.\n   * @param {Function} next - The next play handler in the middleware chain.\n   * @returns {void}\n   * @memberof ImaMiddleware\n   */\n  play(next: Function): void {\n    if (this._isFirstPlay) {\n      this._isFirstPlay = false;\n      if (this._context.config.disableMediaPreload || this._context.playOnMainVideoTag()) {\n        this._context.player.addEventListener(this._context.player.Event.AD_BREAK_END, () => this._callNextLoad());\n        if (!(this._context.playOnMainVideoTag() || this._context.player.getVideoElement().src)) {\n          this._context.player.getVideoElement().load();\n        }\n      } else {\n        this._callNextLoad();\n      }\n    }\n    this._context.loadPromise\n      .then(() => {\n        let sm = this._context.getStateMachine();\n        switch (sm.state) {\n          case State.PLAYING:\n            break;\n          case State.LOADED: {\n            const initialUserAction = this._context.initialUserAction();\n            if (initialUserAction) {\n              return initialUserAction.then(() => {\n                this.callNext(next);\n              });\n            } else {\n              this.callNext(next);\n            }\n            break;\n          }\n          case State.PAUSED: {\n            const resumeAd = this._context.resumeAd();\n            if (resumeAd) {\n              return resumeAd.then(() => {\n                this.callNext(next);\n              });\n            } else {\n              this.callNext(next);\n            }\n            break;\n          }\n          default: {\n            this.callNext(next);\n            break;\n          }\n        }\n      })\n      .catch(e => {\n        this._context.reset();\n        this._context.logger.error(e);\n        this.callNext(next);\n      });\n  }\n\n  /**\n   * Pause middleware handler.\n   * @param {Function} next - The next pause handler in the middleware chain.\n   * @returns {void}\n   * @memberof ImaMiddleware\n   */\n  pause(next: Function): void {\n    let sm = this._context.getStateMachine();\n    switch (sm.state) {\n      case State.PAUSED:\n        break;\n      case State.PLAYING: {\n        this._context.pauseAd();\n        break;\n      }\n      default: {\n        this.callNext(next);\n        break;\n      }\n    }\n  }\n\n  _callNextLoad(): void {\n    if (this._nextLoad) {\n      this.callNext(this._nextLoad);\n    }\n    this._nextLoad = null;\n  }\n}\n\nexport {ImaMiddleware};\n","// @flow\nimport {Ima} from './ima';\nimport {State} from './state';\n\n/**\n * Controller for ima plugin.\n * @class ImaAdsController\n * @param {Ima} context - The ima plugin context.\n */\nclass ImaAdsController implements IAdsPluginController {\n  /**\n   * The plugin context.\n   * @member\n   * @private\n   * @memberof ImaAdsController\n   */\n  _context: Ima;\n\n  constructor(context: Ima) {\n    this._context = context;\n  }\n\n  /**\n   * Skip on an ad.\n   * @public\n   * @returns {void}\n   * @memberof ImaAdsController\n   */\n  skipAd(): void {\n    this._context.skipAd();\n  }\n\n  /**\n   * Play an ad on demand.\n   * @param {KPAdPod} adPod - The ad pod to play.\n   * @public\n   * @returns {void}\n   * @memberof ImaAdsController\n   */\n  playAdNow(adPod: KPAdPod): void {\n    this._context.playAdNow(adPod);\n  }\n\n  /**\n   * On playback ended handler.\n   * @public\n   * @returns {Promise<void>} - complete promise\n   * @memberof ImaAdsController\n   */\n  onPlaybackEnded(): Promise<void> {\n    return this._context.onPlaybackEnded();\n  }\n\n  /**\n   * Whether this ads controller is active\n   * @public\n   * @returns {boolean} - is active\n   * @memberof ImaAdsController\n   */\n  get active(): boolean {\n    return this._context.getStateMachine().state === State.PLAYING || this._context.getStateMachine().state === State.PAUSED;\n  }\n\n  /**\n   * Whether this ads controller is done\n   * @public\n   * @returns {boolean} - is done\n   * @memberof ImaAdsController\n   */\n  get done(): boolean {\n    return this._context.getStateMachine().state === State.DONE;\n  }\n\n  /**\n   * The controller name\n   * @public\n   * @returns {string} - The name\n   * @memberof ImaAdsController\n   */\n  get name(): string {\n    return this._context.name;\n  }\n}\n\nexport {ImaAdsController};\n","// @flow\nimport StateMachine from 'javascript-state-machine';\nimport StateMachineHistory from 'javascript-state-machine/lib/history';\nimport {State} from './state';\nimport {core, Ad, AdBreak} from 'kaltura-player-js';\n\nconst {AdBreakType, Error, Utils} = core;\n\n/**\n * Finite state machine for ima plugin.\n * @class ImaStateMachine\n * @private\n * @param {any} context - The plugin context.\n * @classdesc\n */\nclass ImaStateMachine {\n  constructor(context: any) {\n    return new StateMachine({\n      init: State.LOADING,\n      transitions: [\n        {\n          name: 'loaded',\n          from: [State.LOADING, State.LOADED, State.IDLE, State.PAUSED, State.PLAYING, State.DONE],\n          to: State.LOADED\n        },\n        {\n          name: context.player.Event.AD_STARTED,\n          from: [State.LOADED, State.IDLE, State.PAUSED, State.PLAYING, State.PENDING],\n          to: (adEvent: any): string => {\n            let ad = adEvent.getAd();\n            if (!ad.isLinear()) {\n              return State.IDLE;\n            }\n            return State.PLAYING;\n          }\n        },\n        {\n          name: context.player.Event.AD_RESUMED,\n          from: [State.PAUSED, State.PLAYING],\n          to: State.PLAYING\n        },\n        {\n          name: context.player.Event.AD_PAUSED,\n          from: State.PLAYING,\n          to: State.PAUSED\n        },\n        {\n          name: context.player.Event.AD_SKIPPED,\n          from: [State.PLAYING, State.PAUSED],\n          to: State.IDLE\n        },\n        {\n          name: context.player.Event.AD_COMPLETED,\n          from: [State.PLAYING, State.PAUSED]\n        },\n        {\n          name: context.player.Event.ADS_COMPLETED,\n          from: [State.IDLE, State.PAUSED],\n          to: State.DONE\n        },\n        {\n          name: context.player.Event.AD_BREAK_END,\n          from: [State.IDLE, State.PLAYING, State.LOADED, State.PAUSED],\n          to: State.IDLE\n        },\n        {\n          name: 'adlog',\n          from: [State.IDLE, State.LOADED, State.PLAYING, State.PAUSED, State.LOADING, State.PENDING],\n          to: State.IDLE\n        },\n        {\n          name: context.player.Event.AD_ERROR,\n          from: [State.IDLE, State.LOADED, State.PLAYING, State.PAUSED, State.LOADING, State.PENDING],\n          to: State.IDLE\n        },\n        {\n          name: context.player.Event.AD_LOADED,\n          from: [State.IDLE, State.LOADED, State.PLAYING]\n        },\n        {\n          name: context.player.Event.AD_FIRST_QUARTILE,\n          from: State.PLAYING\n        },\n        {\n          name: context.player.Event.AD_BREAK_START,\n          from: [State.IDLE, State.LOADED],\n          to: State.PENDING\n        },\n        {\n          name: context.player.Event.AD_MIDPOINT,\n          from: State.PLAYING\n        },\n        {\n          name: context.player.Event.AD_THIRD_QUARTILE,\n          from: State.PLAYING\n        },\n        {\n          name: context.player.Event.USER_CLOSED_AD,\n          from: [State.IDLE, State.PLAYING, State.PAUSED]\n        },\n        {\n          name: context.player.Event.AD_VOLUME_CHANGED,\n          from: [State.PENDING, State.PLAYING, State.PAUSED, State.LOADED]\n        },\n        {\n          name: context.player.Event.AD_MUTED,\n          from: [State.PLAYING, State.PAUSED, State.LOADED]\n        },\n        {\n          name: context.player.Event.AD_CLICKED,\n          from: [State.PLAYING, State.PAUSED, State.IDLE]\n        },\n        {\n          name: context.player.Event.AD_CAN_SKIP,\n          from: [State.PLAYING, State.PAUSED, State.LOADED]\n        },\n        {\n          name: context.player.Event.AD_PROGRESS,\n          from: [State.PLAYING, State.PAUSED]\n        },\n        {\n          name: context.player.Event.AD_BUFFERING,\n          from: '*'\n        },\n        {\n          name: 'goto',\n          from: '*',\n          to: s => s\n        }\n      ],\n      methods: {\n        onAdloaded: onAdLoaded.bind(context),\n        onAdstarted: onAdStarted.bind(context),\n        onAdpaused: onAdEvent.bind(context),\n        onAdresumed: onAdResumed.bind(context),\n        onAdclicked: onAdClicked.bind(context),\n        onAdskipped: onAdSkipped.bind(context),\n        onAdcompleted: onAdCompleted.bind(context),\n        onAdscompleted: onAdsCompleted.bind(context),\n        onAdcanskip: onAdCanSkip.bind(context),\n        onAdbreakstart: onAdBreakStart.bind(context),\n        onAdbreakend: onAdBreakEnd.bind(context),\n        onAdfirstquartile: onAdEvent.bind(context),\n        onAdmidpoint: onAdEvent.bind(context),\n        onAdthirdquartile: onAdEvent.bind(context),\n        onAdlog: onAdLog.bind(context),\n        onAderror: onAdError.bind(context),\n        onUserclosedad: onAdEvent.bind(context),\n        onAdvolumechanged: onAdEvent.bind(context),\n        onAdmuted: onAdEvent.bind(context),\n        onAdprogress: onAdProgress.bind(context),\n        onAdbuffering: onAdEvent.bind(context),\n        onEnterState: onEnterState.bind(context),\n        onPendingTransition: onPendingTransition.bind(context)\n      },\n      plugins: [new StateMachineHistory()]\n    });\n  }\n}\n\n/**\n * LOADED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdLoaded(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  const adBreakType = getAdBreakType.call(this, adEvent);\n  const adOptions = getAdOptions.call(this, adEvent);\n  const ad = new Ad(adEvent.getAd().getAdId(), adOptions);\n  Utils.Dom.setAttribute(this._adsContainerDiv, 'data-adtype', adBreakType);\n  this.logger.warn(`adType and extraAdData fields will be deprecated soon from AD_LOADED event payload. See docs for more information`);\n  this.dispatchEvent(options.transition, {\n    ad: ad,\n    adType: adBreakType, // for backward compatibility\n    extraAdData: adEvent.getAdData() // for backward compatibility\n  });\n}\n\n/**\n * STARTED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdStarted(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this._currentAd = adEvent.getAd();\n  this._adVideoTagAlreadyPlayed = true;\n  this._resizeAd();\n  this._maybeDisplayCompanionAds();\n  if (!this._currentAd.isLinear()) {\n    if (this._nextPromise) {\n      this._resolveNextPromise();\n    } else {\n      this.player.play();\n    }\n  } else {\n    this._showAdsContainer();\n  }\n  const adOptions = getAdOptions.call(this, adEvent);\n  const ad = new Ad(adEvent.getAd().getAdId(), adOptions);\n  this.dispatchEvent(options.transition, {ad});\n}\n\n/**\n * CLICKED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdClicked(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  if (this._currentAd.isLinear()) {\n    this._maybeIgnoreClickOnAd();\n    if (this._stateMachine.is(State.PLAYING)) {\n      this._adsManager.pause();\n    }\n    this._setToggleAdsCover(true);\n  } else {\n    if (!this.player.paused) {\n      this.player.pause();\n    }\n  }\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * RESUMED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdResumed(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this._setToggleAdsCover(false);\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * COMPLETE event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdCompleted(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * ADS_COMPLETED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdsCompleted(options: Object, adEvent: any): void {\n  this.logger.debug(options.transition.toUpperCase());\n  if (this.playOnMainVideoTag() && this._contentComplete && !this.player.config.playback.playAdsWithMSE) {\n    this.player.getVideoElement().src = this._contentSrc;\n  }\n  onAdBreakEnd.call(this, options, adEvent);\n}\n\n/**\n * CONTENT_PAUSED_REQUESTED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdBreakStart(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this.player.pause();\n  const adBreakOptions = getAdBreakOptions.call(this, adEvent);\n  const adBreak = new AdBreak(adBreakOptions);\n  this._maybeSavePlayerSnapshot();\n  this._maybeForceExitFullScreen();\n  this._maybeSaveVideoCurrentTime();\n  this.dispatchEvent(options.transition, {adBreak: adBreak});\n}\n\n/**\n * CONTENT_RESUMED_REQUESTED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdBreakEnd(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this._currentAd = null;\n  if (!this._contentComplete) {\n    if (this.config.forceReloadMediaAfterAds) {\n      this.eventManager.listenOnce(this.player, this.player.Event.LOADED_DATA, () => {\n        this._maybeSetVideoCurrentTime();\n        this.player.play();\n      });\n      this.player.getVideoElement().load();\n    }\n    this._hideAdsContainer();\n    this._maybeSetVideoCurrentTime();\n    if (this._nextPromise) {\n      this._resolveNextPromise();\n    } else if (!this.config.forceReloadMediaAfterAds) {\n      this.player.play();\n    }\n  }\n  this._maybeRestorePlayerSnapshot();\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * LOG event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdLog(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  let adError;\n  if (typeof adEvent.getAdData === 'function') {\n    adError = adEvent.getAdData().adError;\n  } else if (typeof adEvent.getError === 'function') {\n    adError = adEvent.getError();\n  }\n  if (adError) {\n    this.logger.error('Non-fatal error occurred: ' + adError.getMessage());\n    this.dispatchEvent(this.player.Event.AD_ERROR, getAdError.call(this, adError, false));\n  }\n}\n\n/**\n * ERROR event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdError(options: Object, adEvent: any): void {\n  if (this._playAdByConfig()) {\n    this.logger.debug(adEvent.type.toUpperCase());\n    let adError = adEvent.getError();\n    // if this is autoplay or user already requested play then next promise will handle reset\n    if (this._nextPromise) {\n      //ads playing on same video tag wait to ima to end the source replacement\n      if (this.playOnMainVideoTag() && this.player.env.os.name !== 'iOS') {\n        setTimeout(\n          () => {\n            this._nextPromise.reject(adError);\n          },\n          0,\n          adError\n        );\n      } else {\n        this._nextPromise.reject(adError);\n      }\n    } else {\n      this.reset();\n    }\n    this.dispatchEvent(options.transition, getAdError.call(this, adError, true));\n  }\n}\n\n/**\n * SKIPPED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdSkipped(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * SKIPPABLE_STATE_CHANGED event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdCanSkip(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  if (this._adsManager.getAdSkippableState()) {\n    this.dispatchEvent(options.transition);\n  }\n}\n\n/**\n * AD_PROGRESS event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdProgress(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  const remainingTime = this._adsManager.getRemainingTime();\n  const duration = adEvent.getAdData() && adEvent.getAdData().duration;\n  const currentTime = duration - remainingTime;\n  if (Utils.Number.isNumber(duration) && Utils.Number.isNumber(currentTime)) {\n    this.dispatchEvent(options.transition, {\n      adProgress: {\n        currentTime: currentTime,\n        duration: duration\n      }\n    });\n  }\n}\n\n/**\n * General event handler.\n * @param {Object} options - fsm event data.\n * @param {any} adEvent - ima event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onAdEvent(options: Object, adEvent: any): void {\n  this.logger.debug(adEvent.type.toUpperCase());\n  this.dispatchEvent(options.transition);\n}\n\n/**\n * Enter state handler.\n * @param {Object} options - fsm event data.\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onEnterState(options: Object): void {\n  if (options.from !== options.to) {\n    this.logger.debug('Change state: ' + options.from + ' => ' + options.to);\n  }\n}\n\n/**\n * onPendingTransition handler\n * @param {string} transition - transition\n * @param {string} from - from\n * @param {string} to - to\n * @returns {void}\n * @private\n * @memberof ImaStateMachine\n */\nfunction onPendingTransition(transition: string, from: string, to: string): void {\n  this.logger.warn('The previous transition is still in progress', {transition, from, to});\n}\n\n/**\n * Gets the ad error object.\n * @param {any} adError - The ima ad error object.\n * @param {boolean} fatal - Whether the error is fatal.\n * @returns {Error} - The ad error object.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdError(adError: any, fatal: boolean): Error {\n  const severity = fatal ? Error.Severity.CRITICAL : Error.Severity.RECOVERABLE;\n  const category = Error.Category.ADS;\n  let code;\n  try {\n    if (adError.getVastErrorCode() !== 900) {\n      code = parseInt(Error.Category.ADS + adError.getVastErrorCode());\n    } else {\n      code = Error.Code.AD_UNDEFINED_ERROR;\n    }\n  } catch (e) {\n    code = Error.Code.AD_UNDEFINED_ERROR;\n  }\n  let ad;\n  if (this._adsManager) {\n    try {\n      const currentAd = this._adsManager.getCurrentAd();\n      const adEvent = {getAd: () => currentAd, getAdData: () => undefined};\n      const adOptions = getAdOptions.call(this, adEvent);\n      ad = new Ad(currentAd.getAdId(), adOptions);\n    } catch (e) {\n      //do nothing\n    }\n  }\n  return new Error(severity, category, code, {\n    ad,\n    innerError: adError\n  });\n}\n\n/**\n * Gets the ad options.\n * @param {any} adEvent - The ima ad event object.\n * @returns {Object} - The ad options.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdOptions(adEvent: any): Object {\n  const adOptions = {};\n  const ad = adEvent.getAd();\n  const adData = adEvent.getAdData();\n  const podInfo = ad.getAdPodInfo();\n  adOptions.system = ad.getAdSystem();\n  adOptions.url = ad.getMediaUrl();\n  adOptions.clickThroughUrl = adData && adData.clickThroughUrl;\n  adOptions.contentType = ad.getContentType();\n  adOptions.duration = ad.getDuration();\n  adOptions.position = this._adPosition || podInfo.getAdPosition();\n  adOptions.title = ad.getTitle();\n  adOptions.linear = ad.isLinear();\n  adOptions.skipOffset = ad.getSkipTimeOffset();\n  adOptions.width = ad.isLinear() ? ad.getVastMediaWidth() : ad.getWidth();\n  adOptions.height = ad.isLinear() ? ad.getVastMediaHeight() : ad.getHeight();\n  adOptions.bitrate = ad.getVastMediaBitrate();\n  adOptions.bumper = podInfo.getIsBumper() || this._isBumper;\n  return adOptions;\n}\n\n/**\n * Gets the ad break options.\n * @param {any} adEvent - The ima ad event object.\n * @returns {Object} - The ad break options.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdBreakOptions(adEvent: any): Object {\n  const adBreakOptions = {};\n  adBreakOptions.numAds = this._podLength || adEvent.getAd().getAdPodInfo().getTotalAds();\n  adBreakOptions.position = this.player.ended ? -1 : this.player.currentTime;\n  adBreakOptions.type = getAdBreakType.call(this, adEvent);\n  return adBreakOptions;\n}\n\n/**\n * Gets the ad break type.\n * @param {any} adEvent - The ima ad event object.\n * @returns {string} - The ad break type.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdBreakType(adEvent: any): string {\n  try {\n    const ad = adEvent.getAd();\n    if (!ad.isLinear()) {\n      return AdBreakType.OVERLAY;\n    }\n  } catch (e) {\n    // do nothing\n  }\n  if (this._playAdByConfig()) {\n    return getAdBreakTypeFromSdk(adEvent);\n  } else {\n    return this._getAdBreakTypeFromPlayer();\n  }\n}\n\n/**\n * Gets the ad break type from ima sdk.\n * @param {any} adEvent - The ima ad event object.\n * @returns {string} - The ad break type.\n * @private\n * @memberof ImaStateMachine\n */\nfunction getAdBreakTypeFromSdk(adEvent: any): string {\n  const ad = adEvent.getAd();\n  const podInfo = ad.getAdPodInfo();\n  const podIndex = podInfo.getPodIndex();\n  if (!ad.isLinear()) {\n    return AdBreakType.OVERLAY;\n  }\n  switch (podIndex) {\n    case 0:\n      return AdBreakType.PRE;\n    case -1:\n      return AdBreakType.POST;\n    default:\n      return AdBreakType.MID;\n  }\n}\n\nexport {ImaStateMachine};\n","// @flow\nimport {core} from 'kaltura-player-js';\nimport {Ima} from './ima';\n\nconst {FakeEvent} = core;\n\n/**\n * Engine decorator for ima plugin.\n * @class ImaEngineDecorator\n * @param {IEngine} engine - The HTML5 engine.\n * @param {Ima} plugin - The ima plugin.\n * @implements {IEngineDecorator}\n */\nclass ImaEngineDecorator implements IEngineDecorator {\n  _plugin: Ima;\n\n  constructor(engine: IEngine, plugin: Ima) {\n    this._plugin = plugin;\n  }\n\n  get active(): boolean {\n    return this._plugin.playOnMainVideoTag() && this._plugin.isAdPlaying();\n  }\n\n  dispatchEvent(event: FakeEvent): boolean {\n    return event.defaultPrevented;\n  }\n  /**\n   * Get paused state.\n   * @returns {boolean} - The paused value of the engine.\n   * @public\n   * @override\n   * @instance\n   * @memberof ImaEngineDecorator\n   */\n  get paused(): boolean {\n    return true;\n  }\n  /**\n   * Get the current time in seconds.\n   * @returns {number} - The current playback time.\n   * @public\n   * @override\n   * @instance\n   * @memberof ImaEngineDecorator\n   */\n  get currentTime(): number {\n    return this._plugin.getContentTime();\n  }\n  /**\n   * Set the current time in seconds.\n   * @param {number} to - The number to set in seconds.\n   * @public\n   * @returns {void}\n   */\n  set currentTime(to: number): void {\n    // Do nothing\n  }\n  /**\n   * Get the duration in seconds.\n   * @returns {number} - The playback duration.\n   * @public\n   * @override\n   * @instance\n   * @memberof ImaEngineDecorator\n   */\n  get duration(): number {\n    return this._plugin.getContentDuration();\n  }\n  /**\n   * Get ended state\n   * @returns {boolean} - media ended\n   * @public\n   * @override\n   * @instance\n   * @memberof ImaEngineDecorator\n   */\n  get ended(): boolean {\n    return this._plugin.getContentEnded();\n  }\n}\n\nexport {ImaEngineDecorator};\n","// @flow\nimport {core, BasePlugin} from 'kaltura-player-js';\nimport {ImaMiddleware} from './ima-middleware';\nimport {ImaAdsController} from './ima-ads-controller';\nimport {ImaStateMachine} from './ima-state-machine';\nimport {State} from './state';\nimport './assets/style.css';\nimport {ImaEngineDecorator} from './ima-engine-decorator';\n\nconst {BaseMiddleware, EngineType, Error, getCapabilities, Utils, Env, AudioTrack, TextTrack, EventManager, AdBreakType} = core;\n\n/**\n * The full screen events..\n * @type {Array<string>}\n * @const\n * @private\n */\nconst FULL_SCREEN_EVENTS: Array<string> = ['fullscreenchange', 'mozfullscreenchange', 'webkitfullscreenchange'];\n\n/**\n * The overlay ad margin.\n * @type {number}\n * @const\n * @private\n */\nconst OVERLAY_AD_MARGIN: number = 8;\n/**\n * The ads container class.\n * @type {string}\n * @const\n * @private\n */\nconst ADS_CONTAINER_CLASS: string = 'playkit-ads-container';\n/**\n * The ads cover class.\n * @type {string}\n * @const\n * @private\n */\nconst ADS_COVER_CLASS: string = 'playkit-ads-cover';\n\n/**\n * The ima plugin.\n * @class Ima\n * @param {string} name - The plugin name.\n * @param {Player} player - The player instance.\n * @param {ImaConfigObject} config - The plugin config.\n * @implements {IMiddlewareProvider}\n * @implements {IAdsControllerProvider}\n * @implements {IEngineDecoratorProvider}\n * @extends BasePlugin\n */\nclass Ima extends BasePlugin implements IMiddlewareProvider, IAdsControllerProvider, IEngineDecoratorProvider {\n  /**\n   * The default configuration of the plugin.\n   * @type {Object}\n   * @static\n   * @memberof Ima\n   */\n  static defaultConfig: Object = {\n    debug: false,\n    delayInitUntilSourceSelected: Env.os.name === 'iOS',\n    disableMediaPreload: false,\n    forceReloadMediaAfterAds: false,\n    adsRenderingSettings: {\n      restoreCustomPlaybackStateOnAdBreakComplete: false,\n      enablePreloading: false,\n      useStyledLinearAds: false,\n      useStyledNonLinearAds: true,\n      bitrate: -1,\n      autoAlign: true,\n      loadVideoTimeout: -1\n    },\n    companions: {\n      ads: null,\n      sizeCriteria: 'SELECT_EXACT_MATCH'\n    }\n  };\n\n  /**\n   * The sdk lib url.\n   * @type {string}\n   * @static\n   * @private\n   * @memberof Ima\n   */\n  static IMA_SDK_LIB_URL: string = '//imasdk.googleapis.com/js/sdkloader/ima3.js';\n  /**\n   * The debug sdk lib url.\n   * @type {string}\n   * @static\n   * @private\n   * @memberof Ima\n   */\n  static IMA_SDK_DEBUG_LIB_URL: string = '//imasdk.googleapis.com/js/sdkloader/ima3_debug.js';\n  /**\n   * Promise for loading the plugin.\n   * Will be resolved after:\n   * 1) Ima script has been loaded in the page.\n   * 2) The ads manager has been loaded and ready to start.\n   * @type {Promise<*>}\n   * @member\n   * @public\n   * @memberof Ima\n   */\n  loadPromise: DeferredPromise;\n  /**\n   * The finite state machine of the plugin.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _stateMachine: any;\n  /**\n   * The sdk api.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _sdk: any;\n  /**\n   * The ads container dom element.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _adsContainerDiv: HTMLElement;\n  /**\n   * The ads cover dom element.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _adsCoverDiv: HTMLElement;\n  /**\n   * The ima ads container object.\n   * @private\n   * @memberof Ima\n   */\n  _adDisplayContainer: any;\n  /**\n   * The ima ads manager.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _adsManager: any;\n  /**\n   * The ima ads loader.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _adsLoader: any;\n  /**\n   * The content tracker.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _contentPlayheadTracker: Object;\n  /**\n   * Flag to know when content complete.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _contentComplete: boolean;\n  /**\n   * Video current time before ads.\n   * On custom playback when only one video tag playing, save the video current time.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _videoLastCurrentTime: ?number;\n  /**\n   * The promise which when resolved starts the next handler in the middleware chain.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _nextPromise: ?DeferredPromise;\n  /**\n   * The current playing ad.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _currentAd: any;\n  /**\n   * The content media duration.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _contentDuration: ?number;\n  /**\n   * The content media src.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _contentSrc: string;\n\n  /**\n   * Whether an initial user action happened.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _hasUserAction: boolean;\n  /**\n   * Whether the ads manager loaded.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _isAdsManagerLoaded: boolean;\n  /**\n   * The bounded handler of the ads container click.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _togglePlayPauseOnAdsContainerCallback: ?Function;\n  /**\n   * Whether the ads cover overlay is active.\n   * @member\n   * @private\n   * @memberof Ima\n   */\n  _isAdsCoverActive: boolean;\n  _selectedAudioTrack: ?AudioTrack;\n  _selectedTextTrack: ?TextTrack;\n  _selectedPlaybackRate: number;\n  _textTracksHidden: Array<string>;\n  _adBreaksEventManager: EventManager;\n  _podLength: number;\n  _adPosition: number;\n  _firstOfAdPod: boolean;\n  _waterfalled: boolean;\n  _isBumper: boolean;\n  _adVideoTagAlreadyPlayed: boolean = false;\n\n  /**\n   * Whether the ima plugin is valid.\n   * @static\n   * @override\n   * @public\n   * @memberof Ima\n   */\n  static isValid() {\n    return true;\n  }\n\n  constructor(name: string, player: KalturaPlayer, config: Object) {\n    super(name, player, config);\n    this._stateMachine = new ImaStateMachine(this);\n    this._initMembers();\n    this._init();\n  }\n\n  /**\n   * Gets the engine decorator.\n   * @param {IEngine} engine - The engine to decorate.\n   * @public\n   * @returns {IEngineDecorator} - The ads api.\n   * @instance\n   * @memberof Ima\n   */\n  getEngineDecorator(engine: IEngine): IEngineDecorator {\n    return new ImaEngineDecorator(engine, this);\n  }\n\n  /**\n   * Gets the middleware.\n   * @public\n   * @returns {ImaMiddleware} - The middleware api.\n   * @instance\n   * @memberof Ima\n   */\n  getMiddlewareImpl(): BaseMiddleware {\n    return new ImaMiddleware(this);\n  }\n\n  /**\n   * Gets the ads controller.\n   * @public\n   * @returns {IAdsPluginController} - The ads api.\n   * @instance\n   * @memberof Ima\n   */\n  getAdsController(): IAdsPluginController {\n    return new ImaAdsController(this);\n  }\n\n  /**\n   * Plays ad on demand\n   * @param {KPAdPod} adPod - The ad pod to play.\n   * @returns {void}\n   * @public\n   * @instance\n   * @memberof Ima\n   */\n  playAdNow(adPod: KPAdPod): void {\n    if (Array.isArray(adPod) && !(this.isAdPlaying() || this._playAdByConfig())) {\n      this._playAdBreak(adPod);\n    }\n  }\n\n  _playAdBreak(adPod: KPAdPod): void {\n    this._podLength = adPod.length;\n    this._adPosition = 1;\n    this._firstOfAdPod = true;\n    this._waterfalled = false;\n    this.loadPromise\n      .then(() => {\n        this._playAd(adPod);\n        if (!this._hasUserAction && this.player.currentTime > 0) {\n          this.initialUserAction();\n        }\n      })\n      .catch(() => {});\n  }\n\n  _playAd(adPod: KPAdPod): void {\n    const ad = adPod[0];\n    const playNext = () => {\n      adPod.shift();\n      this._adBreaksEventManager.removeAll();\n      this._waterfalled = false;\n      this._podLength = adPod.length;\n      this._adPosition++;\n      this._playAd(adPod);\n    };\n    const waterfall = error => {\n      this.dispatchEvent(this.player.Event.AD_WATERFALLING, {\n        adFailed: {\n          url: ad.url ? ad.url[0] : '',\n          response: !ad.url && ad.response ? ad.response[0] : '',\n          data: error,\n          adBreak: this._getAdBreakTypeFromPlayer(),\n          position: this._adPosition\n        }\n      });\n      this._adBreaksEventManager.removeAll();\n      this._waterfalled = true;\n      ad.url ? ad.url.shift() : ad.response && ad.response.shift();\n      this._playAd(adPod);\n    };\n    const onError = error => {\n      if ((ad.url && ad.url.length > 1) || (!ad.url && ad.response && ad.response.length > 1)) {\n        waterfall(error);\n      } else {\n        if (this._waterfalled) {\n          this.dispatchEvent(this.player.Event.AD_WATERFALLING_FAILED);\n        }\n        this._stateMachine.adlog(error);\n        playNext();\n      }\n    };\n    if (ad) {\n      this._adBreaksEventManager.listen(this._adsLoader, this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, () => {\n        this._adBreaksEventManager.listen(this._adsManager, this._sdk.AdEvent.Type.COMPLETE, playNext);\n        this._adBreaksEventManager.listen(this._adsManager, this._sdk.AdEvent.Type.SKIPPED, playNext);\n        this._adBreaksEventManager.listen(this._adsManager, this._sdk.AdEvent.Type.LOG, onError);\n        this._adBreaksEventManager.listen(this._adsManager, this._sdk.AdErrorEvent.Type.AD_ERROR, onError);\n      });\n      this._adBreaksEventManager.listen(this._adsLoader, this._sdk.AdErrorEvent.Type.AD_ERROR, error => {\n        onError(error);\n        if (this._podLength === 0) {\n          if (this.player.ads.isAdBreak()) {\n            this._stateMachine.adbreakend({type: this._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED});\n          }\n          if (this._hasUserAction) {\n            this._stateMachine.adscompleted({type: this._sdk.AdEvent.Type.ALL_ADS_COMPLETED});\n          } else {\n            this.eventManager.listen(this.player, this.player.Event.FIRST_PLAY, () => {\n              this._stateMachine.adscompleted({type: this._sdk.AdEvent.Type.ALL_ADS_COMPLETED});\n            });\n          }\n        }\n      });\n      this._isBumper = !!ad.bumper;\n      this._requestAds(ad.url && ad.url[0], ad.response && ad.response[0]);\n    }\n  }\n\n  _getAdBreakTypeFromPlayer(): string {\n    if (this.player.ended) {\n      return AdBreakType.POST;\n    }\n    if (this.player.currentTime > 0) {\n      return AdBreakType.MID;\n    }\n    return AdBreakType.PRE;\n  }\n\n  /**\n   * Skips on an ad.\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  skipAd(): void {\n    this.logger.debug('Skip ad');\n    if (this._adsManager) {\n      if (this._adsManager.getAdSkippableState()) {\n        this._adsManager.skip();\n      } else if (this.config.skipSupport) {\n        this._adsManager.stop();\n      }\n    }\n  }\n\n  /**\n   * Resuming the ad.\n   * @public\n   * @returns {DeferredPromise} - The promise which when resolved starts the next handler in the middleware chain.\n   * @instance\n   * @memberof Ima\n   */\n  resumeAd(): ?DeferredPromise {\n    this.logger.debug('Resume ad');\n    this._nextPromise = Utils.Object.defer();\n    this._adsManager.resume();\n    return this._nextPromise;\n  }\n\n  /**\n   * Pausing the ad.\n   * @public\n   * @returns {DeferredPromise} - The promise which when resolved starts the next handler in the middleware chain.\n   * @instance\n   * @memberof Ima\n   */\n  pauseAd(): ?DeferredPromise {\n    this.logger.debug('Pause ad');\n    this._adsManager.pause();\n  }\n\n  /**\n   * Gets the state machine.\n   * @public\n   * @returns {any} - The state machine.\n   * @instance\n   * @memberof Ima\n   */\n  getStateMachine(): any {\n    return this._stateMachine;\n  }\n\n  /**\n   * Gets the indicator if ads playing on the main video tag\n   * @public\n   * @returns {boolean} - if ads playing on the main video tag.\n   * @instance\n   * @memberof Ima\n   */\n  playOnMainVideoTag() {\n    return !!this._adsManager && !!this._adsManager.isCustomPlaybackUsed();\n  }\n\n  /**\n   * Gets the indicator if ads still playing.\n   * @public\n   * @returns {boolean} - if ads still playing.\n   * @instance\n   * @memberof Ima\n   */\n  isAdPlaying(): boolean {\n    return this._stateMachine.is(State.PLAYING) || this._stateMachine.is(State.PENDING) || this._stateMachine.is(State.PAUSED);\n  }\n\n  getContentTime(): number {\n    let currentTime = 0;\n    //current time exist for mid-roll otherwise it's pre-roll(start of video - 0) - post-roll(end of video)\n    if (this._videoLastCurrentTime) {\n      currentTime = this._videoLastCurrentTime;\n    } else if (this._contentComplete) {\n      currentTime = this.getContentDuration();\n    }\n    return currentTime;\n  }\n\n  getContentDuration(): number {\n    return this._contentDuration || this.player.config.sources.duration || 0;\n  }\n\n  getContentSrc(): string {\n    return this._contentSrc || '';\n  }\n  getContentEnded(): boolean {\n    return this._contentComplete;\n  }\n  /**\n   * Prepare the plugin before media is loaded.\n   * @override\n   * @public\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  loadMedia(): void {\n    this._addBindings();\n    if (this._playAdByConfig()) {\n      this.loadPromise.then(() => this._requestAds()).catch(() => {});\n    }\n  }\n\n  /**\n   * Resets the plugin.\n   * @override\n   * @public\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  reset(): void {\n    this.logger.debug('reset');\n    this.eventManager.removeAll();\n    this._adBreaksEventManager.removeAll();\n    this._hideAdsContainer();\n    if (!this._isImaSDKLibLoaded()) {\n      return;\n    }\n    if (this._adsManager) {\n      this._adsManager.destroy();\n    }\n    if (this._adsLoader && !this._contentComplete) {\n      this._adsLoader.contentComplete();\n    }\n    this._stateMachine.goto(State.DONE);\n    this._initMembers();\n  }\n\n  /**\n   * Destroys the plugin.\n   * @override\n   * @public\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  destroy(): void {\n    this.logger.debug('destroy');\n    this.eventManager.destroy();\n    this._hideAdsContainer();\n    if (this._adsManager) {\n      this._adsManager.destroy();\n    }\n    if (this._adsLoader && !this._contentComplete) {\n      this._adsLoader.contentComplete();\n    }\n    if (this._adDisplayContainer) {\n      this._adDisplayContainer.destroy();\n    }\n    this._adsLoader = null;\n  }\n\n  /**\n   * Initialize the ads for the first time.\n   * @public\n   * @returns {?DeferredPromise} - The promise which when resolved starts the next handler in the middleware chain.\n   * @instance\n   * @memberof Ima\n   */\n  initialUserAction(): ?DeferredPromise {\n    try {\n      this.logger.debug('Initial user action');\n      this._nextPromise = Utils.Object.defer();\n      this._adDisplayContainer.initialize();\n      this._hasUserAction = true;\n      if (this._isAdsManagerLoaded) {\n        this.logger.debug('User action occurred after ads manager loaded');\n        this._startAdsManager();\n      }\n    } catch (adError) {\n      this.logger.error(adError);\n      this.reset();\n    }\n    return this._nextPromise;\n  }\n\n  /**\n   * Starts the ads manager.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _startAdsManager(): void {\n    this.logger.debug('Start ads manager');\n    const readyPromise = this.playOnMainVideoTag() && !this.config.disableMediaPreload ? this.player.ready() : Promise.resolve();\n    readyPromise.then(() => {\n      this._adsManager.init(this.player.dimensions.width, this.player.dimensions.height, this._sdk.ViewMode.NORMAL);\n      this._adsManager.start();\n    });\n  }\n\n  /**\n   * Adding bindings.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _addBindings(): void {\n    FULL_SCREEN_EVENTS.forEach(fullScreenEvent => this.eventManager.listen(document, fullScreenEvent, () => this._resizeAd()));\n    this.eventManager.listen(this.player, 'resize', () => this._resizeAd());\n    this.eventManager.listen(this.player, this.player.Event.MUTE_CHANGE, () => this._syncPlayerVolume());\n    this.eventManager.listen(this.player, this.player.Event.VOLUME_CHANGE, () => this._syncPlayerVolume());\n    this.eventManager.listen(this.player, this.player.Event.SOURCE_SELECTED, event => {\n      let selectedSource = event.payload.selectedSource;\n      if (selectedSource && selectedSource.length > 0) {\n        this._contentSrc = selectedSource[0].url;\n      }\n    });\n    this.eventManager.listenOnce(this.player, this.player.Event.DURATION_CHANGE, () => {\n      this._contentDuration = this.player.duration;\n    });\n    this.eventManager.listen(this.player, this.player.Event.ERROR, event => {\n      if (event.payload && event.payload.severity === Error.Severity.CRITICAL) {\n        this.reset();\n      }\n    });\n    this.eventManager.listen(this.player, this.player.Event.FIRST_PLAY, () => {\n      if (this._currentAd && !this._currentAd.isLinear()) {\n        this._showAdsContainer();\n      }\n    });\n    this.eventManager.listen(this.player, this.player.Event.MEDIA_LOADED, () => {\n      this._adsManager.updateAdsRenderingSettings({\n        restoreCustomPlaybackStateOnAdBreakComplete: !this.player.config.playback.playAdsWithMSE\n      });\n    });\n    this.eventManager.listen(this.player, this.player.Event.ENDED, () => this._onMediaEnded());\n    this.eventManager.listen(this.player, this.player.Event.LOADED_METADATA, () => this._onLoadedMetadata());\n    this.eventManager.listen(this.player, this.player.Event.TIME_UPDATE, () => this._onMediaTimeUpdate());\n    this.eventManager.listen(this.player, this.player.Event.SEEKING, () => this._onMediaSeeking());\n    this.eventManager.listen(this.player, this.player.Event.SEEKED, () => this._onMediaSeeked());\n    if (!this._playAdByConfig()) {\n      this.eventManager.listenOnce(this.player, this.player.Event.USER_GESTURE, () => {\n        if (!this._adVideoTagAlreadyPlayed) {\n          this._adDisplayContainer.initialize();\n        }\n      });\n    }\n  }\n\n  /**\n   * Init the members of the plugin.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _initMembers(): void {\n    this._nextPromise = null;\n    this._currentAd = null;\n    this._adsManager = null;\n    this._contentComplete = false;\n    this._isAdsManagerLoaded = false;\n    this._videoLastCurrentTime = null;\n    this._contentPlayheadTracker = {currentTime: 0, previousTime: 0, seeking: false, duration: 0};\n    this._hasUserAction = false;\n    this._togglePlayPauseOnAdsContainerCallback = null;\n    this._contentDuration = null;\n    this._selectedAudioTrack = null;\n    this._selectedTextTrack = null;\n    this._selectedPlaybackRate = 1;\n    this._textTracksHidden = [];\n    this._adBreaksEventManager = new EventManager();\n    this._podLength = 0;\n    this._adPosition = 0;\n    this._firstOfAdPod = false;\n    this._waterfalled = false;\n    this._isBumper = false;\n  }\n\n  /**\n   * Initializing the plugin.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _init(): void {\n    this.loadPromise = Utils.Object.defer();\n    this._maybeDelayInitUntilSourceSelected()\n      .then(() => this._loadImaSDKLib())\n      .then(() => {\n        this._sdk = window.google.ima;\n        this.logger.debug('IMA SDK version: ' + this._sdk.VERSION);\n        this._initImaSettings();\n        this._initAdsContainer();\n        this._initAdsLoader();\n        this.loadPromise.resolve();\n      })\n      .catch(e => {\n        this.loadPromise.reject(e);\n      });\n  }\n\n  /**\n   * If configured, wait until source selected before will continue the initialization of the plugin.\n   * @returns {Promise<*>} -\n   * @private\n   * @instance\n   * @memberof Ima\n   */\n  _maybeDelayInitUntilSourceSelected(): Promise<*> {\n    if (this.config.delayInitUntilSourceSelected) {\n      return new Promise((resolve, reject) => {\n        if (this._contentSrc) {\n          // Source selected event already dispatched\n          resolve();\n        } else {\n          this.eventManager.listenOnce(this.player, this.player.Event.SOURCE_SELECTED, resolve);\n          this.eventManager.listenOnce(this.player, this.player.Event.ERROR, error => {\n            if (error.payload.severity === Error.Severity.CRITICAL) {\n              reject(error);\n            }\n          });\n        }\n      });\n    } else {\n      return Promise.resolve();\n    }\n  }\n\n  /**\n   * Loads the ima sdk lib.\n   * @returns {Promise<*>} - The promise result for the load operation.\n   * @private\n   * @instance\n   * @memberof Ima\n   */\n  _loadImaSDKLib(): Promise<*> {\n    const imaSdkUrl = Utils.Http.protocol + (this.config.debug ? Ima.IMA_SDK_DEBUG_LIB_URL : Ima.IMA_SDK_LIB_URL);\n    return this._isImaSDKLibLoaded() ? Promise.resolve() : Utils.Dom.loadScriptAsync(imaSdkUrl);\n  }\n\n  /**\n   * Checks for ima sdk lib availability.\n   * @returns {boolean} - Whether ima sdk lib is loaded.\n   * @private\n   * @instance\n   * @memberof Ima\n   */\n  _isImaSDKLibLoaded(): boolean {\n    return window.google && window.google.ima && window.google.ima.VERSION;\n  }\n\n  /**\n   * Init ima settings.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _initImaSettings(): void {\n    this._sdk.settings.setPlayerType(this.config.playerName);\n    this._sdk.settings.setPlayerVersion(this.config.playerVersion);\n    this._sdk.settings.setVpaidAllowed(true);\n    this._sdk.settings.setVpaidMode(this._getVpaidMode());\n    if (Object.prototype.hasOwnProperty.call(this.config, 'locale')) {\n      this._sdk.settings.setLocale(this.config.locale);\n    }\n    if (typeof this.config.setDisableCustomPlaybackForIOS10Plus === 'boolean') {\n      this._sdk.settings.setDisableCustomPlaybackForIOS10Plus(this.config.setDisableCustomPlaybackForIOS10Plus);\n    } else {\n      this._sdk.settings.setDisableCustomPlaybackForIOS10Plus(this.player.config.playback.playsinline);\n    }\n    if (typeof this.config.numRedirects === 'number') {\n      this._sdk.settings.setNumRedirects(this.config.numRedirects);\n    }\n  }\n\n  /**\n   * Gets the vpaid mode.\n   * @private\n   * @returns {number} - The vpaid mode.\n   * @instance\n   * @memberof Ima\n   */\n  _getVpaidMode(): number {\n    const vpaidmode = this._sdk.ImaSdkSettings.VpaidMode[this.config.vpaidMode];\n    if (this.config.vpaidMode && typeof vpaidmode === 'number') {\n      this.logger.debug('VpaidMode: set to ' + this.config.vpaidMode);\n      return vpaidmode;\n    } else {\n      this.logger.warn('VpaidMode is not set, setting to ENABLED');\n      return this._sdk.ImaSdkSettings.VpaidMode.ENABLED;\n    }\n  }\n\n  /**\n   * Initializing the ad container.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _initAdsContainer(): void {\n    this.logger.debug('Init ads container');\n    const playerView = this.player.getView();\n    // Create ads container\n    this._adsContainerDiv = Utils.Dom.createElement('div');\n    this._adsContainerDiv.id = ADS_CONTAINER_CLASS + playerView.id;\n    this._adsContainerDiv.className = ADS_CONTAINER_CLASS;\n\n    // Create ads cover\n    this._adsCoverDiv = Utils.Dom.createElement('div');\n    this._adsCoverDiv.id = ADS_COVER_CLASS + playerView.id;\n    this._adsCoverDiv.className = ADS_COVER_CLASS;\n    this._adsCoverDiv.onclick = () => this._onAdsCoverClicked();\n    // Append the ads container to the dom\n    Utils.Dom.appendChild(playerView, this._adsContainerDiv);\n    this._adDisplayContainer = new this._sdk.AdDisplayContainer(this._adsContainerDiv, this.player.getVideoElement());\n  }\n\n  /**\n   * Initializing the ads loader.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _initAdsLoader(): void {\n    this.logger.debug('Init ads loader');\n    this._adsLoader = new this._sdk.AdsLoader(this._adDisplayContainer);\n    this._adsLoader.addEventListener(this._sdk.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, adsManagerLoadedEvent =>\n      this._onAdsManagerLoaded(adsManagerLoadedEvent)\n    );\n    this._adsLoader.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR, adEvent => this._stateMachine.aderror(adEvent));\n  }\n\n  /**\n   * Requests the ads from the ads loader.\n   * @param {?string} vastUrl - vast url.\n   * @param {?string} vastResponse - vast XML response.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _requestAds(vastUrl: ?string, vastResponse: ?string): void {\n    if (vastUrl || vastResponse || this._playAdByConfig()) {\n      this.logger.debug('Request ads');\n      // Request video ads\n      let adsRequest = new this._sdk.AdsRequest();\n      const adTagUrl = vastUrl || this.config.adTagUrl;\n      if (adTagUrl) {\n        adsRequest.adTagUrl = adTagUrl;\n      } else {\n        adsRequest.adsResponse = vastResponse || this.config.adsResponse;\n      }\n      if (typeof this.config.vastLoadTimeout === 'number') {\n        adsRequest.vastLoadTimeout = this.config.vastLoadTimeout;\n      }\n      adsRequest.linearAdSlotWidth = this.player.dimensions.width;\n      adsRequest.linearAdSlotHeight = this.player.dimensions.height;\n      adsRequest.nonLinearAdSlotWidth = this.player.dimensions.width;\n      adsRequest.nonLinearAdSlotHeight = this.player.dimensions.height / 3;\n\n      const muted = this.player.muted || this.player.volume === 0;\n      adsRequest.setAdWillPlayMuted(muted);\n\n      const adWillAutoPlay = this.config.adWillAutoPlay;\n      const playerWillAutoPlay = this.player.config.playback.autoplay;\n      const allowMutedAutoPlay = this.player.config.playback.allowMutedAutoPlay;\n\n      // Pass signal to IMA SDK if ad will autoplay with sound\n      // First let application config this, otherwise if player is configured\n      // to autoplay then try to autodetect if unmuted autoplay is supported\n      if (typeof adWillAutoPlay === 'boolean') {\n        adsRequest.setAdWillAutoPlay(adWillAutoPlay);\n        this._adsLoader.requestAds(adsRequest);\n      } else if (playerWillAutoPlay) {\n        getCapabilities(EngineType.HTML5).then(capabilities => {\n          // If the plugin has been destroyed while calling this promise\n          // the adsLoader will no longer exists\n          if (!this._adsLoader) return;\n\n          if (capabilities.autoplay) {\n            adsRequest.setAdWillAutoPlay(true);\n          } else if (allowMutedAutoPlay && capabilities.mutedAutoPlay) {\n            adsRequest.setAdWillAutoPlay(true);\n            adsRequest.setAdWillPlayMuted(true);\n          } else {\n            adsRequest.setAdWillAutoPlay(false);\n          }\n          this._adsLoader.requestAds(adsRequest);\n        });\n      } else {\n        adsRequest.setAdWillAutoPlay(false);\n        this._adsLoader.requestAds(adsRequest);\n      }\n      this._stateMachine.loaded();\n    } else {\n      this._stateMachine.goto(State.DONE);\n      this.logger.debug('Missing ad tag url: create plugin without requesting ads');\n    }\n  }\n\n  /**\n   * Resize event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _resizeAd() {\n    if (this._sdk && this._adsManager && this._currentAd) {\n      let viewMode = this.player.isFullscreen() ? this._sdk.ViewMode.FULLSCREEN : this._sdk.ViewMode.NORMAL;\n      if (this._currentAd.isLinear()) {\n        this._adsManager.resize(this.player.dimensions.width, this.player.dimensions.height, viewMode);\n      } else {\n        const adTotalWidth = this._currentAd.getWidth() + OVERLAY_AD_MARGIN;\n        const adTotalHeight = this._currentAd.getHeight() + OVERLAY_AD_MARGIN;\n        if (adTotalWidth <= this.player.dimensions.width && adTotalHeight <= this.player.dimensions.height) {\n          this._alignAdsContainerSizeForOverlayAd();\n          this._adsManager.resize(adTotalWidth, adTotalHeight, viewMode);\n          this._showAdsContainer();\n        } else {\n          this._hideAdsContainer();\n        }\n      }\n    }\n  }\n\n  /**\n   * Align the size for the ads container when overlay ad is displaying.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _alignAdsContainerSizeForOverlayAd(): void {\n    this._adsContainerDiv.style.bottom = this._currentAd.getHeight() + OVERLAY_AD_MARGIN + 'px';\n    this._adsContainerDiv.style.left = (this.player.dimensions.width - this._currentAd.getWidth()) / 2 + 'px';\n  }\n\n  /**\n   * Loadedmetada event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   * @instance\n   * @memberof Ima\n   */\n  _onLoadedMetadata(): void {\n    this._contentPlayheadTracker.duration = this.player.duration;\n  }\n\n  /**\n   * Timeupdate event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onMediaTimeUpdate(): void {\n    if (!this._contentPlayheadTracker.seeking && this.player.currentTime > 0) {\n      this._contentPlayheadTracker.previousTime = this._contentPlayheadTracker.currentTime;\n      this._contentPlayheadTracker.currentTime = this.player.currentTime;\n    }\n  }\n\n  /**\n   * Seeking event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onMediaSeeking(): void {\n    this._contentPlayheadTracker.seeking = true;\n  }\n\n  /**\n   * Seeked event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onMediaSeeked(): void {\n    this._contentPlayheadTracker.seeking = false;\n  }\n\n  /**\n   * Maybe save the video current time before ads starts (on ios this is necessary).\n   * @private\n   * @return {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeSaveVideoCurrentTime(): void {\n    if ((this.playOnMainVideoTag() || this.config.forceReloadMediaAfterAds) && this.player.currentTime && this.player.currentTime > 0) {\n      this.logger.debug('Custom playback used: save current time before ads', this.player.currentTime);\n      this._videoLastCurrentTime = this.player.currentTime;\n    }\n  }\n\n  /**\n   * Maybe sets the video current time after ads finished (on ios this is necessary).\n   * @private\n   * @return {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeSetVideoCurrentTime(): void {\n    if (this._videoLastCurrentTime) {\n      this.logger.debug('Custom playback used: set current time after ads', this._videoLastCurrentTime);\n      this.player.currentTime = this._videoLastCurrentTime;\n      this._videoLastCurrentTime = null;\n    }\n  }\n\n  /**\n   * Ended event handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onMediaEnded(): void {\n    this.logger.debug('Media ended');\n    this._contentComplete = true;\n    if (this._currentAd && !this._currentAd.isLinear()) {\n      this.reset();\n    }\n  }\n\n  /**\n   * Ended event handler.\n   * @public\n   * @returns {Promise<void>} - complete promise\n   * @instance\n   * @memberof Ima\n   */\n  onPlaybackEnded(): Promise<void> {\n    this.logger.debug('Playback ended');\n    this._adsLoader.contentComplete();\n    if (this._adsManager && this._adsManager.getCuePoints().includes(-1)) {\n      return new Promise(resolve => {\n        this.eventManager.listenOnce(this._adsManager, this._sdk.AdEvent.Type.ALL_ADS_COMPLETED, () => {\n          resolve();\n        });\n      });\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * Shows the ads container.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _showAdsContainer(): void {\n    if (this._adsContainerDiv) {\n      this._adsContainerDiv.style.visibility = 'visible';\n    }\n  }\n\n  /**\n   * Hides the ads container.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _hideAdsContainer(): void {\n    if (this._adsContainerDiv) {\n      this._adsContainerDiv.style.visibility = 'hidden';\n    }\n  }\n\n  /**\n   * The ads manager loaded handler.\n   * @param {any} adsManagerLoadedEvent - The event data.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onAdsManagerLoaded(adsManagerLoadedEvent: any): void {\n    this.logger.debug('Ads manager loaded');\n    const adsRenderingSettings = this._getAdsRenderingSetting();\n    this._adsManager = adsManagerLoadedEvent.getAdsManager(this._contentPlayheadTracker, adsRenderingSettings);\n    this.config.forceReloadMediaAfterAds = this.playOnMainVideoTag() ? false : this.config.forceReloadMediaAfterAds;\n    const cuePoints = this._adsManager.getCuePoints();\n    if (!cuePoints.length) {\n      cuePoints.push(0);\n    }\n    if (this._playAdByConfig()) {\n      this.dispatchEvent(this.player.Event.AD_MANIFEST_LOADED, {adBreaksPosition: cuePoints});\n    }\n    this._isAdsManagerLoaded = true;\n    this._attachAdsManagerListeners();\n    this._syncPlayerVolume();\n    if (this._hasUserAction) {\n      this.logger.debug('User action occurred before ads manager loaded');\n      this._startAdsManager();\n    }\n  }\n\n  /**\n   * returns the ads rendering settings configuration for IMA with plugin config applied\n   * @returns {Object} - IMA AdsRenderingSettings object\n   * @private\n   * @instance\n   * @memberof Ima\n   */\n  _getAdsRenderingSetting(): Object {\n    let adsRenderingSettings = new this._sdk.AdsRenderingSettings();\n    Object.keys(this.config.adsRenderingSettings).forEach(setting => {\n      if (adsRenderingSettings[setting] !== undefined) {\n        adsRenderingSettings[setting] = this.config.adsRenderingSettings[setting];\n      } else {\n        this.logger.warn('unsupported adsRenderingSettings was set:', setting);\n      }\n    });\n    adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete = false;\n    if (typeof this.config.adsRenderingSettings.playAdsAfterTime !== 'number') {\n      adsRenderingSettings.playAdsAfterTime = this.player.config.playback.startTime;\n    }\n    return adsRenderingSettings;\n  }\n\n  /**\n   * Attach the ads manager listeners.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _attachAdsManagerListeners(): void {\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_PAUSE_REQUESTED, adEvent => {\n      if (this._playAdByConfig() || this._firstOfAdPod) {\n        this._firstOfAdPod = false;\n        this._stateMachine.adbreakstart(adEvent);\n      }\n    });\n\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.CONTENT_RESUME_REQUESTED, adEvent => {\n      if (this._playAdByConfig() || this._podLength === 0) {\n        this._stateMachine.adbreakend(adEvent);\n      }\n    });\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.ALL_ADS_COMPLETED, adEvent => {\n      if (this._playAdByConfig() || this._podLength === 0) {\n        this._stateMachine.adscompleted(adEvent);\n      }\n    });\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOADED, adEvent => this._stateMachine.adloaded(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.STARTED, adEvent => this._stateMachine.adstarted(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.PAUSED, adEvent => this._stateMachine.adpaused(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.RESUMED, adEvent => this._stateMachine.adresumed(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.FIRST_QUARTILE, adEvent => this._stateMachine.adfirstquartile(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.MIDPOINT, adEvent => this._stateMachine.admidpoint(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.THIRD_QUARTILE, adEvent => this._stateMachine.adthirdquartile(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.CLICK, adEvent => this._stateMachine.adclicked(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.SKIPPED, adEvent => this._stateMachine.adskipped(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.COMPLETE, adEvent => this._stateMachine.adcompleted(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.USER_CLOSE, adEvent => this._stateMachine.userclosedad(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_CHANGED, adEvent => this._stateMachine.advolumechanged(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.VOLUME_MUTED, adEvent => this._stateMachine.admuted(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.AD_PROGRESS, adEvent => this._stateMachine.adprogress(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.AD_BUFFERING, adEvent => this._stateMachine.adbuffering(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.LOG, adEvent => this._stateMachine.adlog(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdEvent.Type.SKIPPABLE_STATE_CHANGED, adEvent => this._stateMachine.adcanskip(adEvent));\n    this._adsManager.addEventListener(this._sdk.AdErrorEvent.Type.AD_ERROR, adEvent => this._stateMachine.aderror(adEvent));\n  }\n\n  /**\n   * Syncs the player volume.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _syncPlayerVolume(): void {\n    if (this._adsManager) {\n      if (this.player.muted) {\n        this._adsManager.setVolume(0);\n      } else {\n        if (this._adsManager && !isNaN(this.player.volume) && typeof this.player.volume === 'number') {\n          this._adsManager.setVolume(this.player.volume);\n        }\n      }\n    }\n  }\n\n  /**\n   * Resolves the next promise to let the next handler in the middleware chain start.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _resolveNextPromise(): void {\n    if (this._nextPromise) {\n      this._nextPromise.resolve();\n      this._nextPromise = null;\n    }\n  }\n\n  /**\n   * Toggle the ads cover div.\n   * @param {boolean} enable - Whether to add or remove the ads cover.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _setToggleAdsCover(enable: boolean): void {\n    if (enable) {\n      if (!this.playOnMainVideoTag()) {\n        if (this._adsContainerDiv.parentNode) {\n          this._adsContainerDiv.parentNode.insertBefore(this._adsCoverDiv, this._adsContainerDiv.nextSibling);\n          this._isAdsCoverActive = true;\n        }\n      }\n    } else {\n      if (this._isAdsCoverActive) {\n        if (this._adsContainerDiv.parentNode) {\n          this._adsContainerDiv.parentNode.removeChild(this._adsCoverDiv);\n          this._isAdsCoverActive = false;\n        }\n      }\n    }\n  }\n\n  /**\n   * On ads cover click handler.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _onAdsCoverClicked(): void {\n    if (this._adsManager) {\n      switch (this._stateMachine.state) {\n        case State.PAUSED:\n          this._adsManager.resume();\n          break;\n        case State.PLAYING:\n          this._adsManager.pause();\n          break;\n        default:\n          break;\n      }\n    }\n  }\n\n  /**\n   * Displays companion ads using the Ad API.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeDisplayCompanionAds(): void {\n    if (this.config.companions && this.config.companions.ads && !window.googletag) {\n      const selectionCriteria = new this._sdk.CompanionAdSelectionSettings();\n      selectionCriteria.resourceType = this._sdk.CompanionAdSelectionSettings.ResourceType.ALL;\n      selectionCriteria.creativeType = this._sdk.CompanionAdSelectionSettings.CreativeType.ALL;\n      const sizeCriteria = this.config.companions.sizeCriteria;\n      selectionCriteria.sizeCriteria =\n        this._sdk.CompanionAdSelectionSettings.SizeCriteria[sizeCriteria] || this._sdk.CompanionAdSelectionSettings.SizeCriteria.SELECT_EXACT_MATCH;\n      const companionsIds = Object.keys(this.config.companions.ads);\n      for (let i = 0; i < companionsIds.length; i++) {\n        const id = companionsIds[i];\n        const ad = this.config.companions.ads[id];\n        const width = ad.width;\n        const height = ad.height;\n        try {\n          const companionAds = this._currentAd.getCompanionAds(width, height, selectionCriteria);\n          if (companionAds.length > 0) {\n            const companionAd = companionAds[0];\n            const content = companionAd.getContent();\n            const el = Utils.Dom.getElementById(id);\n            if (el) {\n              el.innerHTML = content;\n            }\n          }\n        } catch (e) {\n          this.logger.error('Error occurred while extracting companion ad', e);\n        }\n      }\n    }\n  }\n\n  /**\n   * On Chrome-Android we're ignoring LearnMore click to enable\n   * video element manipulation only on user gesture.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeIgnoreClickOnAd(): void {\n    const isAndroid = () => this.player.env.os.name === 'Android';\n    const isChrome = () => this.player.env.browser.name === 'Chrome';\n    if (isAndroid() && isChrome()) {\n      this.eventManager.listenOnce(this.player.getView(), 'click', e => e.stopPropagation());\n    }\n  }\n\n  /**\n   * On iOS AVPlayer caption stack on video tag, should re-position to hide\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _hideActiveTextTracksOnAVPlayer(): void {\n    const isIOS = this.player.env.os.name === 'iOS';\n    if (isIOS && this.playOnMainVideoTag()) {\n      let tracks = this.player.getVideoElement().textTracks;\n      Array.from(tracks).forEach(track => {\n        if (track.mode === 'showing') {\n          Array.from(track.activeCues).forEach(cue => {\n            this._textTracksHidden.push(cue.text);\n            cue.text = '';\n          });\n        }\n      });\n    }\n  }\n\n  _setActiveTextTracksOnAVPlayer(): void {\n    const isIOS = this.player.env.os.name === 'iOS';\n    if (this._textTracksHidden && isIOS && this.playOnMainVideoTag()) {\n      let tracks = this.player.getVideoElement().textTracks;\n      Array.from(tracks).forEach(track => {\n        if (track.mode === 'showing') {\n          Array.from(track.activeCues).forEach(cue => {\n            if (this._textTracksHidden.length > 0) {\n              cue.text = this._textTracksHidden.shift();\n            }\n          });\n        }\n      });\n    }\n    this._textTracksHidden = [];\n  }\n\n  /**\n   * When playing on same video tag need to save state snapshot\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeSavePlayerSnapshot(): void {\n    if (this.playOnMainVideoTag()) {\n      this._selectedAudioTrack = this.player.getActiveTracks().audio;\n      this._selectedTextTrack = this.player.getActiveTracks().text;\n      this._selectedPlaybackRate = this.player.playbackRate;\n      // When we are using the same video element on iOS, native captions still\n      // appearing on the video element, so need to hide them before ad start.\n      this._hideActiveTextTracksOnAVPlayer();\n      this.player.hideTextTrack();\n    }\n  }\n\n  /**\n   * When playing on same video tag need to restore to previous state\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeRestorePlayerSnapshot(): void {\n    if (this.playOnMainVideoTag()) {\n      this.eventManager.listenOnce(this.player, this.player.Event.CAN_PLAY, () => {\n        this.player.selectTrack(this._selectedAudioTrack);\n        this.player.selectTrack(this._selectedTextTrack);\n        this.player.playbackRate = this._selectedPlaybackRate;\n        this._setActiveTextTracksOnAVPlayer();\n      });\n    }\n  }\n\n  /**\n   * When playing with different video tags on iOS ads are not\n   * supported in native full screen, so need to exist full screen before ads started.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _maybeForceExitFullScreen(): void {\n    const isIOS = this.player.env.os.name === 'iOS';\n    //check if inBrowserFullscreen not set, just in case of inline true and not inBrowserFullscreen we will exit otherwise\n    if (\n      isIOS &&\n      !this.playOnMainVideoTag() &&\n      this.player.isFullscreen() &&\n      !this.player.config.playback.inBrowserFullscreen &&\n      this.player.config.playback.playsinline\n    ) {\n      this.player.exitFullscreen();\n    }\n  }\n\n  _playAdByConfig(): boolean {\n    return !!(this.config.adTagUrl || this.config.adsResponse);\n  }\n}\n\nexport {Ima};\n","// @flow\nimport {core} from 'kaltura-player-js';\nimport {Ima as BaseImaPlugin} from './ima';\n\nconst {Env} = core;\n\nclass CustomIma extends BaseImaPlugin {\n  /**\n   * The default configuration of the plugin.\n   * @type {Object}\n   * @static\n   * @memberof Ima\n   */\n  static defaultConfig: Object = {\n    debug: false,\n    delayInitUntilSourceSelected: Env.os.name === 'iOS',\n    disableMediaPreload: false,\n    forceReloadMediaAfterAds: false,\n    adsRenderingSettings: {\n      restoreCustomPlaybackStateOnAdBreakComplete: false,\n      enablePreloading: false,\n      useStyledLinearAds: false,\n      useStyledNonLinearAds: true,\n      bitrate: -1,\n      autoAlign: true,\n      loadVideoTimeout: -1\n    },\n    companions: {\n      ads: null,\n      sizeCriteria: 'SELECT_EXACT_MATCH'\n    },\n    aps: {\n      enabled: false,\n      fetchBids: adTagUrl => new Promise(resolve => resolve(adTagUrl))\n    },\n    adBreakPlayable: () => true\n  };\n\n  /**\n   * Plays ad on demand\n   * @param {KPAdPod} adPod - The ad pod to play.\n   * @returns {void}\n   * @public\n   * @instance\n   * @memberof Ima\n   */\n  playAdNow(adPod: KPAdPod): void {\n    if (!this._adBreakPlayableByConfig(adPod)) {\n      this.logger.debug('Not playing ad now because config callback denied');\n      return;\n    }\n\n    super.playAdNow(adPod);\n  }\n\n  _adBreakPlayableByConfig(adPod: ?PKAdPod): boolean {\n    return this.config.adBreakPlayable(adPod);\n  }\n\n  /**\n   * Requests the ads from the ads loader.\n   * @param {?string} vastUrl - vast url.\n   * @param {?string} vastResponse - vast XML response.\n   * @private\n   * @returns {void}\n   * @instance\n   * @memberof Ima\n   */\n  _requestAds(vastUrl: ?string, vastResponse: ?string): void {\n    this.logger.debug('Request ads', vastUrl);\n\n    let adTagUrl = vastUrl || this.config.adTagUrl;\n\n    this.logger.debug('APS integration', this.config.aps.enabled);\n\n    let fetchBidsPromise = new Promise(resolve => resolve(adTagUrl));\n\n    if (this.config.aps.enabled && adTagUrl && 'apstag' in window) {\n      fetchBidsPromise = this.config.aps.fetchBids(adTagUrl);\n    }\n\n    fetchBidsPromise.then(adTagUrl => {\n      this.logger.debug('APS fetch bids resolved', adTagUrl);\n      super._requestAds(adTagUrl, vastResponse);\n    });\n  }\n}\n\nexport {CustomIma as Ima};\n","// @flow\nimport {registerPlugin} from 'kaltura-player-js';\nimport {Ima} from './ima-custom';\n\ndeclare var __VERSION__: string;\ndeclare var __NAME__: string;\n\nconst VERSION = __VERSION__;\nconst NAME = __NAME__;\n\nexport {Ima as Plugin};\nexport {VERSION, NAME};\n\nconst pluginName: string = 'ima';\n\nregisterPlugin(pluginName, Ima);\n"],"sourceRoot":""}